---
editor_options: 
  markdown: 
    wrap: sentence
---


```{r include=FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.topcaption=TRUE)

library(tidyverse)
library(janitor)
library(lubridate)
library(haven)
library(glue)
library(gt)
library(comunicacion)
library(hrbrthemes) 
library(ggtext) 
library(data.table)
library(herramientas)

### Se defininen algunos parámetros

#anio de referencia de publicación
options(scipen = 9999)

anio_ref <- 2022

```


# **Turismo Internacional en Argentina** {#turismo-internacional}

## Introducción

En el presente capítulo se analizan los distintos aspectos relacionados al turismo receptivo y emisivo de la Argentina. Para ello, se toman como base las siguientes fuentes que abarcan los distintos aspectos de la actividad turística:

* Estimaciones de la cantidad de **viajes de turistas y excursionistas**[^viaje] elaboradas por la DNMyE en base a datos de la Dirección Nacional de Migraciones (DNM) de la totalidad de los pasos fronterizos del país y de la Encuesta de Turismo Internacional (ETI). Es decir, del flujo de viajes de turistas y excursionistas no residentes que visitaron el país y residentes que viajaron al exterior, por todos los medios de transporte (aéreo, fluvial/marítimo y terrestre). 

[^viaje]: El viaje realizado por un visitante no residente (turismo receptivo) se registra desde
el momento que llega a la Argentina hasta que sale. Un visitante no residente
(turista o excursionista) puede salir de Argentina para efectuar visitas a otros países
y volver a ingresar en un corto período de tiempo, antes de regresar a su país de
residencia habitual. Por ello, la cantidad de viajes receptivos puede ser mayor que la
cantidad de turistas/excursionistas receptivos. En tanto, el viaje realizado por un visitante residente en Argentina (turismo emisivo) se registra desde el momento en que sale del país hasta que retorna, independientemente de la cantidad de países visitados. Por ello, la cantidad de
viajes emisivos coincide con la cantidad de visitantes emisivos. El primer apartado presenta los datos de **viajes de turistas/excursionistas**, pero no de turistas/excursionistas. En el segundo apartado la unidad de análisis sí serán los **turistas**. 

* Datos de la Dirección Nacional de Estadísticas del Sector Externo y Cuentas Internacionales (DNESEyCI) del INDEC, que dicha dirección elabora para la construcción de la cuenta viajes del balance de pagos, con información sobre el **gasto turístico**[^nota_empalme] emisivo y receptivo por todos los medios de transporte de ingreso y egreso del país, es decir los pasos terrestres, fluviales, marítimos y aéreos.

* La Encuesta de Turismo Internacional (ETI) que estudia la evolución y las características de los **turistas residentes y no residentes** (turismo emisivo y receptivo) por el Aeropuerto internacional de Ezeiza, el Aeroparque Jorge Newbery,
el Aeropuerto Internacional Pajas Blancas de Córdoba, Aeropuerto Internacional de Mendoza, el Puerto de Buenos Aires y el Paso Internacional Cristo Redentor. 


[^nota_empalme]:Tanto en 2013 como en 2016 dicho organismo realizó mejoras en las estimaciones de los datos, gracias a un conjunto de revisiones metodológicas y a una mayor explotación de los datos migratorios. Para poder tener una serie comparable, desde la DNMyE se realizó un empalme de la serie a partir de las variaciones trimestrales por medio de transporte y país de la serie anterior. 

En la primera sección, inicialmente, se presentarán  los indicadores más importantes acerca de la evolución general de los **viajes de turistas** residentes y no residentes en base a los datos de la DNMyE. Luego, se mostrará información sobre el **gasto y estadía** con datos de  la DNESEyCI del INDEC.

En el segundo apartado, se realizará un análisis más exhaustivo del **perfil de los turistas** internacionales que ingresan y egresan por los aeropuertos internacionales de Ezeiza, Córdoba, Mendoza, Aeroparque Jorge Newbery, el Puerto de Buenos Aires y el paso Cristo Redentor, en base a datos de la ETI.

En todo el capítulo, se presentan los datos desagregados por país de residencia para el receptivo y por país de destino para el emisivo, agrupados de la siguiente forma: cada uno de los países limítrofes (Bolivia, Brasil, Chile, Paraguay, Uruguay), EE.UU.y Canadá, Resto de América, Europa y Resto del mundo.

A la hora de analizar la información de ambas secciones, es relevante considerar que el turismo internacional en 2021 aún estuvo afectado por la pandemia de la COVID-19; por lo que **la información presentada referida tanto al volumen de turistas (y sus gastos), como el perfil de los mismos puede llegar a presentar diferencias con respecto al resto de los años**. 

## Turismo Internacional en Argentina por todos los medios de transporte de Ingreso y Egreso del País

```{r}

#levanto base TI(2016+)

base_visitantes <- read_file_srv("/srv/DataDNMYE/turismo_internacional/bases_proceso/turismo_internacional_visitantes.rds")

base_visitantes <- base_visitantes %>% 
  select(anio,mes,turismo_internac,casos_ponderados,
                         tipo_visitante, pais_agrupado, destino_agrup, via) %>% 
  filter(anio <= anio_ref) %>% 
  group_by(anio,mes,turismo_internac,
                         tipo_visitante, pais_agrupado, destino_agrup, via) %>% 
  summarise (casos_ponderados = sum(casos_ponderados))  %>% 
  ungroup()
 

#completo meses faltantes: 

base_visitantes <- complete (base_visitantes, 
                              expand(base_visitantes, anio, mes,
                                             nesting(destino_agrup, 
                                                    pais_agrupado, 
                                                    turismo_internac, 
                                                    tipo_visitante, 
                                                    via)),
                                      fill = list(casos_ponderados = 0))


#paso mes a factor (con Total)
base_visitantes <- base_visitantes %>% 
  mutate (mes = fcase(mes == 1 ,"Enero", mes == 2 ,"Febrero", 
                                mes == 3 ,"Marzo", mes == 4 ,"Abril", 
                                mes == 5 ,"Mayo",    mes == 6 ,"Junio",
                                mes == 7 ,"Julio", mes == 8 ,"Agosto",  
                                mes == 9 ,"Septiembre", mes == 10 ,"Octubre",
                                mes == 11 ,"Noviembre", mes == 12 ,"Diciembre"))


base_visitantes$mes<- factor(base_visitantes$mes, 
                              levels = c("Total", "Enero",	"Febrero",	"Marzo", "Abril",	
                                         "Mayo",	"Junio",	"Julio",	"Agosto",	
                                         "Septiembre", "Octubre",	"Noviembre",	
                                         "Diciembre"), 
                              ordered = TRUE)


emisivo <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo") 

#no creo receptivo, la filtro en cada chunk.


#levanto datos historicos:

#excursionistas (1990-2015)

excursionistas <- read_file_srv("/srv/DataDNMYE/turismo_internacional/bases_proceso/series/serie_excursionistas_1990.xlsx") %>% 
  filter(anio >= anio_ref-10, anio <= 2015)

  

#Receptivo: anuales (1990-anio anuario) por pais_agrupado
receptivo_anual_pais <- read_file_srv("/srv/DataDNMYE/turismo_internacional/bases_proceso/series/serie_anual_pais_1990.xlsx", 
                                 sheet = "receptivo")

#Emisivo: (en receptivo se levantó serie completa, en emisivo lo hicimos separado)
#a)levanto datos  90-2015:

emisivo_90_2015 <- read_file_srv("/srv/DataDNMYE/turismo_internacional/bases_proceso/series/serie_emisivo_1990_ancho.xlsx", sheet = "anual_pais_90") %>% 
  filter(anio <= 2015) %>% 
  pivot_longer(cols = -anio, 
               names_to = c("destino_agrup"),
               values_to = "turistas_e")

#b) levanto datos desde 2016:

emisivo_2016 <- emisivo %>% 
  filter(tipo_visitante == "Turistas") %>% 
  group_by(anio, destino_agrup) %>% 
  summarise(turistas_e = sum(casos_ponderados))

#c) sumo serie historica a serie actual 

emisivo_anual_pais <- rbind(emisivo_90_2015, emisivo_2016) 

```
### Turismo Receptivo

```{r ti_serie_vis_r}

serie_vis_r_actual <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo") %>% 
  group_by (anio, tipo_visitante) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() 


#con serie historica:
serie_vis_r <-excursionistas %>% 
  select(anio, excursionistas_r, turistas_r) %>% 
  pivot_longer(cols = -anio, 
               names_to = c("tipo_visitante"),
               values_to = "tur") %>%
  mutate(tipo_visitante= if_else(tipo_visitante == "excursionistas_r", "Excursionistas", "Turistas")) %>% 
  bind_rows(serie_vis_r_actual) %>% 
  pivot_wider (names_from = tipo_visitante,
               values_from = tur) %>% 
  mutate (visitantes = Turistas + Excursionistas,
          var_interanual_vis = tasa_variacion(visitantes),
          var_interanual_tur = tasa_variacion(Turistas),
          var_interanual_exc = tasa_variacion(Excursionistas),
          ) %>% 
  select (c("anio", "visitantes", "var_interanual_vis", "Turistas", "var_interanual_tur","Excursionistas", "var_interanual_exc")) %>% 
  arrange(anio)

var_prepandemia <- last(serie_vis_r$Turistas)/ serie_vis_r$Turistas[serie_vis_r$anio == 2019] - 1
     
```

El total de  viajes de turistas no residentes en `r as.character(anio_ref)` fue de `r lbl_percent( last(serie_vis_r$Turistas), decimales = 0)`, con `r ifelse(last(serie_vis_r$var_interanual_tur)>0,"un aumento ","una caída")` interanual de un `r format(round(100 * abs (last(serie_vis_r$var_interanual_tur)), 1),decimal.mark = ",",big.mark = ".")`%. En comparación con 2019 (prepandemia), `r ifelse(var_prepandemia > 0, "aumentó", "cayó")` un `r format(round(100 * abs (var_prepandemia), 1),decimal.mark = ",",big.mark = ".")`%.

```{r ti1}

ti1 <- serie_vis_r %>% 
gt() %>% 
gt_theme_dnmye() %>% 
cols_label(
 anio = md("Año"),
 visitantes = md("**Viajes de visitantes no residentes**"),
 var_interanual_vis = md("**Variación interanual (%)**"),
 Turistas = md("**Viajes de turistas no residentes**"),
 var_interanual_tur = md("**Variación interanual (%)**"),
 Excursionistas = md("**Viajes de excursionistas no residentes**"),
 var_interanual_exc = md("**Variación interanual (%)**")) %>% 
fmt_number(columns  = c(2,4,6), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>% 
tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption( glue("Viajes de visitantes, turistas y excursionistas no residentes por año. Total país. Años {anio_ref-10}-{anio_ref}."))

ti1

```

<br>

La serie histórica de viajes de turistas no residentes muestra una tendencia general ascendente, aunque con algunos momentos de caída. En el año 2019, se encontraba en su punto más alto, con 7,4 millones de viajes de turistas. Luego de la caída de 2020 y 2021 por la pandemia, en 2022 se observa una clara recuperación. 

El turismo proveniente de países limítrofes siempre ha sido el mayoritario, reflejando la misma tendencia que la serie general. En tanto, los provenientes de países no limítrofes, han tenido momentos de crecimiento y otros de relativo estancamiento, como entre 2007 y 2018, repuntando en 2019.

```{r}
#g1. turistas nr segun limitrofes

receptivo_anual_lim <- receptivo_anual_pais %>% 
  filter (anio <= anio_ref) %>% 
  mutate(limitrofe = case_when(pais_agrupado %in% c("Bolivia","Brasil","Chile","Paraguay","Uruguay") ~ "Países limítrofes",
                               TRUE ~ "Países no limítrofes")) %>%
  group_by(limitrofe, anio) %>% 
  summarise (tur = sum(viajes_turistas)) %>% 
  ungroup() 

#para lectura: 
receptivo_anual_lim_anio_ref <- receptivo_anual_lim %>% 
  filter(anio == anio_ref) %>% 
  mutate (prop = round(tur/sum(tur)*100,1))

```

En el año `r as.character(anio_ref)`, el `r format(receptivo_anual_lim_anio_ref$prop[receptivo_anual_lim_anio_ref$limitrofe == "Países no limítrofes"],, big.mark = ".",decimal.mark = ",")`% de los viajes de turistas fueron desde países no  limítrofes, en tanto el `r format(receptivo_anual_lim_anio_ref$prop[receptivo_anual_lim_anio_ref$limitrofe == "Países limítrofes"], big.mark = ".",decimal.mark = ",")`% restante lo hicieron desde países limítrofes. 

```{r ti2, fig.cap= glue("Viajes de turistas no residentes según lugar de residencia por año. Total país. Años 1990-{anio_ref}."), out.width='100%'}


#total para tabla
receptivo_anual_lim_tot <- receptivo_anual_lim %>% 
  group_by(anio) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup() %>% 
  mutate(limitrofe = "Total viajes de turistas no residentes")

#tabla final:
receptivo_anual_lim_final <- receptivo_anual_lim %>% 
  rbind(receptivo_anual_lim_tot) 

graf_1.1_anual <- ggplot(receptivo_anual_lim_final, aes(ym(paste(anio, 1, sep = "-")), tur/1000000, colour = limitrofe)) +   
  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
  geom_line() + 
  geom_point()+
  scale_color_dnmye() + 
  scale_x_date(date_breaks = "1 years", date_labels = "%Y", expand = c(.01,.01))+ 
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = "," )) + 
  theme_minimal()+
  theme(legend.position = "bottom", 
        axis.text.x = element_text (angle=90),
        plot.caption = ggtext::element_markdown() ) +
  labs(y = "en millones de viajes de turistas", 
       x = "", 
       color= "",
       caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

graf_1.1_anual

```


```{r ti3, fig.cap= glue("Viajes de turistas no residentes por lugar de residencia.  Distribución porcentual. Año {anio_ref}.")}

g_1.2 <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo", tipo_visitante == "Turistas", (anio == anio_ref | anio == anio_ref-1)) %>% 
  group_by (anio, pais_agrupado) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() 
 
g_1.3_texto_r <- g_1.2 %>% 
  filter (anio == anio_ref) %>%   
  mutate(porc = tur/sum(tur)) %>% 
  arrange (-porc)

  
g_1.2 <- g_1.2 %>% 
  mutate (pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")) 
)


#grafico %. 


g_1.3 <- g_1.2 %>% 
  filter (anio == anio_ref) %>% 
  mutate(porc = tur/sum(tur)) %>% 
  arrange (-porc)

graf_1.3 <- ggplot(g_1.3, aes(x= pais_agrupado, y = porc)) +   
geom_col(fill = "#50B8B1")+
geom_label(aes(label = scales::label_percent(decimal.mark = ",", accuracy = 0.1 )(porc)), size = 2.5)+
scale_y_continuous(labels = scales::label_percent(scale = 100, decimal.mark = ",")) + 
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (size =9, angle = 40, vjust = 0.5),
      axis.text.y = element_text(size = 12),
      legend.text = element_text (size =10),
      plot.caption = ggtext::element_markdown()) +
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

graf_1.3



```

`r g_1.3_texto_r[1,"pais_agrupado"]` fue el  principal mercado emisor de turismo hacia Argentina, con  `r 
lbl_int(pull(g_1.3_texto_r[1,"tur"]))` turistas (`r 
lbl_decimal(pull(g_1.3_texto_r[1,"porc"]*100))`%), seguido por `r g_1.3_texto_r[2,"pais_agrupado"]` y  `r g_1.3_texto_r[3,"pais_agrupado"]` con `r 
lbl_int(pull(g_1.3_texto_r[2,"tur"]))` y `r lbl_int(pull(g_1.3_texto_r[3,"tur"]))` y con un 
`r lbl_decimal(pull(g_1.3_texto_r[2,"porc"]*100))`% y 
`r lbl_decimal(pull(g_1.3_texto_r[3,"porc"]*100))`% respectivamente.  

Como se observa en el siguiente gráfico, en el año `r as.character(anio_ref)`, hubo un alto crecimiento en los viajes de los turistas no residentes desde todos los países. 


```{r ti4, fig.cap= glue("Viajes de turistas no residentes por lugar de residencia por año. Total país. Años {anio_ref-1}-{anio_ref}.")}

graf_1.2 <- ggplot(g_1.2, aes(x= pais_agrupado, y = round(tur,0))) +   
geom_col(aes(fill = as_factor(anio)), position = "dodge") +
geom_label(aes(label = format(tur, big.mark = ".", decimal.mark = ",", digits = 0), group = anio),
           label.padding =  unit(0.2, "lines"),
           position = position_dodge(width = 1),
           vjust = -0.05,
           size= 2.5)+
scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ","), expand = c(.1,.01)) +
scale_fill_dnmye()+
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (angle = 40, vjust = 0.5),
      plot.caption = ggtext::element_markdown())+
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

graf_1.2


```

Al observar la evolución mensual del año `r as.character(anio_ref)` se puede ver una tendencia de recuperación creciente respecto a 2019. Partiendo de un enero con una caída del 80,0% respecto a 2019, al finalizar el año noviembre presenta una variación de -22,1% y diciembre de -40,9%. Este último mes fue bastante atípico, apenas superior a noviembre, probablemente en buena medida debido al desarrollo del Mundial de Fútbol de 2022 en Qatar.  

En tanto, la variación interanual, aunque es muy alta en todos los meses, es algo menor en los últimos meses del año, debido a la recuperación iniciada en el último trimestre de 2021. 

La recuperación del segundo trimestre se debe principalmente a los viajes de turistas de países limítrofes, los cuales también mostraron un incremento en el tercer trimestre. En tanto, los viajes de turistas de países no limítrofes tienen un importante crecimiento en el cuarto trimestre. 


```{r ti5}

#base por mes y pais 

c_1.2_pais <- base_visitantes %>% 
filter (turismo_internac == "Receptivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, mes, pais_agrupado) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 108), #9 paises *12 meses
          var = if_else(var == Inf, NA_real_, var))
#por anio y pais

c_1.2_pais_tot <- c_1.2_pais %>% 
  group_by (anio, pais_agrupado) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup()

#prepandemia:

receptivo_2019 <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo", tipo_visitante == "Turistas", (anio == 2019)) %>% 
  group_by (anio, mes) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  adorn_totals(fill = "Total", name = "2019")

receptivo_anio_ref <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo", tipo_visitante == "Turistas", (anio == anio_ref)) %>% 
  group_by (anio, mes) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  adorn_totals(fill = "Total", name = as.character(anio_ref))

receptivo_2019_var <- bind_rows(receptivo_2019, receptivo_anio_ref) %>% 
  mutate (var_2019 = tasa_variacion(tur,periodo = 13),
          var_2019 = if_else(var_2019 == Inf, NA_real_, var_2019)) %>% 
  filter(anio == anio_ref) %>% 
  select(-tur) %>% 
  mutate(anio = as.integer(anio))

c_1.2_pais_con_tot <- c_1.2_pais_tot %>% 
 mutate (var = tasa_variacion(tur,periodo = 9), 
         var = if_else(var == Inf, NA_real_, var),
          mes = "Total") %>% 
  bind_rows(c_1.2_pais) %>% 
  pivot_wider (names_from = pais_agrupado,
               values_from = c(tur,var),
               names_vary = "slowest") %>% #ordena tur bol, var_bol, etc.
  filter(anio == anio_ref) 

c_1.2 <- c_1.2_pais %>% 
  group_by (anio, mes) %>%
   summarise (tur = sum(tur)) %>% 
  ungroup() 
 
#total anual
c_1.2_anual <- c_1.2 %>% 
  group_by (anio) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup() %>% 
  mutate (mes = "Total")

c_1.2 <- c_1.2 %>% 
  bind_rows(c_1.2_anual) %>% 
  arrange(anio, mes) %>% 
  mutate(var_tot = tasa_variacion(tur,periodo = 13),#12 meses + total
         var_tot = if_else(var_tot == Inf, NA_real_, var_tot)) %>% 
  filter(anio == anio_ref) 

#traigo var. 2019:

c_1.2 <- c_1.2 %>%
  left_join(receptivo_2019_var)

c_1.2_pais_tot_completo  <-  c_1.2_pais_con_tot %>% 
  left_join(c_1.2) %>% 
  relocate(c(tur, var_tot, var_2019), .after =  mes) %>% 
  select(-anio)


ti5 <- gt(c_1.2_pais_tot_completo) %>% 
  gt_theme_dnmye(var_total = mes) %>%  
  cols_label(
  mes = md("**Mes**"),
  tur = md("**Total**"),
  var_tot = md(	"Variación interanual (%)"), 
  var_2019 = md(	"Variación vs. 2019 (%)"), 
  var_Bolivia	= md(	"Variación interanual (%)"),
  var_Brasil	= md(	"Variación interanual (%)"),
  var_Chile	= md(	"Variación interanual (%)"),
  var_Paraguay	= md(	"Variación interanual (%)"),
  var_Uruguay	= md(	"Variación interanual (%)"),
  'var_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_Resto de América'	= md(	"Variación interanual (%)"),
  var_Europa	= md(	"Variación interanual (%)"),
  'var_Resto del mundo'	= md(	"Variación interanual (%)"),
  tur_Bolivia	= md(	"Bolivia"),
  tur_Brasil	= md(	"Brasil"),
  tur_Chile	= md(	"Chile"),
  tur_Paraguay	= md(	"Paraguay"),
  tur_Uruguay	= md(	"Uruguay"),
  'tur_EE.UU. y Canadá'	= md(	"EE.UU. y Canadá"),
  'tur_Resto de América'	= md(	"Resto de América"),
  tur_Europa	= md(	"Europa"),
  'tur_Resto del mundo'	= md(	"Resto del mundo")) %>% 
  fmt_number(columns  =c(2, seq(5,22,2)), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Viajes de turistas no residentes y variación interanual según lugar de residencia por mes. Total país. Año {anio_ref}."))

ti5

##probando esto para mejor lectura: hipotesis: recuperacion desde mitad de limitrofes y desde ept #de no lim:
#mes_pais_tabla <- c_1.2_pais %>% 
#  filter(anio == anio_ref) %>% 
#  mutate(limitrofe = case_when(pais_agrupado %in% #("Bolivia","Brasil","Chile","Paraguay","Uruguay") ~ "Países #limítrofes",
#                               TRUE ~ "Países no limítrofes"),
#         fecha = dmy(paste(1, mes, anio)) ) %>% 
#  group_by(fecha, limitrofe) %>% 
#  summarise(tur = sum(tur))
#
#mes_pais <- ggplot(mes_pais_tabla, aes(mes, round(tur), color = limitrofe)) +   
#  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
#  geom_line() + 
#  geom_point()

```

<br>

La recuperación respecto a 2019 de Uruguay ha sido la más importante, con una variación de sólo -5,3%, seguida por EE.UU y Canadá y Brasil, con -34,4% y -45,8% respectivamente. 

En cuanto a los medios de transporte, no hay grandes diferencias, aunque los aéreos han sido los que más se han recuperado frente a 2019, seguidos de los medios fluviales y marítimos y por último los terrestres. Lo inverso sucede al observar la variación interanual, donde los viajes por medios terrestres tienen un crecimiento mucho mayor. Sin embargo, los viajes por vía aérea, al igual que en 2021, han sido los mayoritarios. 

```{r ti6}

#via pais

pais_via <- base_visitantes %>% 
filter (turismo_internac == "Receptivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, via, pais_agrupado) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 3*9)) %>% #3 vias *9 paises 
  filter(anio == anio_ref) %>% 
  pivot_wider (names_from = via,
               values_from = c(tur,var),
               names_vary = "slowest") %>% 
  janitor::clean_names() 

#por anio y via total paises

pais_via_tot <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, via) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 3))  %>% 
  filter(anio == anio_ref) %>% 
  mutate (prop = tur/sum(tur)) %>% 
  pivot_wider (names_from = via,
               values_from = c(tur,var,prop),
               names_vary = "slowest") %>% 
  janitor::clean_names() %>% 
  mutate(pais_agrupado= "Total") %>% 
  relocate(pais_agrupado, .after =  anio)

#total vias por pais

c_1.2_pais_vias_tot <- c_1.2_pais_tot %>% 
  filter(anio == anio_ref) %>% 
  janitor::adorn_totals(fill ="Total") %>% 
  arrange( desc(anio), pais_agrupado) %>% 
  select(-anio)

#agrego totales, calculo prop via por pais.

pais_via_con_tot <- pais_via_tot %>% 
  bind_rows(pais_via) %>% 
  left_join(c_1.2_pais_vias_tot) %>% 
  relocate(tur, .after = pais_agrupado) %>% 
  select(-anio)%>% 
  mutate(prop_aereo =tur_aereo/tur,
         prop_fluvial_maritimo = tur_fluvial_maritimo/tur,
         prop_terrestre =tur_terrestre/tur) 

# var 2019:

pais_2019 <- base_visitantes %>% 
  filter (turismo_internac == "Receptivo", tipo_visitante == "Turistas", (anio == 2019)) %>% 
  group_by (anio, pais_agrupado, via) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  pivot_wider ( names_from = via,
               values_from = tur) %>%
  adorn_totals(c("row", "col"), fill = "Total") %>% 
  select(-anio) %>% 
  clean_names()
  
via_pais_con_v19 <- pais_via_con_tot %>%
  left_join(pais_2019) %>% 
  mutate(var_19 = tur/total-1, 
         var_19_aereo = tur_aereo/aereo-1, 
         var_19_maritimo = tur_fluvial_maritimo/fluvial_maritimo-1, 
         var_19_terrestre = tur_terrestre/terrestre-1
         ) %>%
  relocate (var_19, .after = tur) %>%
  relocate (var_19_aereo, .after = var_aereo) %>%
  relocate (var_19_maritimo, .after = var_fluvial_maritimo) %>%
  relocate (var_19_terrestre, .after = var_terrestre) %>% 
  select(-c(total, aereo,fluvial_maritimo,terrestre))
  
ti6 <- gt(via_pais_con_v19) %>% 
  gt_theme_dnmye(var_total = pais_agrupado) %>% 
  tab_spanner(label = "Aéreo", columns = ends_with("aereo")) %>% 
  tab_spanner(label = "Fluvial/marítimo", columns = ends_with("maritimo")) %>% 
  tab_spanner(label = "Terrestre", columns = ends_with("terrestre")) %>% 
  cols_label(
    pais_agrupado = md("País de residencia"),
    tur = md("Total"),
    var_19 = md("Variación vs. 2019 (%)"), 
    var_19_aereo = md("Variación vs. 2019 (%)"), 
    var_19_maritimo = md("Variación vs. 2019 (%)"), 
    var_19_terrestre = md("Variación vs. 2019 (%)"), 
    tur_aereo	= md(	"Turistas"),
    var_aereo	= md(	"Variación interanual (%)"),
    prop_aereo	= md(	"Participación en el total (%)"),
    tur_fluvial_maritimo	= md(	"Turistas"),
    var_fluvial_maritimo	= md(	"Variación interanual (%)"),
    prop_fluvial_maritimo	= md(	"Participación en el total (%)"),
    tur_terrestre	= md(	"Turistas"),
    var_terrestre	= md(	"Variación interanual (%)"),
    prop_terrestre	= md(	"Participación en el total (%)")) %>% 
  fmt_number(columns  = c(2,seq(4,12,4)), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
  tab_source_note(
    source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI.")) %>%
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Viajes de turistas no residentes por medio de transporte según año y lugar de residencia. Total país. Año {anio_ref}."))

ti6

```
 <br>
 
```{r levanto datos gasto} 

#base desde 2020:

cuenta_viajes_ori <- read_file_srv("/DataDNMYE/cuentas_internacionales/base_detallada/base_detallada_viajes_mintur_20231T.xlsx") %>% 
  janitor::clean_names() %>% 
  rename(anio = ano) %>% 
  mutate (pais_agrupado = case_when (cod_agrup_bp_pais == 2 ~ "Bolivia",
                                  cod_agrup_bp_pais == 3 ~ "Brasil",
                                  cod_agrup_bp_pais == 4 ~ "Chile",
                                  cod_agrup_bp_pais == 5  ~ "EE.UU. y Canadá", 
                                  cod_agrup_bp_pais == 6  ~ "Europa", 
                                  cod_agrup_bp_pais == 7  ~ "Paraguay",
                                  cod_agrup_bp_pais == 8  ~ "Resto de América",
                                  cod_agrup_bp_pais == 9  ~ "Resto del mundo",
                                  cod_agrup_bp_pais == 10 ~ "Uruguay")) %>% 
  mutate (pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")),
         trim = as.integer(str_sub(trim, 5, 5)))


#Armado de serie resumen anual: 

cuenta_viajes <-  cuenta_viajes_ori%>% 
  mutate(limitrofe = case_when(cod_agrup_bp_pais %in% c(2:4,7,10) ~ "lim",
                               TRUE ~ "no_lim")) %>% 
  group_by(anio) %>% 
  summarise(receptivo_tur = sum(gasto_total[residencia == "NR" & resumen_viajero == "Turistas"]),
            receptivo_exc = sum(gasto_total[residencia == "NR" & resumen_viajero == "Excursionistas"]),
            emisivo_tur = sum(gasto_total[residencia == "R" & resumen_viajero == "Turistas"]),
            emisivo_exc = sum(gasto_total[residencia == "R" & resumen_viajero == "Excursionistas"]), 
            receptivo_tur_lim = sum(gasto_total[residencia == "NR" & resumen_viajero == "Turistas" & limitrofe =="lim"]),
            receptivo_tur_no_lim = sum(gasto_total[residencia == "NR" & resumen_viajero == "Turistas" & limitrofe =="no_lim"]),
            emisivo_tur_lim = sum(gasto_total[residencia == "R" & resumen_viajero == "Turistas" & limitrofe =="lim"]),
            emisivo_tur_no_lim = sum(gasto_total[residencia == "R" & resumen_viajero == "Turistas" & limitrofe =="no_lim"]),
  )

# Serie con gasto en pasajes:

cuenta_pasajes <- read_file_srv("/DataDNMYE/cuentas_internacionales/base_detallada/pasajes_MT_20231T.xlsx") %>% 
  janitor::clean_names() %>% 
  mutate(anio = as.integer(str_sub(trim, 1,4))) %>% 
  group_by(anio) %>% 
  summarise(receptivo_p = sum(monto[cod_bde_p %in% c("1Ab0311",# marítimo pasajeros
                                                                 "1Ab0321",# aéreo pasajeros
                                                                 "1Ab0331") # otras modalidades pasajeros
                                                & cd_bdd_p == "c"]),
            emisivo_p = sum(monto[cod_bde_p %in% c("1Ab0311",# marítimo pasajeros
                                                               "1Ab0321",# aéreo pasajeros
                                                               "1Ab0331") # otras modalidades pasajeros
                                              & cd_bdd_p == "d"])) %>% 
   filter (anio >2019)#los datos de 2019 de pasajes están en base anterior. 

gasto_con_pasajes_2020 <- left_join(cuenta_viajes, cuenta_pasajes, by="anio") 

#gasto anual 1990-2019

gasto_anual<- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/gasto_tur_exc_pasajes_1990_2019_anual.xlsx") 

#gasto anual 1990 a anio_ref, con pasajes y lim

gasto_con_pasajes_completa <- gasto_anual %>% 
  select(-c(ends_with("vis"))) %>% 
  bind_rows(gasto_con_pasajes_2020) %>% 
  filter (anio <= anio_ref) 
 
rm(cuenta_pasajes, gasto_con_pasajes_2020)

# ARMADO SERIE TRIM PAIS

#datos 2020  y mas, paso a millones.  

gasto_pais_2020 <- cuenta_viajes_ori %>% 
  filter( resumen_viajero == "Turistas", anio <= anio_ref) %>% 
  group_by(anio, trim, residencia, pais_agrupado) %>% 
  summarise(gasto = sum(gasto_total)/1000000) %>% 
  ungroup()

# SERIE PAIS RECEPTIVO:

#dato 2020 y mas: 

gasto_pais_2020_rec <- gasto_pais_2020 %>% 
  filter(residencia =="NR") %>% 
  select(-residencia)
  
#levanto datos_gasto por pais (95-2019), para dato 2019 y añado lo de 2020 y mas
#está en millones. 

gasto_pais_r <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gasto_1995_pais_ancho.xlsx", sheet ="receptivo") %>% 
  pivot_longer(cols = -c(anio,trim), 
               names_to = c("pais_agrupado"),
               values_to = "gasto") %>% 
  mutate(anio = as.integer(anio)) %>% 
  bind_rows(gasto_pais_2020_rec) %>% 
  arrange(anio, trim, pais_agrupado) 

# SERIE PAIS EMISIVO:

#dato 2020 y mas: 

gasto_pais_2020_emi <- gasto_pais_2020 %>% 
  filter(residencia =="R") %>% 
  select(-residencia)

#levanto datos_gasto por pais (95-2019), para dato 2019 y añado lo de 2020 y mas
#está en millones. 

gasto_pais_e <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gasto_1995_pais_ancho.xlsx", sheet ="emisivo") %>% 
  pivot_longer(cols = -c(anio,trim), 
               names_to = c("pais_agrupado"),
               values_to = "gasto") %>% 
  mutate(anio = as.integer(anio)) %>% 
  bind_rows(gasto_pais_2020_emi) %>% 
  arrange(anio, trim, pais_agrupado) 

#SERIE PAIS ANUAL(EN MILLONES)

gasto_pais_e_anual <- gasto_pais_e %>% 
  group_by(anio, pais_agrupado) %>% 
  summarise(gasto_e = sum(gasto))

gasto_pais_r_anual <- gasto_pais_r %>% 
  group_by(anio, pais_agrupado) %>% 
  summarise(gasto_r = sum(gasto)) %>% 
  ungroup()

```

```{r receptivo gasto}

#seleccion para tabla gasto con pasajes exc_10 años. receptivo

tabla_gasto_compl_rec <- gasto_con_pasajes_completa %>% 
  filter (anio >= anio_ref-10) %>% 
  select(c(anio, starts_with("receptivo"))) %>% 
  select(-c(ends_with("lim"))) %>% 
  adorn_totals("col", name = "gasto_total") %>% 
  mutate (var_interanual_total = tasa_variacion(gasto_total),
          var_interanual_p = tasa_variacion(receptivo_p),
          var_interanual_tur = tasa_variacion(receptivo_tur),
          var_interanual_exc = tasa_variacion(receptivo_exc),
          ) %>% 
  arrange(anio) %>% 
  relocate (gasto_total, .after = anio) %>% 
  relocate (var_interanual_total, .after =gasto_total) %>% 
  relocate (var_interanual_p, .after = receptivo_p) %>% 
  relocate (var_interanual_tur, .after = receptivo_tur)%>% 
  relocate (var_interanual_exc, .after = receptivo_exc)
          
var_prepandemia_gasto_tur <- last(tabla_gasto_compl_rec$receptivo_tur)/ tabla_gasto_compl_rec$receptivo_tur[tabla_gasto_compl_rec$anio == 2019] - 1

var_prepandemia_gasto_tot <- last(tabla_gasto_compl_rec$gasto_total)/ tabla_gasto_compl_rec$gasto_total[tabla_gasto_compl_rec$anio == 2019] - 1

```


En cuanto al gasto turístico de `r as.character(anio_ref)`, el de los turistas no residentes tuvo 
`r ifelse(last(tabla_gasto_compl_rec$var_interanual_tur)>0,"un aumento ","una caída")` interanual de un 
`r format(round(100 * abs(last(tabla_gasto_compl_rec$var_interanual_tur)), 1),decimal.mark = ",",big.mark = ".")`%, pasando a ser de `r lbl_money(last(tabla_gasto_compl_rec$receptivo_tur), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')`[^nota_ingresos]. Por su parte, el gasto de los excursionistas fue de `r lbl_money(last(tabla_gasto_compl_rec$receptivo_exc), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')` (`r format(round(100 * last(tabla_gasto_compl_rec$var_interanual_exc), 1),decimal.mark = ",",big.mark = ".")`% i.a.), mientras que el gasto en pasajes[^nota_pasajes] alcanzó los `r lbl_money(last(tabla_gasto_compl_rec$receptivo_p), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')` (`r format(round(100 * last(tabla_gasto_compl_rec$var_interanual_p), 1),decimal.mark = ",",big.mark = ".")`% i.a). 

[^nota_ingresos]: En este apartado se pretende realizar un análisis de los ingresos del turismo receptivo en tanto generador de divisas en el país. No
se realiza un análisis del consumo real de bienes y servicios de turismo receptivo, el cual requeriría una estimación del gasto medido
en moneda local a precios constantes. Este último enfoque excede el alcance del presente capítulo.

[^nota_pasajes]: Abarca los servicios relacionados con el transporte internacional (aéreo, marítimo y terrestre) de no residentes por medios de transporte
residentes. Además de los pasajes, se incluyen los cargos por exceso de equipaje, vehículos u otros efectos personales que trae
el pasajero y los gastos en alimentos, bebidas u otros incurridos a bordo de los medios de transporte.

Así, los ingresos económicos totales por turismo receptivo
(que incluye al gasto de los turistas no residentes, los excursionistas no residentes y el
gasto en pasajes) en el año `r as.character(anio_ref)` alcanzó los 
`r lbl_money(last(tabla_gasto_compl_rec$gasto_total), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')`, implicando `r ifelse(last(tabla_gasto_compl_rec$var_interanual_total)>0,"un aumento ","una caída")` de `r format(round(100 * abs(last(tabla_gasto_compl_rec$var_interanual_total)), 1),decimal.mark = ",",big.mark = ".")`% respecto al año anterior.

En comparación con 2019, el gasto de los turistas no residentes `r ifelse(var_prepandemia_gasto_tur > 0, "aumentó", "cayó")` un `r format(round(100 * abs (var_prepandemia_gasto_tur), 1),decimal.mark = ",",big.mark = ".")`%, en tanto el gasto total por turismo receptivo lo hizo en un `r format(round(100 * abs (var_prepandemia_gasto_tot), 1),decimal.mark = ",",big.mark = ".")`%.

```{r ti7}

ti7 <- tabla_gasto_compl_rec %>% 
gt() %>% 
gt_theme_dnmye()%>% 
cols_label(
 anio = md("Año"),
 gasto_total = md("Gasto turístico total"),
 receptivo_p = md("Gasto en pasajes"),
 receptivo_tur = md("Gasto de turistas no residentes"),
 receptivo_exc = md("Gasto de excursionistas no residentes"),
 var_interanual_total = md("**Variación interanual (%)**"),
 var_interanual_tur = md("**Variación interanual (%)**"),
 var_interanual_exc = md("**Variación interanual (%)**"), 
 var_interanual_p = md("**Variación interanual (%)**")) %>% 
fmt_number(columns  = c(2,4,6,8), sep_mark = ".", dec_mark = ",", decimals = 1,  scale_by = 0.000001) %>% 
fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>% 
tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
tab_caption(glue("Gasto de turistas y excursionistas no residentes y gasto en pasajes por año, en millones de US$. Total país. Años {anio_ref-10}-{anio_ref}."))

ti7

```

<br>

El siguiente gráfico muestra un ascenso del gasto turístico hasta 1998, donde comienza un incipiente descenso, 
hasta la abrupta caída en 2002. Al año siguiente presenta una línea de ascenso hasta 2011, solo interrumpida por la caída del año 2009.  

En 2022, se observa un fuerte crecimiento posterior a la caída por la pandemia en 2020 y 2021, tanto debido al gasto de turistas de países limítrofes como no limítrofes.  

Desde el año 2003, el gasto turístico estuvo mayormente explicado por el de los
turistas extranjeros residentes en países no limítrofes, ya que éste representaba más del
50% del gasto total en todos los años, diferenciándose de la década del noventa, donde tenían una participación un poco menor a los residentes en países limítrofes. Esta preponderancia prevaleció históricamente, aunque fue menor entre 2012 y 2015, y muy escasa en 2014. 

En tanto, desde 2020, el gasto de turistas de países limítrofes y no limítrofes fue más similar. 

```{r ti8, fig.cap= glue("Gasto de turistas no residentes según lugar de residencia por año. Total país. Años 1990-{anio_ref}."), out.width='100%'}

gasto_lim_rec <- gasto_con_pasajes_completa %>% 
  select(c(anio, starts_with("receptivo_tur"))) %>% 
  pivot_longer(cols = -anio, values_to = "gasto", names_to = "limitrofes") %>% 
  mutate (limitrofes = case_when( limitrofes == "receptivo_tur_lim" ~ "Gasto de turistas de países limítrofes", 
                                  limitrofes == "receptivo_tur_no_lim" ~ "Gasto de turistas de países no limítrofes",
                                  limitrofes == "receptivo_tur"~ "Gasto total de turistas no residentes")) %>% 
  mutate(limitrofes =  str_wrap(limitrofes, 30))



ti8 <- ggplot(gasto_lim_rec, aes(ym(paste(anio, 1, sep = "-")), gasto/1000000, colour = limitrofes)) +   geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
  geom_line() + 
  geom_point()+
  scale_color_dnmye() + 
  scale_x_date(date_breaks = "1 years", date_labels = "%Y", expand = c(.01,.01))+ 
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = "," ))+
  theme_minimal()+
  theme(legend.position = "bottom", 
        axis.text.x = element_text (angle=90),
        plot.caption = ggtext::element_markdown() ) +
  labs(y = "en millones de US$", 
       x = "", 
       color= "",
       caption =  "**Fuente**: DNMyE en base a datos de INDEC." )

ti8

```


```{r texto_ti9}

ti9 <- gasto_pais_r %>% 
  filter(anio == anio_ref) %>% 
  group_by(pais_agrupado) %>% 
  summarise(gasto = sum(gasto)) %>% 
  ungroup() %>%  
  mutate (porc = gasto/sum(gasto))

texto_ti9 <- ti9 %>% 
  arrange (-porc)

ti9 <- ti9 %>% 
  mutate( pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")))




```


El ascenso del gasto turístico del año `r as.character(anio_ref)` se observa en todos los países. Los turistas de `r texto_ti9[1,"pais_agrupado"]` fueron los que tuvieron un gasto mayor (`r lbl_money(first(texto_ti9$gasto), decimales = 1, dolar = T, sufijo = 'millones')`), seguidos de  `r texto_ti9[2,"pais_agrupado"]` con un gasto de `r lbl_money(pull(texto_ti9[2,"gasto"]), decimales = 1, dolar = T, sufijo = 'millones')` y `r texto_ti9[3,"pais_agrupado"]`, con `r lbl_money(pull(texto_ti9[3,"gasto"]), decimales = 1, dolar = T, sufijo = 'millones')`.

```{r ti9a,fig.cap=glue("Gasto en US$ de turistas no residentes por lugar de residencia. Distribución porcentual. Año {anio_ref}.") }


graf_ti9 <- ggplot(ti9, aes(x= pais_agrupado, y = porc)) +   
geom_col(fill = "#50B8B1")+
geom_label(aes(label = scales::label_percent(decimal.mark = ",", accuracy = 0.1 )(porc)), size = 2.5)+
scale_y_continuous(labels = scales::label_percent(scale = 100, decimal.mark = ",")) + 
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (size =9, angle = 40, vjust = 0.5),
      axis.text.y = element_text(size = 12),
      legend.text = element_text (size =10),
      plot.caption = ggtext::element_markdown()) +
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de INDEC." )

graf_ti9

```


```{r ti9b}

#gasto por pais (ya está en millones).

tabla_gasto_pais_r <- gasto_pais_r %>% 
  filter(anio == 2019 | anio == anio_ref | anio == anio_ref -1) %>% 
  group_by(anio, pais_agrupado) %>% 
  summarise(gasto=sum(gasto)) %>% 
  ungroup() %>% 
  mutate(var_ia = tasa_variacion(gasto, periodo = 9), #9 paises, 
         var_2019 = tasa_variacion(gasto, periodo = 9*2)) %>%  #idem, vs 2019 años 
    filter(anio == anio_ref) %>% 
  select(-anio) %>% 
  mutate(pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")))



ti9b <- gt(tabla_gasto_pais_r) %>% 
  gt_theme_dnmye() %>% 
  cols_label(
  pais_agrupado = md("País de residencia"),  
  gasto = md("**Gasto Total**"),
  var_ia = md(	"**Variación interanual (%)**"), 
  var_2019 = md(	"**Variación vs. 2019 (%)**")) %>%  
  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_caption(glue("Gasto de turistas no residentes por lugar de residencia, en millones de US$. Total país. Año {anio_ref}."))

ti9b


```


```{r gasto por viaje y diario}

#gasto por viaje

#preparo tabla receptivo y emisivo. 

tur_gasto_anual_pais <- receptivo_anual_pais %>% #turistas_rec
  left_join (emisivo_anual_pais, by= c("anio", 
                                       "pais_agrupado" = "destino_agrup")) %>% #turistas_e
  mutate(balance_tur = viajes_turistas-turistas_e ) %>% #balance turistas
  left_join(gasto_pais_r_anual) %>% #en millones
  left_join(gasto_pais_e_anual) %>% #en millones
  mutate(balance_gasto = gasto_r-gasto_e, 
         gasto_viaje_r = gasto_r* 1000000/viajes_turistas, #tabla estaba en millones
         gasto_viaje_e = gasto_e* 1000000/turistas_e) #tabla estaba en millones
  

#tabla gasto por viaje 10 años. 

tabla_gasto_viaje_anual_pais <- tur_gasto_anual_pais %>% 
  filter(anio <= anio_ref, anio >= anio_ref-10) %>% 
  select(anio, pais_agrupado, starts_with("gasto_viaje")) %>% 
  mutate (var_r = tasa_variacion(gasto_viaje_r, periodo = 9),
          var_e = tasa_variacion(gasto_viaje_e, periodo = 9)) %>% 
  pivot_wider (names_from = pais_agrupado,
               values_from = c(gasto_viaje_r, var_r, gasto_viaje_e, var_e),
               names_vary = "slowest") 


# con subtotal pais por anio: 

tabla_gasto_viaje_anual_pais_compl <- tur_gasto_anual_pais %>% 
  filter(anio <= anio_ref, anio >= anio_ref-10) %>% 
  group_by(anio) %>%
  summarise(gasto_viaje_r = sum(gasto_r* 1000000)/sum(viajes_turistas),
            gasto_viaje_e = sum(gasto_e* 1000000)/sum(turistas_e)) %>% 
  mutate (var_r = tasa_variacion(gasto_viaje_r, periodo = 1),
          var_e = tasa_variacion(gasto_viaje_e, periodo = 1)) %>% 
  left_join(tabla_gasto_viaje_anual_pais)

# receptivo : 

tabla_gasto_viaje_anual_pais_r <- tabla_gasto_viaje_anual_pais_compl %>% 
  select(anio, contains("_r"), -contains("viaje_e"), -contains("var_e"))


# Gasto promedio diario: 
# Levanto serie

gpd_r <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gpd_estadia.xlsx", sheet= "gpd_receptivo") %>% 
  filter(anio <= anio_ref)

var_prepandemia_gv <- last(tabla_gasto_viaje_anual_pais_r$gasto_viaje_r)/ tabla_gasto_viaje_anual_pais_r$gasto_viaje_r[tabla_gasto_viaje_anual_pais_r$anio == 2019] - 1

var_prepandemia_gd <- last(gpd_r$Total)/ gpd_r$Total[gpd_r$anio == 2019] - 1

```

Durante el año `r as.character(anio_ref)`, el gasto promedio por viaje de turista fue de `r lbl_money(last(tabla_gasto_viaje_anual_pais_r$gasto_viaje_r), dolar = T, decimales = 1, sufijo = 'millones')`, con una variación interanual de `r lbl_decimal(last(tabla_gasto_viaje_anual_pais_r$var_r)*100)`% y de `r lbl_decimal(var_prepandemia_gv*100)`% respecto a 2019. 

El gasto promedio por viaje de turista fue mayor en los residentes en Resto del mundo, Resto de América y Estados Unidos y Canadá.


```{r ti10}


ti10 <- gt(tabla_gasto_viaje_anual_pais_r) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**"),
  gasto_viaje_r = md("**Total**"),
  var_r = md(	"Variación interanual (%)"), 
  var_r_Bolivia	= md(	"Variación interanual (%)"),
  var_r_Brasil	= md(	"Variación interanual (%)"),
  var_r_Chile	= md(	"Variación interanual (%)"),
  var_r_Paraguay	= md(	"Variación interanual (%)"),
  var_r_Uruguay	= md(	"Variación interanual (%)"),  
  'var_r_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_r_Resto de América'	= md(	"Variación interanual (%)"),
  var_r_Europa	= md(	"Variación interanual (%)"),
  'var_r_Resto del mundo'	= md(	"Variación interanual (%)"),
  gasto_viaje_r_Bolivia	= md(	"Bolivia"),
  gasto_viaje_r_Brasil	= md(	"Brasil"),
  gasto_viaje_r_Chile	= md(	"Chile"),
  gasto_viaje_r_Paraguay	= md(	"Paraguay"),
  gasto_viaje_r_Uruguay	= md(	"Uruguay"),
  'gasto_viaje_r_EE.UU. y Canadá'	= md(	"EE.UU. y Canadá"),
  'gasto_viaje_r_Resto de América'	= md(	"Resto de América"),
  gasto_viaje_r_Europa	= md(	"Europa"),
  'gasto_viaje_r_Resto del mundo'	= md(	"Resto del mundo")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Gasto promedio en US$ por viaje de turistas no residentes por año según lugar de residencia. Total país. Año {anio_ref-10}-{anio_ref}."))

ti10

      
```

<br>

Este descenso del gasto por viaje se explica por la caída en la estadía promedio del viaje, ya que el gasto promedio diario aumentó. Los tres fenómenos se dan en los turistas de todos los países.

El gasto promedio diario tuvo `r ifelse(last(gpd_r$var_tot)*100>0,"un aumento ","una caída")`interanual de `r lbl_decimal(abs(last(gpd_r$var_tot)*100))`%. Respecto a 2019, tuvo una variación de `r lbl_decimal(var_prepandemia_gd*100)`% . 

El gasto promedio diario fue mayor en los turistas provenientes de Brasil, EE.UU. y Canadá, seguidos de Resto del Mundo. 

```{r ti11}
ti11 <- gt(gpd_r) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**"),
  var_tot = md(	"Variación interanual (%)"), 
  var_Bolivia	= md(	"Variación interanual (%)"),
  var_Brasil	= md(	"Variación interanual (%)"),
  var_Chile	= md(	"Variación interanual (%)"),
  var_Paraguay	= md(	"Variación interanual (%)"),
  var_Uruguay	= md(	"Variación interanual (%)"),
  'var_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_Resto de América'	= md(	"Variación interanual (%)"),
  var_Europa	= md(	"Variación interanual (%)"),
  'var_Resto del mundo'	= md(	"Variación interanual (%)")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Gasto promedio diario en US$ de turistas no residentes por año según lugar de residencia. Total país. Año {anio_ref-10}-{anio_ref}."))

ti11



```

```{r estadia}

estadia_r <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gpd_estadia.xlsx", sheet= "estadia_receptivo") %>% 
  filter(anio <= anio_ref)

var_prepandemia_estad <- last(estadia_r$Total)/ estadia_r$Total[estadia_r$anio == 2019] - 1
var_estad <- last(estadia_r$Total)/ estadia_r$Total[estadia_r$anio == anio_ref-1] - 1
 
  
```

<br>

La estadía promedio de los viajes de turistas no residentes en el año `r as.character(anio_ref)` fue de `r lbl_decimal(last(estadia_r$Total))` días, con una variación interanual de `r lbl_decimal(var_estad*100)`%. Cabe señalar que esta caída se debe a que 2021 fue un año atípico en relación a la estadía promedio debido a las
medidas establecidas en función de la pandemia. Los no residentes que tenían permitido el ingreso eran los de nacionalidad argentina o quienes tenían familiares directos en el país, lo cual tuvo como consecuencia un cambio en el perfil del turista no residente. 

En tanto, se observa un incremento de `r lbl_decimal(var_prepandemia_estad*100)`% al comparar con la estadía promedio del año 2019, la cual venía en línea con la tendencia histórica.

Los turistas que residen en Europa, Resto del mundo y Resto de América  han sido los que han tenido estadías más prolongadas en el país. 

```{r ti12}

ti12 <- gt(estadia_r) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Estadía promedio (en noches) del viaje de turistas no residentes según lugar de residencia. Total país. Año {anio_ref-10}-{anio_ref}."))

ti12

```
 <br>

### Turismo Emisivo
```{r data_emisivo}

#serie visitantes.

serie_vis_e_actual <- emisivo %>% 
  group_by (anio, tipo_visitante) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup()

#con serie historica:

serie_vis_e <-excursionistas %>% 
  select(anio, excursionistas_e, turistas_e) %>% 
  pivot_longer(cols = -anio, 
               names_to = c("tipo_visitante"),
               values_to = "tur") %>%
  mutate(tipo_visitante= if_else(tipo_visitante == "excursionistas_e", "Excursionistas", "Turistas")) %>% 
  bind_rows(serie_vis_e_actual) %>% 
  pivot_wider (names_from = tipo_visitante,
               values_from = tur) %>% 
  mutate (visitantes = Turistas + Excursionistas,
          var_interanual_vis = tasa_variacion(visitantes),
          var_interanual_tur = tasa_variacion(Turistas),
          var_interanual_exc = tasa_variacion(Excursionistas),
          ) %>% 
  select (c("anio", "visitantes", "var_interanual_vis", "Turistas", "var_interanual_tur","Excursionistas", "var_interanual_exc")) %>% 
  arrange(anio)

var_prepandemia_e <- last(serie_vis_e$Turistas)/ serie_vis_e$Turistas[serie_vis_e$anio == 2019] - 1

```


El total de  viajes de turistas residentes en `r as.character(anio_ref)` fue de `r lbl_percent( last(serie_vis_e$Turistas), decimales =0)`, con `r ifelse(last(serie_vis_e$var_interanual_tur)>0,"un aumento ","una caída")` interanual de un `r format(round(100 * abs (last(serie_vis_e$var_interanual_tur)), 1),decimal.mark = ",",big.mark = ".")`%. En comparación con 2019, `r ifelse(var_prepandemia_e > 0, "aumentó", "cayó")` un `r format(round(100 * abs (var_prepandemia_e), 1),decimal.mark = ",",big.mark = ".")`%.

```{r ti13} 

ti13 <- serie_vis_e %>% 
gt() %>% 
gt_theme_dnmye() %>% 
cols_label(
anio = md("Año"),
visitantes = md("**Visitantes residentes**"),
var_interanual_vis = md("**Variación interanual (%)**"),
Turistas = md("**Turistas residentes**"),
var_interanual_tur = md("**Variación interanual (%)**"),
Excursionistas = md("**Excursionistas residentes**"),
var_interanual_exc = md("**Variación interanual (%)**")) %>% 
fmt_number(columns  = c(2,4,6), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>% 
sub_missing(columns = c(3,5,7), missing_text = "///") %>% 
  tab_source_note(
    source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Viajes de visitantes, turistas y excursionistas residentes por año. Total país. Años {anio_ref-10}-{anio_ref}."))


ti13
```
 <br>


La serie de viajes de turistas residentes muestra una línea general ascendente, con una caída en el año 2002 y un crecimiento sostenido desde entonces, y principalmente entre 2014 y 2017, cuando llegó a 12,2 millones de viajes de turistas,  descendiendo posteriormente.
Los países limítrofes son los destinos mayoritarios en toda la serie, a excepción del año 2021.
En el año 2022 los viajes hacia países limítrofes vuelven a traccionar el crecimiento.

```{r ti14, fig.cap= glue("Viajes de turistas residentes por país de destino principal por año. Total país. Años 1990-{anio_ref}."), out.width='100%'}

emisivo_anual_lim <- emisivo_anual_pais %>% 
  filter (anio <= anio_ref) %>% 
  mutate(limitrofe = case_when(destino_agrup %in% c("Bolivia","Brasil","Chile","Paraguay","Uruguay") ~ "Países limítrofes",
                               TRUE ~ "Países no limítrofes"), 
         anio = ym(paste(anio, 1, sep = "-"))
         ) %>%
  group_by(anio, limitrofe) %>% 
  summarise (tur = sum(turistas_e)/1000000) %>% 
  ungroup() 

emisivo_anual_lim_tot <- emisivo_anual_lim %>% 
  group_by(anio) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup() %>% 
  mutate(limitrofe = "Total viajes de turistas residentes")

emisivo_anual_lim_final <- emisivo_anual_lim %>% 
  rbind(emisivo_anual_lim_tot) 

ti14 <- ggplot(emisivo_anual_lim_final, aes(anio, tur, colour = limitrofe)) +   
  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
  geom_line() + 
  geom_point()+
  scale_color_dnmye() + 
  scale_x_date(date_breaks = "1 years", date_labels = "%Y", expand = c(.01,.01))+ 
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = "," )) + 
  theme_minimal()+
  theme(legend.position = "bottom", 
        axis.text.x = element_text (angle=90),
        plot.caption = ggtext::element_markdown() ) +
  labs(y = "en millones de viajes de turistas", 
       x = "", 
       color= "",
       caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

ti14

```

```{r}
g_1.2 <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo", tipo_visitante == "Turistas", (anio == anio_ref | anio == anio_ref-1)) %>% 
  group_by (anio, destino_agrup) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() 
  

g_1.3_texto_e <- g_1.2 %>% 
  filter (anio == anio_ref) %>% 
  mutate(porc = tur/sum(tur)) %>% 
  arrange (-porc)

  
g_1.2 <- g_1.2 %>% 
  mutate (destino_agrup = as_factor(destino_agrup),
          destino_agrup = fct_relevel(destino_agrup, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")) 
)

```

En el año `r as.character(anio_ref)`, `r g_1.3_texto_e[1,"destino_agrup"]` fue el destino principal del turismo emisivo, con  
`r lbl_int(pull(g_1.3_texto_e[1,"tur"]))` turistas, 
(`r lbl_decimal(pull(g_1.3_texto_e[1,"porc"])*100)`%) seguido por `r g_1.3_texto_e[2,"destino_agrup"]` y  `r g_1.3_texto_e[3,"destino_agrup"]`, con `r 
lbl_int(pull(g_1.3_texto_e[2,"tur"]))` y `r lbl_int(pull(g_1.3_texto_e[3,"tur"]))`, con 
`r lbl_decimal(pull(g_1.3_texto_e[2,"porc"])*100)`% y 
`r lbl_decimal(pull(g_1.3_texto_e[3,"porc"])*100)`% respectivamente.  
  
```{r ti16, fig.cap=glue("Viajes de turistas residentes por país de destino principal. Distribución porcentual. Año {anio_ref}.")}


g_1.3 <- g_1.2 %>% 
  filter (anio == anio_ref) %>% 
  mutate(porc = tur/sum(tur)) %>% 
  arrange (-porc)
graf_1.3 <- ggplot(g_1.3, aes(x= destino_agrup, y = porc)) +   
geom_col(fill = "#50B8B1")+
geom_label(aes(label = scales::label_percent(decimal.mark = ",", accuracy = 0.1 )(porc)), size = 2.5)+
scale_y_continuous(labels = scales::label_percent(scale = 100, decimal.mark = ",")) + 
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (size =9, angle = 40, vjust = 0.5),
      axis.text.y = element_text(size = 12),
      legend.text = element_text (size =10),
      plot.caption = ggtext::element_markdown()) +
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

graf_1.3

```

El gran incremento del año `r as.character(anio_ref)` respecto al año anterior se aprecia en los viajes a todos los destinos. 


```{r ti15, fig.cap= glue("Viajes de turistas residentes por país de destino principal por año. Total país. Años {anio_ref-1}-{anio_ref}.")}

graf_1.2 <- ggplot(g_1.2, aes(x= destino_agrup, y = round(tur))) +   
geom_col(aes(fill = as_factor(anio)), position = "dodge") +
geom_label(aes(label = format(tur, big.mark = ".", decimal.mark = ",", digits = 0), group = anio), 
           label.size = 0.15,
           label.padding =  unit(0.05, "lines"),
           position = position_dodge(width = 0.9),
           vjust = -0.05,
           size= 2.5)+
scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = ",")) +
scale_fill_dnmye()+
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (angle = 40, vjust = 0.8),
      plot.caption = ggtext::element_markdown())+
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de DNM y ETI." )

graf_1.2

```

Al observar la evolución mensual del año `r as.character(anio_ref)` se puede ver una tendencia general de recuperación creciente respecto a 2019. Partiendo de un enero con una caída del 68,1% respecto a 2019, en octubre la variación es del -12,0%, y los dos últimos meses del año del -22,0% y -24,5%. 

En tanto, la variación interanual, aunque es muy alta en todos los meses, es algo menor en los últimos meses del año, debido a la recuperación iniciada en el último trimestre de 2021. 

Casi todos los meses, Brasil fue el destino principal, siendo apenas superado en junio y agosto, por los viajes a Paraguay y Europa respectivamente, y -en mayor medida- por los viajes a Uruguay en diciembre. 

```{r ti17}

#base por mes y pais 

c_1.2_pais <- base_visitantes %>% 
filter (turismo_internac == "Emisivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, mes, destino_agrup) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 108), #9 paises *12 meses
          var = if_else(var == Inf, NA_real_, var))

#por anio y pais

c_1.2_pais_tot <- c_1.2_pais %>% 
  group_by (anio, destino_agrup) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup()

#por anio y pais con tot (var)

c_1.2_pais_con_tot <- c_1.2_pais_tot %>% 
 mutate (var = tasa_variacion(tur,periodo = 9),
         var = if_else(var == Inf, NA_real_, var),
         mes = "Total") %>% 
  bind_rows(c_1.2_pais) %>% 
  pivot_wider (names_from = destino_agrup,
               values_from = c(tur,var),
               names_vary = "slowest") %>% 
  filter(anio == anio_ref) 
  
c_1.2 <- c_1.2_pais %>% 
  group_by (anio, mes) %>%
   summarise (tur = sum(tur)) %>% 
  ungroup() 
 
#total anual
c_1.2_anual <- c_1.2 %>% 
  group_by (anio) %>% 
  summarise (tur = sum(tur)) %>% 
  ungroup() %>% 
  mutate (mes = "Total")

c_1.2 <- c_1.2 %>% 
  bind_rows(c_1.2_anual) %>% 
  arrange(anio, mes) %>% 
  mutate(var_tot = tasa_variacion(tur,periodo = 13), #12 meses + total
         var_tot = if_else(var_tot == Inf, NA_real_, var_tot)
         ) %>% 
  filter(anio == anio_ref) 


#prepandemia:

emisivo_2019 <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo", tipo_visitante == "Turistas", (anio == 2019)) %>% 
  group_by (anio, mes) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  adorn_totals(fill = "Total", name = "2019")

emisivo_anio_ref <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo", tipo_visitante == "Turistas", (anio == anio_ref)) %>% 
  group_by (anio, mes) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  adorn_totals(fill = "Total", name = as.character(anio_ref))

emisivo_2019_var <- bind_rows(emisivo_2019, emisivo_anio_ref) %>% 
  mutate (var_2019 = tasa_variacion(tur,periodo = 13), 
          var_2019 = if_else(var_2019 == Inf, NA_real_, var_2019)) %>% 
  filter(anio == anio_ref) %>% 
  select(-tur) %>% 
  mutate(anio = as.integer(anio))

c_1.2_pais_tot_completo  <-  c_1.2_pais_con_tot %>% 
  left_join(c_1.2) %>% 
  relocate(c(tur, var_tot), .after =  mes) 

#traigo var. 2019:

c_1.2 <- c_1.2 %>%
  left_join(emisivo_2019_var)

c_1.2_pais_tot_completo  <-  c_1.2_pais_con_tot %>% 
  left_join(c_1.2) %>% 
  relocate(c(tur, var_tot, var_2019), .after =  mes) %>% 
  select(-anio)

ti17 <- gt(c_1.2_pais_tot_completo) %>% 
gt_theme_dnmye() %>% 
  cols_label(
  mes = md("**Mes**"),
  tur = md("**Total**"),
  var_tot = md(	"Variación interanual (%)"), 
  var_2019 = md(	"Variación vs. 2019 (%)"), 
  var_Bolivia	= md(	"Variación interanual (%)"),
  var_Brasil	= md(	"Variación interanual (%)"),
  var_Chile	= md(	"Variación interanual (%)"),
  var_Paraguay	= md(	"Variación interanual (%)"),
  var_Uruguay	= md(	"Variación interanual (%)"),
  'var_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_Resto de América'	= md(	"Variación interanual (%)"),
  var_Europa	= md(	"Variación interanual (%)"),
  'var_Resto del mundo'	= md(	"Variación interanual (%)"),
  tur_Bolivia	= md(	"Bolivia"),
  tur_Brasil	= md(	"Brasil"),
  tur_Chile	= md(	"Chile"),
  tur_Paraguay	= md(	"Paraguay"),
  tur_Uruguay	= md(	"Uruguay"),
  'tur_EE.UU. y Canadá'	= md(	"EE.UU. y Canadá"),
  'tur_Resto de América'	= md(	"Resto de América"),
  tur_Europa	= md(	"Europa"),
  'tur_Resto del mundo'	= md(	"Resto del mundo")) %>% 
  fmt_number(columns  = c(2,seq(5,22,2)), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
  tab_source_note(
    source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI."))  %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Viajes de turistas residentes y variación interanual según país de destino principal por mes. Total país. Año {anio_ref}."))

ti17
```
 <br>
```{r}
#probando esto para mejor lectura: 

#mes_pais_tabla <- c_1.2_pais %>% 
#  filter(anio == anio_ref) %>% 
#  mutate(fecha = dmy(paste(1, mes, anio)) ) %>% 
#  group_by(fecha, destino_agrup) %>% 
#  summarise(tur = sum(tur))
#
#mes_pais <- ggplot(mes_pais_tabla, aes(fecha, round(tur), color = destino_agrup)) +   
#  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
#  geom_line() + 
#  geom_point()
#
#
#mes_pais_tabla_lim <- c_1.2_pais %>% 
#  filter(anio == anio_ref) %>% 
#  mutate(limitrofe = case_when(destino_agrup %in% #c("Bolivia","Brasil","Chile","Paraguay","Uruguay") ~ "Países limítrofes",
#                               TRUE ~ "Países no limítrofes"),
#         fecha = dmy(paste(1, mes, anio)) ) %>% 
#  group_by(fecha, limitrofe) %>% 
#  summarise(tur = sum(tur))
#
#mes_pais_lim <- ggplot(mes_pais_tabla_lim, aes(fecha, round(tur), color = limitrofe)) +   
#  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
#  geom_line() + 
#  geom_point()
#
```

```{r}
#via pais

pais_via_e <- base_visitantes %>% 
filter (turismo_internac == "Emisivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, via, destino_agrup) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 3*9), #3 vias *9 paises 
          var = if_else(var == Inf, NA_real_, var)) %>% 
  filter(anio == anio_ref) %>% 
  pivot_wider (names_from = via,
               values_from = c(tur,var),
               names_vary = "slowest") %>% 
  janitor::clean_names() 

#por anio y via

pais_via_tot_e <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo", anio %in% c(anio_ref,anio_ref-1), tipo_visitante == "Turistas") %>% 
  group_by (anio, via) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  mutate (var = tasa_variacion(tur,periodo = 3))  %>% 
  filter(anio == anio_ref) %>% 
  mutate (prop = tur/sum(tur)) %>% 
  pivot_wider (names_from = via,
               values_from = c(tur,var,prop),
               names_vary = "slowest") %>% 
  janitor::clean_names() %>% 
  mutate(destino_agrup= "Total") %>% 
  relocate(destino_agrup, .after =  anio)

#total vias por pais

c_1.2_pais_vias_tot_e <- c_1.2_pais_tot %>% 
  filter(anio == anio_ref) %>% 
  janitor::adorn_totals(fill ="Total") %>% 
  arrange(anio, destino_agrup) %>% 
  select(-anio)

#agrego totales

pais_via_con_tot_e <- pais_via_tot_e %>% 
  bind_rows(pais_via_e) %>% 
  left_join(c_1.2_pais_vias_tot_e) %>% 
  relocate(tur, .after = destino_agrup) %>% 
  select(-anio) %>% 
  mutate(prop_aereo =tur_aereo/tur,
         prop_fluvial_maritimo = tur_fluvial_maritimo/tur,
         prop_terrestre =tur_terrestre/tur) 

# var 2019:

pais_2019_e <- base_visitantes %>% 
  filter (turismo_internac == "Emisivo", tipo_visitante == "Turistas", (anio == 2019)) %>% 
  group_by (anio, destino_agrup, via) %>% 
  summarise (tur = sum(casos_ponderados)) %>% 
  ungroup() %>% 
  pivot_wider ( names_from = via,
               values_from = tur) %>%
  adorn_totals(c("row", "col"), fill = "Total") %>% 
  select(-anio) %>% 
  clean_names()
  
via_pais_con_v19_e <- pais_via_con_tot_e %>% 
  left_join(pais_2019_e) %>% 
  mutate(var_19 = tur/total-1, 
         var_19_aereo = tur_aereo/aereo-1, 
         var_19_maritimo = tur_fluvial_maritimo/fluvial_maritimo-1, 
         var_19_terrestre = tur_terrestre/terrestre-1
         ) %>%
  relocate (var_19, .after = tur) %>%
  relocate (var_19_aereo, .after = var_aereo) %>%
  relocate (var_19_maritimo, .after = var_fluvial_maritimo) %>%
  relocate (var_19_terrestre, .after = var_terrestre) %>% 
  select(-c(total, aereo,fluvial_maritimo,terrestre))

```
Los viajes hacia Europa, Resto de América y Uruguay han sido los que más se han recuperado, en comparación con anterioridad a la pandemia (2019). 

En cuanto a los medios de transporte, los viajes por medios fluviales y marítimos han sido los que tuvieron una recuperación mayor frente a 2019, seguidos por los aéreos. En cambio, al observar la variación interanual, los realizados por medios terrestres tuvieron un crecimiento mucho mayor, igualando casi en términos absolutos a los viajes por vía aérea, los cuales, al igual que en 2021, han sido los principales.

```{r ti18}

ti18<- gt(via_pais_con_v19_e) %>% 
  gt_theme_dnmye(var_total = destino_agrup) %>% 
  tab_spanner(label = "Aéreo", columns = ends_with("aereo")) %>% 
  tab_spanner(label = "Fluvial/marítimo", columns = ends_with("maritimo")) %>% 
  tab_spanner(label = "Terrestre", columns = ends_with("terrestre")) %>% 
  cols_label(
    destino_agrup  = md("Destino principal"),
    tur = md("Total"),
    var_19 = md("Variación vs. 2019 (%)"), 
    var_19_aereo = md("Variación vs. 2019 (%)"), 
    var_19_maritimo = md("Variación vs. 2019 (%)"), 
    var_19_terrestre = md("Variación vs. 2019 (%)"),
    tur_aereo	= md(	"Turistas"),
    var_aereo	= md(	"Variación interanual (%)"),
    prop_aereo	= md(	"Participación en el total (%)"),
    tur_fluvial_maritimo	= md(	"Turistas"),
    var_fluvial_maritimo	= md(	"Variación interanual (%)"),
    prop_fluvial_maritimo	= md(	"Participación en el total (%)"),
    tur_terrestre	= md(	"Turistas"),
    var_terrestre	= md(	"Variación interanual (%)"),
    prop_terrestre	= md(	"Participación en el total (%)")) %>% 
  fmt_number(columns  = c(2,seq(4,12,4)), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
  tab_source_note(
    source_note = md("**Fuente**: DNMyE en base a datos de DNM y ETI.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Viajes de turistas residentes por medio de transporte según año y país de destino principal. Total país. Año {anio_ref}."))

ti18

```

<br>

```{r tabla_gasto}


#seleccion para tabla gasto con pasajes exc_10 años. emisivo

tabla_gasto_compl_emi <- gasto_con_pasajes_completa %>% 
  filter (anio >= anio_ref-10) %>% 
  select(c(anio, starts_with("emisivo"))) %>% 
  select(-c(ends_with("lim"))) %>% 
  adorn_totals("col", name = "gasto_total") %>% 
  mutate (var_interanual_total = tasa_variacion(gasto_total),
          var_interanual_p = tasa_variacion(emisivo_p),
          var_interanual_tur = tasa_variacion(emisivo_tur),
          var_interanual_exc = tasa_variacion(emisivo_exc),
          ) %>% 
  arrange(anio) %>% 
  relocate (gasto_total, .after = anio) %>% 
  relocate (var_interanual_total, .after =gasto_total) %>% 
  relocate (var_interanual_p, .after = emisivo_p) %>% 
  relocate (var_interanual_tur, .after = emisivo_tur)%>% 
  relocate (var_interanual_exc, .after = emisivo_exc)
          
var_prepandemia_gasto_tur_e <- last(tabla_gasto_compl_emi$emisivo_tur)/ tabla_gasto_compl_emi$emisivo_tur[tabla_gasto_compl_emi$anio == 2019] - 1

var_prepandemia_gasto_tot_e <- last(tabla_gasto_compl_emi$gasto_total)/ tabla_gasto_compl_emi$gasto_total[tabla_gasto_compl_emi$anio == 2019] - 1


```

<br>

En cuanto al gasto, el realizado por los turistas residentes tuvo 
`r ifelse(last(tabla_gasto_compl_emi$var_interanual_tur)>0,"un aumento ","una caída")` interanual de un 
`r format(round(100 * abs(last(tabla_gasto_compl_emi$var_interanual_tur)), 1),decimal.mark = ",",big.mark = ".")`%, pasando a ser de `r lbl_money(last(tabla_gasto_compl_emi$emisivo_tur), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')`. Por su parte, el gasto de los excursionistas, fue de `r lbl_money(last(tabla_gasto_compl_emi$emisivo_exc), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')` (`r format(round(100 * last(tabla_gasto_compl_emi$var_interanual_exc), 1),decimal.mark = ",",big.mark = ".")`% i.a.), mientras que el gasto en pasajes alcanzó los `r lbl_money(last(tabla_gasto_compl_emi$emisivo_p), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')` (`r format(round(100 * abs(last(tabla_gasto_compl_emi$var_interanual_p)), 1),decimal.mark = ",",big.mark = ".")`% i.a). 

Así, los egresos económicos totales por turismo emisivo
(que incluye al gasto de los turistas y excursionistas residentes y el
gasto en pasajes) en el año `r as.character(anio_ref)` alcanzaron los 
`r lbl_money(last(tabla_gasto_compl_emi$gasto_total), decimales = 1, dolar = T, escala = 10^6, sufijo = 'millones')`, implicando `r ifelse(last(tabla_gasto_compl_emi$var_interanual_total)>0,"un aumento ","una caída")` de `r format(round(100 * abs(last(tabla_gasto_compl_emi$var_interanual_total)), 1),decimal.mark = ",",big.mark = ".")`% respecto al año anterior.

En comparación con 2019, el gasto de los turistas residentes `r ifelse(var_prepandemia_gasto_tur > 0, "aumentó", "cayó")` un `r format(round(100 * abs (var_prepandemia_gasto_tur_e), 1),decimal.mark = ",",big.mark = ".")`%, en tanto los egresos totales por turismo emisivo lo hicieron en un `r format(round(100 * abs (var_prepandemia_gasto_tot_e), 1),decimal.mark = ",",big.mark = ".")`%.

```{r ti19}

ti19 <- tabla_gasto_compl_emi %>% 
gt() %>% 
gt_theme_dnmye()%>% 
cols_label(
 anio = md("Año"),
 gasto_total = md("Gasto turístico total"),
 emisivo_p = md("Gasto en pasajes"),
 emisivo_tur = md("Gasto de turistas residentes"),
 emisivo_exc = md("Gasto de excursionistas residentes"),
 var_interanual_total = md("**Variación interanual (%)**"),
 var_interanual_tur = md("**Variación interanual (%)**"),
 var_interanual_exc = md("**Variación interanual (%)**"), 
 var_interanual_p = md("**Variación interanual (%)**")) %>% 
 fmt_number(columns  = c(2,4,6,8), sep_mark = ".", dec_mark = ",", decimals = 1, scale_by = 0.000001) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>% 
tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Gasto de turistas y excursionistas residentes y gasto en pasajes por año, en millones de US$. Total país. Años {anio_ref-10}-{anio_ref}."))

ti19

```

<br>

Tal como se observa en el siguiente gráfico, el gasto en dólares de turistas residentes en sus viajes al exterior presenta un crecimiento sostenido en la década del noventa, descendiendo en 2001 y 2002 y volviendo a aumentar entre 2003 y 2017. A partir de entonces, comienza a descender. 
Luego de la gran caída debido a la pandemia en 2020 y 2021, en 2022 comienza a ascender nuevamente. 

El gasto según destino limítrofe y no limítrofe ha sido relativamente parejo desde 1990, excepto en 2011 y 2013, donde es más alto en los primeros. En cambio, en 2018 y 2019 la diferencia se agranda en favor de los destinos no limítrofes. Aunque esto cambia en 2020, desde 2021 nuevamente el gasto en países no limítrofes vuelve a ser el más importante.      

```{r ti20, fig.cap= glue("Gasto de turistas residentes según lugar de destino por año. Total país. Años 1990-{anio_ref}."), out.width='100%'}

gasto_lim_emi <- gasto_con_pasajes_completa %>% 
  select(c(anio, starts_with("emisivo_tur"))) %>% 
  pivot_longer(cols = -anio, values_to = "gasto", names_to = "limitrofes") %>% 
  mutate (limitrofes = case_when( limitrofes == "emisivo_tur_lim" ~ "Gasto en países limítrofes", 
                                  limitrofes == "emisivo_tur_no_lim" ~ "Gasto en países no limítrofes",
                                  limitrofes == "emisivo_tur"~ "Gasto total de turistas residentes"))



ti20 <- ggplot(gasto_lim_emi, aes(ym(paste(anio, 1, sep = "-")), gasto/1000000, colour = limitrofes)) +   
  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
  geom_line() + 
  geom_point()+
  scale_color_dnmye() + 
  scale_x_date(date_breaks = "1 years", date_labels = "%Y", expand = c(.01,.01))+ 
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = "," )) + 
  theme_minimal()+
  theme(legend.position = "bottom", 
        axis.text.x = element_text (angle=90),
        plot.caption = ggtext::element_markdown() ) +
  labs(y = "en millones de US$", 
       x = "", 
       color= "",
       caption =  "**Fuente**: DNMyE en base a datos de INDEC." )

ti20

```

```{r}

ti21 <- gasto_pais_e %>% 
  filter(anio == anio_ref) %>% 
  group_by(pais_agrupado) %>% 
  summarise(gasto = sum(gasto)) %>% 
  ungroup() %>%  
  mutate (porc = gasto/sum(gasto))

texto_ti21 <- ti21 %>% 
  arrange (-porc)

ti21 <- ti21 %>% 
  mutate(pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")))

```

 En el año `r as.character(anio_ref)`, los turistas con destino `r texto_ti21[1,"pais_agrupado"]` fueron los que tuvieron un gasto mayor (`r lbl_money(first(texto_ti21$gasto), decimales = 1, dolar = T, sufijo = 'millones')`), seguidos de los que viajaron hacia `r texto_ti21[2,"pais_agrupado"]` y  `r texto_ti21[3,"pais_agrupado"]`.

El crecimiento del gasto turístico emisivo del año `r as.character(anio_ref)` se observa en todos los destinos. 

```{r ti21,fig.cap=glue("Gasto en US$ de turistas residentes por lugar de destino. Distribución porcentual. Año {anio_ref}.") }
graf_ti21 <- ggplot(ti21, aes(x= pais_agrupado, y = porc)) +   
geom_col(fill = "#50B8B1")+
geom_label(aes(label = scales::label_percent(decimal.mark = ",", accuracy = 0.1 )(porc)), size = 2.5)+
scale_y_continuous(labels = scales::label_percent(scale = 100, decimal.mark = ",")) + 
theme_minimal()+
theme(legend.position = "bottom", 
      axis.text.x =element_text (size =9, angle = 40, vjust = 0.5),
      axis.text.y = element_text(size = 12),
      legend.text = element_text (size =10),
      plot.caption = ggtext::element_markdown()) +
labs(y = "", 
     x = "", 
     color= "",
     fill="",
     caption =  "**Fuente**: DNMyE en base a datos de INDEC." )
#gasto por pais (ya está en millones).

tabla_gasto_pais_e <- gasto_pais_e %>% 
  filter(anio == 2019 | anio == anio_ref | anio == anio_ref -1) %>% 
  group_by(anio, pais_agrupado) %>% 
  summarise(gasto=sum(gasto)) %>% 
  ungroup() %>% 
  mutate(var_ia = tasa_variacion(gasto, periodo = 9), #9 paises, 
         var_2019 = tasa_variacion(gasto, periodo = 9*2)) %>%  #idem, vs 2019 años 
    filter(anio == anio_ref) %>% 
  select(-anio) %>% 
  mutate(pais_agrupado = as_factor(pais_agrupado),
          pais_agrupado = fct_relevel(pais_agrupado, c("Bolivia","Brasil",
                                                       "Chile", "Paraguay", 
                                                       "Uruguay",
                                                       "EE.UU. y Canadá",
                                                       "Resto de América",
                                                       "Europa", 
                                                       "Resto del mundo")))



ti21b <- gt(tabla_gasto_pais_e) %>% 
  gt_theme_dnmye() %>% 
  cols_label(
  pais_agrupado = md("País de residencia"),  
  gasto = md("**Gasto Total**"),
  var_ia = md(	"**Variación interanual (%)**"), 
  var_2019 = md(	"**Variación vs. 2019 (%)**")) %>%  
  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_caption(glue("Gasto de turistas residentes por lugar de residencia, en millones de US$. Total país. Año {anio_ref}."))

ti21b

graf_ti21

```


```{r}

# gasto viaje

tabla_gasto_viaje_anual_pais_e <- tabla_gasto_viaje_anual_pais_compl %>% 
  select(anio, contains("_e"), -contains("viaje_r"), -contains("var_r"))

# Gasto promedio diario: 

#Levanto serie

gpd_e <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gpd_estadia.xlsx", sheet= "gpd_emisivo") %>% 
  filter(anio <= anio_ref)

var_prepandemia_gv_e <- last(tabla_gasto_viaje_anual_pais_e$gasto_viaje_e)/ tabla_gasto_viaje_anual_pais_e$gasto_viaje_e[tabla_gasto_viaje_anual_pais_e$anio == 2019] - 1

var_prepandemia_gd_e <- last(gpd_e$Total)/ gpd_e$Total[gpd_e$anio == 2019] - 1


```


El gasto promedio por viaje de turista fue de `r lbl_money(last(tabla_gasto_viaje_anual_pais_e$gasto_viaje_e),dolar = T, decimales = 1)`, con una variación interanual de `r lbl_decimal(last(tabla_gasto_viaje_anual_pais_e$var_e)*100)`%, siendo mayor en los turistas residentes que viajaron a Resto del mundo, Europa y EE.UU. y Canadá. 

En relación a 2019 tuvo una variación de `r lbl_decimal(var_prepandemia_gv_e*100)`%. 

```{r ti22}

ti22 <- gt(tabla_gasto_viaje_anual_pais_e) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**"),
  gasto_viaje_e = md("**Total**"),
  var_e = md(	"Variación interanual (%)"), 
  var_e_Bolivia	= md(	"Variación interanual (%)"),
  var_e_Brasil	= md(	"Variación interanual (%)"),
  var_e_Chile	= md(	"Variación interanual (%)"),
  var_e_Paraguay	= md(	"Variación interanual (%)"),
  var_e_Uruguay	= md(	"Variación interanual (%)"),
  'var_e_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_e_Resto de América'	= md(	"Variación interanual (%)"),
  var_e_Europa	= md(	"Variación interanual (%)"),
  'var_e_Resto del mundo'	= md(	"Variación interanual (%)"),
  gasto_viaje_e_Bolivia	= md(	"Bolivia"),
  gasto_viaje_e_Brasil	= md(	"Brasil"),
  gasto_viaje_e_Chile	= md(	"Chile"),
  gasto_viaje_e_Paraguay	= md(	"Paraguay"),
  gasto_viaje_e_Uruguay	= md(	"Uruguay"),
  'gasto_viaje_e_EE.UU. y Canadá'	= md(	"EE.UU. y Canadá"),
  'gasto_viaje_e_Resto de América'	= md(	"Resto de América"),
  gasto_viaje_e_Europa	= md(	"Europa"),
  'gasto_viaje_e_Resto del mundo'	= md(	"Resto del mundo")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Gasto promedio en US$ por viaje de turistas residentes por año según país de destino principal. Total país. Año {anio_ref-10}-{anio_ref}."))

ti22
```

<br>

Tal como sucedió con el turismo receptivo, esto se debe principalmente a la caída de la estadía promedio del viaje, ya que el gasto promedio diario,  tuvo un aumento de un `r lbl_decimal(last(gpd_e$var_tot)*100)` % interanual. En tanto, con respecto a 2019, tuvo una variación de `r lbl_decimal((var_prepandemia_gd_e*100))`%. 

El gasto promedio diario fue mayor en los que tuvieron como destino principal Resto del Mundo, EE.UU. y Canadá y Resto de América.

```{r ti23}

ti23 <- gt(gpd_e) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**"),
  var_tot = md(	"Variación interanual (%)"), 
  var_Bolivia	= md(	"Variación interanual (%)"),
  var_Brasil	= md(	"Variación interanual (%)"),
  var_Chile	= md(	"Variación interanual (%)"),
  var_Paraguay	= md(	"Variación interanual (%)"),
  var_Uruguay	= md(	"Variación interanual (%)"),
  'var_EE.UU. y Canadá'	= md(	"Variación interanual (%)"),
  'var_Resto de América'	= md(	"Variación interanual (%)"),
  var_Europa	= md(	"Variación interanual (%)"),
  'var_Resto del mundo'	= md(	"Variación interanual (%)")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Gasto promedio diario en US$ de turistas residentes por año según país de destino principal. Total país. Año {anio_ref-10}-{anio_ref}."))

ti23

```

```{r}
estadia_e <- read_file_srv("/DataDNMYE/turismo_internacional/bases_proceso/series/serie_gpd_estadia.xlsx", sheet= "estadia_emisivo") %>% 
  filter(anio <= anio_ref)

var_prepandemia_estad_e <- last(estadia_e$Total)/ estadia_e$Total[estadia_e$anio == 2019] - 1
var_estad_e <- last(estadia_e$Total)/ estadia_e$Total[estadia_e$anio == anio_ref-1] - 1

```

<br>

La estadía promedio de los viajes de turistas residentes en el año `r as.character(anio_ref)` fue de `r lbl_decimal(last(estadia_e$Total))` días, con una variación interanual de `r lbl_decimal(var_estad_e*100)`%  y de `r lbl_decimal(var_prepandemia_estad_e*100)`% respecto a la  estadía de 2019, la cual venía en línea con la tendencia histórica. 

Las estadías en Europa, Resto del mundo y, en menor medida, Estados Unidos y Canadá,  han sido las más prolongadas y, tal como vimos, los turistas en esos destinos han sido los que han tenido un gasto por viaje mayor. Los países más lejanos suelen presentar históricamente estadías más prolongadas.

```{r ti24}

ti24 <- gt(estadia_e) %>% 
  gt_theme_dnmye() %>%  
  cols_label(
  anio = md("**Año**")) %>% 
 fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>%  tab_source_note(source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% tab_options(container.height = 600,
              container.overflow.y = T) %>% 
  tab_caption(glue("Estadía promedio (en noches) del viaje de turistas residentes según lugar de destino principal. Total país. Año {anio_ref-10}-{anio_ref}."))

ti24



```


### Balance de viajes de turistas y gasto

```{r}

#tabla balance por pais 10 años. 

tabla_balance_anual_pais <- tur_gasto_anual_pais %>% 
  select(anio, pais_agrupado, starts_with("balance")) %>% 
  filter(anio <= anio_ref, anio >= anio_ref-10) %>% 
  pivot_wider (names_from = pais_agrupado,
               values_from = c(balance_tur, balance_gasto),#balance gasto en millones
               names_vary = "slowest") 

tabla_balance_anual_pais <- tabla_balance_anual_pais %>% 
  rowwise() %>%
  mutate(balance_tur_tot = rowSums(across(contains("tur")))) %>% 
  mutate(balance_gasto_tot = rowSums(across(contains("gasto")))) %>% 
  arrange(anio) %>% 
  relocate(ends_with("tot"),
           .after=anio)


```

En el año `r as.character(anio_ref)`, el balance de viajes de turistas presentó un saldo de `r lbl_int(last(tabla_balance_anual_pais$balance_tur_tot))` viajes. 

Por otro lado, el balance de divisas correspondiente al turismo tuvo un saldo
de `r lbl_money(last(tabla_balance_anual_pais$balance_gasto_tot), dolar = T, decimales = 1, sufijo = 'millones')`. 

```{r ti25}

ti25<- gt(tabla_balance_anual_pais) %>% 
  gt_theme_dnmye() %>% 
  tab_spanner(label = "Total", columns = ends_with("tot")) %>% 
  tab_spanner(label = "Bolivia", columns = ends_with("ia")) %>% 
  tab_spanner(label = "Brasil", columns = ends_with("il")) %>% 
  tab_spanner(label = "Chile", columns = ends_with("le")) %>% 
  tab_spanner(label = "Paraguay", columns = ends_with("Paraguay")) %>% 
  tab_spanner(label = "Uruguay", columns = ends_with("Uruguay")) %>% 
  tab_spanner(label = "EE.UU. y Canadá", columns = ends_with("dá")) %>% 
  tab_spanner(label = "Resto de América", columns = ends_with("ca")) %>%   tab_spanner(label = "Europa", columns = ends_with("pa")) %>% 
  tab_spanner(label = "Resto del mundo", columns = ends_with("do")) %>% 
  cols_label(
    anio = "Año",
    balance_tur_tot	=	"Viajes de turistas",
    balance_gasto_tot	=	"Millones de US$",
    balance_tur_Bolivia	=	"Viajes de turistas",
    balance_gasto_Bolivia	=	"Millones de US$",
    balance_tur_Brasil	=	"Viajes de turistas",
    balance_gasto_Brasil	=	"Millones de US$",
    balance_tur_Chile	=	"Viajes de turistas",
    balance_gasto_Chile	=	"Millones de US$",
    balance_tur_Paraguay	=	"Viajes de turistas",
    balance_gasto_Paraguay	=	"Millones de US$",
    balance_tur_Uruguay	=	"Viajes de turistas",
    balance_gasto_Uruguay	=	"Millones de US$",
    'balance_tur_EE.UU. y Canadá'	=	"Viajes de turistas",
    'balance_gasto_EE.UU. y Canadá'	=	"Millones de US$",
    'balance_tur_Resto de América'	=	"Viajes de turistas",
    'balance_gasto_Resto de América'	=	"Millones de US$",
    balance_tur_Europa	=	"Viajes de turistas",
    balance_gasto_Europa	=	"Millones de US$",
    'balance_tur_Resto del mundo'	=	"Viajes de turistas",
    'balance_gasto_Resto del mundo'	=	"Millones de US$") %>% 
  fmt_number(columns  = 1, sep_mark = "", decimals = 0) %>% 
  fmt_number(columns  = seq(2,20,2), sep_mark = ".", dec_mark = ",", decimals = 0) %>% 
  tab_source_note(
    source_note = md("**Fuente**: DNMyE en base a datos de INDEC.")) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T) %>%
  tab_caption(glue("Balance de viajes de turistas y de divisas de turistas en millones de US$, por año según país.Años {anio_ref-10}- {anio_ref}.")) %>% 
  data_color(
    columns = -c(anio), #Variables
    apply_to = "text", #Aplico solo al texto
    colors = scales::col_bin( #Paleta con los colores
      bins = c(-Inf, 0, Inf),
      palette = c(dnmye_colores("rosa"), dnmye_colores("azul verde")))) 

ti25

```

<br>

Entre 1990 y 2014, el **balance de viajes de turistas** fue superavitario o levemente deficitario (no superó los 500.000 viajes). En tanto, durante el mismo período, el **balance de divisas** solo tuvo saldos positivos entre 2005 y 2011 (con excepción del año 2009).

En ambos casos se destaca el nivel de la pronunciada caída desde 2015, alcanzando su pico en 2017 y ascendiendo posteriormente. Con la recuperación del turismo de 2022, descienden nuevamente, aunque no llegan a ser tan bajos como entre 2016 y 2019. 

```{r ti26, fig.cap= glue("Balance de viajes de turistas (en miles), y de divisas (en millones de dólares). Total país. Años 1990-{anio_ref}."), out.width='100%'}

#tabla balance serie completa. 

balance_anual <- tur_gasto_anual_pais %>% 
  group_by(anio) %>% 
  summarise(balance_tur = sum(balance_tur)) %>% #balance ya está en millones
  left_join(gasto_con_pasajes_completa %>% #traigo serie completa
              select(anio, receptivo_tur, emisivo_tur)) %>%  
  mutate(balance_gasto = (receptivo_tur-emisivo_tur)/1000000, #balance en millones
         balance_tur = balance_tur/1000) %>% #turistas en miles
  filter(anio <= anio_ref) %>% 
  select(anio, starts_with("balance"))

balance_anual_long <- balance_anual %>% 
  pivot_longer(cols = -anio, 
               names_to = "tipo_balance", 
               values_to = "valor") %>% 
  mutate(tipo_balance = 
           case_when(tipo_balance== "balance_tur"~ "Balance de viajes de turistas",
                     TRUE ~ "Balance de divisas"), )

ti26 <- ggplot(balance_anual_long, aes(ym(paste(anio, 1, sep = "-")), valor, colour = tipo_balance)) +   
  geom_hline(yintercept = 0, color = "grey", alpha =0.7) + 
  geom_line() + 
  geom_point()+
  scale_color_dnmye() + 
  scale_x_date(date_breaks = "1 years", date_labels = "%Y", expand = c(.01,.01))+ 
  scale_y_continuous(labels = scales::number_format(big.mark = ".", decimal.mark = "," )) + 
  theme_minimal()+
  theme(legend.position = "bottom", 
        axis.text.x = element_text (angle=90),
        axis.text.y = element_text (size = 12),
        axis.title.y = element_text(size= 11),
        plot.caption = ggtext::element_markdown() ) +
  labs(y = "Turistas (en miles) y divisas (en millones de US$)", 
       x = "", 
       color= "",
       caption =  "**Fuente**: DNMyE en base a datos de INDEC." )

ti26

```


## Encuesta de Turismo Internacional (Aerop. de Ezeiza, Aerop. J. Newbery, Aerop. de Córdoba y Puerto de Bs. As.)

La **Encuesta de Turismo Internacional** es un relevamiento implementando de manera conjunta entre el MINTURDEP y el INDEC.

El **principal objetivo** de la ETI es medir y caracterizar a los viajes, los viajeros y los gastos, tanto de los no residentes en el país que visitan nuestro país, como de los residentes en la Argentina que visitan el exterior.

El operativo se realiza de manera continua desde el año 2004 y en la actualidad se relevan los siguientes pasos: 

- Aeropuerto Internacional de Ezeiza y Aeroparque
- Aeropuerto Internacional de Córdoba
- Aeropuerto Internacional de Mendoza
- Puerto de Buenos Aires
- Paso Internacional Cristo Redentor

Históricamente, por estos pasos **se produce el 50% del movimiento turístico internacional del país**; mientras que el gasto de los turistas no residentes egresados por los mismos **representa, aproximadamente, el 65% del gasto total en dólares generados por el turismo receptivo en la Argentina**.

Se debe aclarar que durante el año 2021 solo se realizó el operativo en el primer y cuarto trimestre en el paso Ezeiza y Aeroparque; y en el cuarto trimestre en el resto de los pasos. Es por este motivo que para los datos del 2022 **solo se incluirán variaciones interanuales en la primera tabla de turismo receptivo y de turismo emisivo; en el resto de las tablas/gráficos no es posible la comparación contra el año anterior**.

### Turismo Receptivo

A continuación se presentarán datos relacionados al turismo receptivo en los pasos relevados por la ETI en el año `r tolower(anio_ref)`.


```{r}

#Se levantan las bases

eti_e <- herramientas::read_file_srv("/srv/DataDNMYE/eti/bases/eti_nr_2009_2023.rds") %>% 
  filter(p3_3<=anio_ref & p3_3>=2010 & vis==2 & wpf>0) 

eti_e_perfiles <- eti_e %>%
  filter((paso_final=="Ezeiza y Aeroparque" & (p3_3<2020 | p3_3>2021 | (anio_trim=="2020-01-01" | anio_trim=="2021-01-01" | anio_trim=="2021-10-01"))) |
           (paso_final %in% c("Aep. Córdoba","Puerto de Buenos Aires","Aep. Mendoza","Cristo Redentor") & (p3_3<2020 | p3_3>2021 | (anio_trim=="2020-01-01" | anio_trim=="2021-10-01"))))
  

eti_a <- herramientas::read_file_srv("/srv/DataDNMYE/eti/bases/eti_a_2014_2023.rds") %>% 
  filter(p3_3<=anio_ref & vis==2 & wpf>0)%>% 
  mutate(motivo=case_when(p17nuev==1 ~"Vacaciones/ocio/recreación",
                          p17nuev==2 ~"Visita flia/amigos",
                          p17nuev==3 ~"Negocios/congreso/conferencia",
                          p17nuev>=4 ~"Otros")) %>%
  mutate(alojamiento=case_when(p21_ta_publ==1~"Casa flia./amigos",
                               p21_ta_publ==2~"Hotel 1,2, y 3 estrellas",
                               p21_ta_publ==3~"Hotel 4 y 5 estrellas",
                               p21_ta_publ==4~"Otros")) %>% 
  mutate(paq=case_when(paq==0~"No utilizó paquete",
                       paq==1~"Utilizó paquete"))

eti_a_perfiles <- eti_a %>%
  filter((paso_final=="Ezeiza y Aeroparque" & (p3_3<2020 | p3_3>2021 | (anio_trim=="2020-01-01" | anio_trim=="2021-01-01" | anio_trim=="2021-10-01"))) |
           (paso_final %in% c("Aep. Córdoba","Puerto de Buenos Aires","Aep. Mendoza","Cristo Redentor") & (p3_3<2020 | p3_3>2021 | (anio_trim=="2020-01-01" | anio_trim=="2021-10-01"))))


```


```{r}

#Insumo:

etie1 <- eti_e %>% 
  group_by(p3_3,paso_final) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  ungroup() %>% 
  complete(p3_3 = seq(from = min(p3_3), 
                      to = max(p3_3), 
                      by = 1),
           paso_final,
           fill = list(viajeros = NA_real_)) %>%
  pivot_wider(names_from = paso_final,
              values_from = viajeros)%>%
  mutate(`Ezeiza y Aeroparque`=case_when(p3_3==2020~625507,
                                         p3_3==2021~200605,
                                         TRUE~`Ezeiza y Aeroparque`),
         `Aep. Córdoba`=case_when(p3_3==2020~16611,
                                         p3_3==2021~1405,
                                         TRUE~`Aep. Córdoba`),
         `Puerto de Buenos Aires`=case_when(p3_3==2020~36361,
                                  p3_3==2021~19289,
                                  TRUE~`Puerto de Buenos Aires`),
         `Aep. Mendoza`=case_when(p3_3==2020~23120,
                                  p3_3==2021~5247,
                                  TRUE~`Aep. Mendoza`),
         `Cristo Redentor`=case_when(p3_3==2020~92944,
                                  p3_3==2021~4039,
                                  TRUE~`Cristo Redentor`)) %>% 
  mutate(var_1=round((`Ezeiza y Aeroparque`/lag(`Ezeiza y Aeroparque`,1)-1),3),
         var_2=round((`Aep. Córdoba`/lag(`Aep. Córdoba`,1)-1),3),
         var_3=round((`Puerto de Buenos Aires`/lag(`Puerto de Buenos Aires`,1)-1),3),
         var_4=round((`Aep. Mendoza`/lag(`Aep. Mendoza`,1)-1),3),
         var_5=round((`Cristo Redentor`/lag(`Cristo Redentor`,1)-1),3)) %>% 
  select(p3_3,`Ezeiza y Aeroparque`,var_1,
         `Aep. Córdoba`,var_2,
         `Aep. Mendoza`,var_4,
         `Puerto de Buenos Aires`,var_3,
         `Cristo Redentor`,var_5) %>% 
  filter(p3_3>=2010) %>% 
  mutate(`Aep. Mendoza`=case_when(p3_3==2017~NA_real_,
                                  TRUE~`Aep. Mendoza`),
         var_4=case_when(p3_3==2017~NA_real_,
                         TRUE~var_4)) %>% 
  mutate(p3_3=as.character(p3_3))

```

En el año `r (anio_ref)` se registraron `r format(round(as.numeric(etie1[nrow(etie1),2]),0), decimal.mark = ",", big.mark = ".")` turistas en **Ezeiza y Aeroparque** (`r ifelse(etie1[nrow(etie1),3]>0,"aumentando","cayendo")` `r format(round(100*etie1[nrow(etie1),3],1),decimal.mark = ",",big.mark = ".")`% en comparación con el año anterior); `r format(round(as.numeric(etie1[nrow(etie1),4]),0), decimal.mark = ",", big.mark = ".")` turistas en el **Aeropuerto de Córdoba** (`r format(round(100*etie1[nrow(etie1),5],1),decimal.mark = ",",big.mark = ".")`% vs `r as.character(anio_ref -1)`); `r format(round(as.numeric(etie1[nrow(etie1),6]),0), decimal.mark = ",", big.mark = ".")` en el **Aeropuerto de Mendoza** (`r format(round(100*etie1[nrow(etie1),7],1),decimal.mark = ",",big.mark = ".")`% i.a.); `r format(round(as.numeric(etie1[nrow(etie1),8]),0), decimal.mark = ",", big.mark = ".")` en el **Puerto de Buenos Aires** (`r format(round(100*etie1[nrow(etie1),9],1),decimal.mark = ",",big.mark = ".")`% i.a.) y `r format(round(as.numeric(etie1[nrow(etie1),10]),0), decimal.mark = ",", big.mark = ".")` en el **Paso Internacional Cristo Redentor** (`r format(round(100*etie1[nrow(etie1),11],1),decimal.mark = ",",big.mark = ".")`% i.a.). 

```{r eti1 }

#Tabla:

etie1 %>%
  gt()%>%
  gt_theme_dnmye() %>%
  tab_caption(glue("Turistas no residentes por año según paso. Años 2010-{anio_ref}.")) %>% 
  cols_label(p3_3 = "Año",
             `Ezeiza y Aeroparque`="Turistas",
             `Aep. Córdoba`="Turistas",
             `Aep. Mendoza`="Turistas",
             `Puerto de Buenos Aires`="Turistas",
             `Cristo Redentor`="Turistas",
             var_1 ="var % i.a",
             var_2 = "var % i.a",
             var_3 = "var % i.a",
             var_4 = "var % i.a*",
             var_5 = "var % i.a")  %>%
  fmt_number(columns = c(2,4,6,8,10), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3,5,7,9,11), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
    data_row.padding = px(3),
    column_labels.font.size = 14,
    column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(2,4,6,8,10) ~ px(100),
             columns = c(3,5,7,9,11) ~ px(80),
             columns = c(1) ~ px(60)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "///") %>%
  tab_source_note(
    source_note = md("**(*)** El Aep. Int. de Mendoza comenzó a ser relevado en el 3er trim de 2017, no se incluyen los datos del 2017 ya que no hay datos del año completo.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_spanner(label = "Eze / Aep.", columns = c(2:3)) %>% 
  tab_spanner(label = "Aep. Córd.", columns = c(4:5)) %>% 
  tab_spanner(label = "Aep. Mend.*", columns = c(6:7)) %>%
  tab_spanner(label = "Puerto CABA", columns = c(8:9)) %>%
  tab_spanner(label = "Cto. Redentor", columns = c(10:11)) %>%
  tab_style(
    style = list(
      cell_text(color = dnmye_colores("rosa"),weight =  "bold")
    ),
    locations = cells_body(
      columns = c(var_1),
      rows = var_1 <= 0
    )) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = nrow(etie1))
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = nrow(etie1)
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)


rm(etie1)
```

```{r}
#Ezeiza y aeroparque

#Insumo:

etie2 <- eti_e_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Ezeiza y Aeroparque") %>% 
  group_by(p3_3,orig_eya) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)

if (anio_ref %in%c(2021,2022)) {
  etie2 <- etie2 %>% select(orig_eya,t0,prop_)
} else {
  etie2 <- etie2 %>% select(orig_eya,t0,var_1,var_2,prop_)
}  

ranking <- etie2 %>% 
  arrange(prop_)

etie2 <-  etie2  %>%
  mutate (orig_eya=factor(orig_eya,levels =c("Total","Bolivia",
                                             "Brasil","Chile",
                                             "Paraguay","Uruguay",
                                             "EE.UU y Canadá","Resto América",
                                             "Europa","Resto del Mundo"))) %>% 
  arrange(orig_eya) 
  


```

En los aeropuertos de **Ezeiza y Aeroparque**, la mayor cantidad de turistas fueron **residentes en  `r ranking[9,1]`**, representando el `r format(round(100*ranking[9,3],1),decimal.mark = ",",big.mark = ".")`% del total de los turistas.


```{r eti2 }

#Tabla:

etie2 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas no residentes según residencia habitual. Ezeiza y Aeroparque. Año {anio_ref}.")) %>%
  cols_label(orig_eya = "Lugar de residencia",
             t0="Turistas",
             prop_ = "Participación %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3),
              column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(160),
             columns = c(3) ~ px(160)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>% 
  cols_align(
    align = "left",
    columns = 1) %>%
  cols_align(
    align = "center",
    columns = 2:3) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 1er y 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) 

rm(etie2,ranking)

```

```{r}

#AEP Córdoba

#Insumo:

etie3 <- eti_e_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Aep. Córdoba") %>% 
  group_by(p3_3,orig_cor) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros))%>%
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1) %>% 
  mutate(prop_=prop.table(t0)) %>% 
  ungroup() %>% 
  adorn_totals()
  


if (anio_ref %in%c(2021,2022)) {
  etie3 <- etie3 %>% select(orig_cor,t0,prop_)
} else {
  etie3 <- etie3 %>% select(orig_cor,t0,var_1,var_2,prop_)
}  

ranking <- etie3 %>% 
  arrange(prop_)

etie3 <- etie3 %>%
  mutate (orig_cor=factor(orig_cor,levels =c("Total","Brasil","Chile",
                                             "EE.UU, Canadá y México","Resto de América",
                                             "Europa y resto del mundo"))) %>% 
  arrange(orig_cor) 


```

En el **Aeropuerto Internacional de Córdoba**, los turistas residentes en **`r ranking[5,1]`** se posicionaron en primer lugar (`r format(round(100*ranking[5,3],1),decimal.mark = ",",big.mark = ".")`% del total).


```{r eti3 }

#Tabla GT ()

etie3 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas no residentes según residencia habitual. Aeropuerto Internacional de Córdoba. Año {anio_ref}.")) %>%
  cols_label(orig_cor = "Lugar de residencia",
             t0="Turistas",
             prop_ = "Participación %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1) ~ px(160),
             columns = c(2:3) ~ px(140)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>%
  tab_header(
    subtitle = 
      glue("Aeropuerto Internacional de Córdoba, {anio_ref}."),
    title =""
  ) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  #opt_all_caps() %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))%>% 
  tab_options(container.height = 600,
              container.overflow.y = T)

rm(etie3,ranking)

```

```{r}

# Puerto de buenos aires

#Insumo:

etie4 <- eti_e_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Puerto de Buenos Aires") %>% 
  group_by(p3_3,orig_puerto) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)

if (anio_ref %in%c(2021,2022)) {
  etie4 <- etie4 %>% select(orig_puerto,t0,prop_)
} else {
  etie4 <- etie4 %>% select(orig_puerto,t0,var_1,var_2,prop_)
}  

ranking <- etie4 %>% 
  arrange(prop_)

etie4 <- etie4  %>%
  mutate (orig_puerto=factor(orig_puerto,levels =c("Total","Uruguay",
                                                "Resto del Mundo"))) %>% 
  arrange(orig_puerto) 
  

```


En el **Puerto de Buenos Aires**, la mayor cantidad de turistas fueron **residentes en `r ranking[2,1]`** (`r format(round(100*ranking[2,3],1),decimal.mark = ",",big.mark = ".")`% del total).


```{r eti4 }

#Tabla:

etie4 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas no residentes según residencia habitual. Puerto de Buenos Aires. Año {anio_ref}.")) %>%
  cols_label(orig_puerto = "Lugar de residencia",
             t0="Turistas",
             prop_ = "Participación %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
              data_row.padding = px(3),
              #column_labels.font.size = 14,
              column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(140),
             columns = c(3) ~ px(140)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) 
  
rm(etie4,ranking)

```

```{r}
### Aep Mendoza

#Insumo:

etie5 <- eti_e_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Aep. Mendoza") %>% 
  group_by(p3_3,orig_mdz) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)

if (anio_ref %in%c(2021,2022)) {
  etie5 <- etie5 %>% select(orig_mdz,t0,prop_)
} else {
  etie5 <- etie5 %>% select(orig_mdz,t0,var_1,var_2,prop_)
}  

ranking <- etie5 %>% 
  arrange(prop_)

etie5 <- etie5 %>%
  mutate (orig_mdz=factor(orig_mdz,levels =c("Total","Brasil",
                                             "Chile","EE.UU, Canadá",
                                             "Resto de América",
                                             "Europa y resto del mundo"))) %>% 
  arrange(orig_mdz)

```

Al analizar el caso de los turistas no residentes en el **Aeropuerto Internacional de Mendoza**, se observa el claro predominio de los residentes en **`r ranking[5,1]`** (`r format(round(100*ranking[5,3],1),decimal.mark = ",",big.mark = ".")`% del total).


```{r eti5, fig.cap=glue("Llegada de turistas no residentes según residencia habitual. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")}

#Tabla:

etie5 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas no residentes según residencia habitual. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")) %>%
  cols_label(orig_mdz = "Lugar de residencia",
             t0="Turistas",
             prop_ = "Participación %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
              data_row.padding = px(3),
              #column_labels.font.size = 14,
              column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(160),
             columns = c(3) ~ px(140)) %>%
    # tab_source_note(
    # source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trim no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))
 
rm(etie5,ranking)

```

```{r}

###Cristo Redentor

#Insumo:

etie6 <- eti_e_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Cristo Redentor") %>% 
  group_by(p3_3,orig_cristo) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)


if (anio_ref %in%c(2021,2022)) {
  etie6 <- etie6 %>% select(orig_cristo,t0,prop_)
} else {
  etie6 <- etie6 %>% select(orig_cristo,t0,var_1,var_2,prop_)
}  

ranking <- etie6 %>% 
  arrange(prop_)

etie6 <- etie6 %>%
  mutate (orig_cristo=factor(orig_cristo,levels =c("Total","Chile",
                                             "Resto del mundo"))) %>% 
  arrange(orig_cristo)

```

Finalmente, en el paso **Internacional Cristo Redentor**, los turistas residentes en **`r ranking[2,1]`** se posicionaron claramente en primer lugar (`r format(round(100*ranking[2,3],1),decimal.mark = ",",big.mark = ".")`% del total).


```{r eti6 }

#Tabla:

etie6 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas no residentes según residencia habitual. Paso Internacional Cristo Redentor. Año {anio_ref}.")) %>%
  cols_label(orig_cristo = "Lugar de residencia",
             t0="Turistas",
             prop_ = "Participación %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1,2) ~ px(160),
             columns = c(3) ~ px(140)) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  #opt_all_caps() %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))

```

```{r}

# Llegadas de turistas no residentes por motivo de viaje

#Insumo:

etie7_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo_viaje) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etie7 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo_viaje) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etie7_total) %>%
  mutate(prop_=round(prop_,3)*100)

rm(etie7_total)

ranking_total <- etie7 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etie7 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etie7 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etie7 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etie7 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etie7 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)

etie7 <- etie7 %>% 
  mutate(motivo_viaje=case_when(motivo_viaje=="Visita de familiares o amigos"~"Visita flia/amigos",
                                motivo_viaje=="Vacaciones, ocio o recreación"~"Vacaciones/ocio/recrea.",
                                motivo_viaje=="Negocios, congreso o conferencia"~"Negocio/congreso/conf.",
                                motivo_viaje=="Otros"~"Otros"))


```


En la suma de **todos los pasos** relevados, el **principal motivo de viaje** fue **"`r ranking_total[nrow(ranking_total),2]`"** (el `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total de turistas declaró haber viajado por dicho motivo). 

Al desagregar la información por paso, se observa que **en todos los pasos la mayor parte de los turistas viajaron por "Vacaciones, ocio o recreación"**, con la excepción de el Aeropuerto de Córdoba, donde se destacó como principal motivo **"visita a familiares o amigos"**.



```{r eti7, fig.cap=glue("Distribución de los turistas no residentes según motivo de viaje, por paso. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie7 %>% mutate(motivo_viaje=factor(motivo_viaje,
                                                levels = c("Visita flia/amigos",
                                                           "Vacaciones/ocio/recrea.",
                                                           "Negocio/congreso/conf.",
                                                           "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                                 levels = c("TOTAL",
                                                            "Eze. y Aep.",
                                                            "Aep. Cord.",
                                                            "Aep.Mza.",
                                                            "Puerto BA.",
                                                            "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo_viaje,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC)")+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal"),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie7, ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

```{r}

# Llegadas de turistas no residentes por tipo alojamiento

#Insumo:

etie8_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etie8 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etie8_total) %>% 
  mutate(prop_=round(prop_,3)*100) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa de familiares o amigos"~"Casa flia/amigos",
                               alojamiento=="Hotel de 1, 2 o 3 estrellas"~"Hotel 1/2/3 est.",
                               alojamiento=="Hotel de 4 y 5 estrellas"~"Hotel 4/5 est.",
                               alojamiento=="Otros"~"Otros"))

rm(etie8_total)

ranking_total <- etie8 %>% filter(paso_final=="TOTAL") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_eya <- etie8 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_cor <- etie8 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_mza <- etie8 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_pue <- etie8 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_cto <- etie8 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))


```

A nivel total, la mayor proporción de turistas no residentes se alojó en  **"`r ranking_total[nrow(ranking_total),2]`"** (el `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total de turistas); **mismo tipo de alojamiento se destacó en los pasos Ezeiza y Aeroparque, el Aeropuerto de Córdoba y Cristo Redentor; mientras que en el Aeropuerto de Mendoza y en el Puerto de Buenos Aires la mayoría de los turistas se hospedó en establecimientos de 4 o 5 estrellas**.


```{r eti8, fig.cap=glue("Distribución de los turistas no residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}

#Gráfico:


ggplot(data=etie8 %>% mutate(alojamiento=factor(alojamiento,
                                                 levels = c("Casa flia/amigos",
                                                            "Hotel 1/2/3 est.",
                                                            "Hotel 4/5 est.",
                                                            "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
            ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal",size=20),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie8, ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

```{r}

# Llegadas de turistas no residentes según USO DE PAQUETE TURISTICO

#Insumo:

etie9_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etie9 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etie9_total) %>% 
  pivot_wider(names_from = paso_final,
              values_from = prop_) %>%
  mutate(paq=case_when(paq==0~"No utilizó paquete",
                       paq==1~"Utilizó paquete")) %>% 
  select(paq,`TOTAL`,`Ezeiza y Aeroparque`,`Aep. Córdoba`,`Puerto de Buenos Aires`,
         `Aep. Mendoza`,`Cristo Redentor`) %>% 
  pivot_longer(cols=c(2:7),
                names_to = "paso_final",
                values_to="prop_") %>% 
  arrange(paso_final) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etie9_total)

```

**La contratación de algún paquete de viaje resultó marginal** en los turistas no residentes que visitaron nuestro país.


```{r eti9, fig.cap=glue("Distribución de los turistas no residentes según organización del viaje, por paso. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie9 %>% mutate(paq=factor(paq,
                                                levels = c("No utilizó paquete",
                                                           "Utilizó paquete")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie9)

```

```{r}

#Llegadas, gasto total, gasto por viajero, pernoctaciones y estadÍa media de turistas no residentes

#Insumo:

etie10_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref | p3_3==anio_ref-1 | p3_3==anio_ref-2) %>%
  group_by(p3_3) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            pernoctes=sum(totaln*wpf,na.rm = TRUE),
            gasto=sum(gastoest2*wpf,na.rm = TRUE)) %>% 
  mutate(paso_final="TOTAL")



etie10 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref | p3_3==anio_ref-1 | p3_3==anio_ref-2) %>%
  group_by(p3_3,paso_final) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            pernoctes=sum(totaln*wpf,na.rm = TRUE),
            gasto=sum(gastoest2*wpf,na.rm = TRUE)) %>% 
  rbind(etie10_total) %>% 
  arrange(p3_3, paso_final)%>%
  mutate(estadia=pernoctes/viajeros,
           gasto_tur=gasto/viajeros,
           gasto_diario=gasto/pernoctes) %>%
  ungroup() %>% 
  mutate(var_1=round((viajeros/lag(viajeros,6)-1),3),
         var_2=round((viajeros/lag(viajeros,12)-1),3),
         var_3=round((pernoctes/lag(pernoctes,6)-1),3),
         var_4=round((pernoctes/lag(pernoctes,12)-1),3),
         var_5=round((gasto/lag(gasto,6)-1),3),
         var_6=round((gasto/lag(gasto,12)-1),3),
         var_7=round((estadia/lag(estadia,6)-1),3),
         var_8=round((estadia/lag(estadia,12)-1),3),
         var_9=round((gasto_tur/lag(gasto_tur,6)-1),3),
         var_10=round((gasto_tur/lag(gasto_tur,12)-1),3),
         var_11=round((gasto_diario/lag(gasto_diario,6)-1),3),
         var_12=round((gasto_diario/lag(gasto_diario,12)-1),3)) %>%
  filter(p3_3==anio_ref) %>% 
  select(paso_final,viajeros,var_1,var_2,pernoctes,var_3,var_4,gasto,var_5,var_6,estadia,var_7,var_8,
         gasto_tur,var_9,var_10,gasto_diario,var_11,var_12)

#filtros para los años 2020:2022.

if (anio_ref %in%c(2021,2022)) {
  etie10 <- etie10 %>% select(1:2,5,8,11,14,17)
} else {
  etie10 <- etie10 %>% select(1:19)
}  


rm(etie10_total)

ranking1 <- etie10 %>% select(paso_final,gasto_tur) %>%
  filter(paso_final!="TOTAL") %>% arrange(desc(gasto_tur)) 

ranking2 <- etie10 %>% select(paso_final,gasto_diario) %>%
  filter(paso_final!="TOTAL") %>% arrange(desc(gasto_diario))


etie10 <- etie10 %>%
  mutate(paso_final=factor(paso_final,levels = c("TOTAL","Ezeiza y Aeroparque","Aep. Córdoba",
                                                   "Puerto de Buenos Aires","Aep. Mendoza",
                                                   "Cristo Redentor"))) %>% 
  arrange(paso_final)


```

El gasto de los turistas no residentes arribados por los 6 pasos relevados, en el `r as.character(anio_ref)`, **totalizó en US$ `r format(round(etie10[1,4]/1000000,1),,decimal.mark = ",",big.mark = ".")` millones**. 

El **gasto total en dólares** de los turistas no residentes en **Ezeiza y Aeroparque** ascendió a `r format(round(etie10[2,4]/1000000,1),decimal.mark = ",",big.mark = ".")` millones; `r format(round(etie10[3,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Aeropuerto de Córdoba**; `r format(round(etie10[4,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Puerto de Buenos Aires**;  `r format(round(etie10[5,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Aeropuerto de Mendoza**; y, finalmente  `r format(round(etie10[6,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en **Cristo Redentor**.


**El gasto en US\$ por turista** fue de `r format(round(etie10[1,6]/1,1),decimal.mark = ",",big.mark = ".")`. Desagregando dicha información por paso: el gasto por turista en US\$ más elevado se registró en **`r ranking1[1,1]`**  (`r format(round(ranking1[1,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); seguido por el **`r ranking1[2,1]`**  (`r format(round(ranking1[2,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking1[3,1]`**  (`r format(round(ranking1[3,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); el **`r ranking1[4,1]`**  (`r format(round(ranking1[4,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); y **`r ranking1[5,1]`**  (`r format(round(ranking1[5,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$)

En el caso del **gasto promedio diario en US\$**, el mismo fue de `r format(round(etie10[1,7]/1,1),decimal.mark = ",",big.mark = ".")` en la suma de los pasos relevados; `r format(round(ranking2[1,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$ en el **`r ranking2[1,1]`**; seguido por el **`r ranking2[2,1]`**  (`r format(round(ranking2[2,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking2[3,1]`**  (`r format(round(ranking2[3,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking2[4,1]`**  (`r format(round(ranking2[4,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); y **`r ranking2[5,1]`**  (`r format(round(ranking2[5,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$).


```{r eti10, fig.cap=glue("Llegadas, gasto total, gasto por viajero, pernoctaciones y estadÍa media de turistas no residentes, según paso. Año {anio_ref}.")}


#Tabla:

etie10 %>%
  gt()%>%
  gt_theme_dnmye() %>%
  tab_caption(glue("Turistas, gasto total y gasto por viajero en dólares, pernoctaciones y estadía media de turistas no residentes, según paso. Año {anio_ref}.")) %>%
  cols_label(paso_final = "Paso",
             viajeros="Turistas",
             pernoctes="Pernoc- taciones",
             gasto="Gasto total (en US$)",
             estadia="Estadía promedio (en noches)",
             gasto_tur="Gasto por turista (en US$)",
             gasto_diario="Gasto promedio diario (en US$)")  %>%
  fmt_number(columns = c(2:4), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_number(columns = c(5:7), decimals = 1, dec_mark = ",", sep_mark = ".") %>% 
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1) ~ px(160),
             columns = c(2:7) ~ px(120)) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** En el año 2021 se relevaron el trim 1 y 4 en Ezeiza y Aeroparque; y el trim 4 en el resto de los pasos.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)


rm(etie10,ranking1,ranking2)

```

```{r}

# Gasto total de no residentes por motivo de viaje

#Insumo

etie11_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo_viaje) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etie11 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo_viaje) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etie11_total) %>% 
  mutate(prop_=(round(prop_,3))*100)

rm(etie11_total)


ranking_total <- etie11 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etie11 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etie11 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etie11 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etie11 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etie11 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)

etie11 <- etie11 %>% 
  mutate(motivo_viaje=case_when(motivo_viaje=="Visita de familiares o amigos"~"Visita flia/amigos",
                                motivo_viaje=="Vacaciones, ocio o recreación"~"Vacaciones/ocio/recrea.",
                                motivo_viaje=="Negocios, congreso o conferencia"~"Negocio/congreso/conf.",
                                motivo_viaje=="Otros"~"Otros"))

```

En **la suma de todos los pasos** relevados, la mayor proporción del gasto (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`%)  fue concentrado por los turistas que declararon haber tenido como **principal motivo de viaje** "`r ranking_total[nrow(ranking_total),2]`".

Desagregar la información por paso no genera fuertes matices, con la excepción del **Aeropuerto de Córdoba**, donde la mayor proporción del gasto fue generado por los turistas que viajaron con motivo de **"Visita a familiares o amigos"**.


```{r eti11, fig.cap=glue("Distribución del gasto total en dólares de turistas no residentes según motivo de viaje, por paso. Año {anio_ref}.")}


#Gráfico en ggplot


ggplot(data=etie11 %>% mutate(motivo_viaje=factor(motivo_viaje,
                                                 levels = c("Visita flia/amigos",
                                                            "Vacaciones/ocio/recrea.",
                                                            "Negocio/congreso/conf.",
                                                            "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo_viaje,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
            ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie11,ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

```{r}

#  Gasto total de no residentes por tipo alojamiento 

#Insumo:

etie12_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etie12 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etie12_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etie12_total)

ranking_total <- etie12 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etie12 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etie12 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etie12 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etie12 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etie12 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)



```

La mayor proporción de gasto provino de los turistas hospedados en **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del gasto total).

En **Ezeiza y Aeroparque**, los turistas alojados en **"`r ranking_eya[nrow(ranking_eya),2]`"** concentraron el `r format(round(1*ranking_eya[nrow(ranking_eya),3],1),decimal.mark = ",",big.mark = ".")`% del gasto; mismo tipo de alojamiento concentró la mayoría del gasto en el **Aeropuerto de Mendoza y en el Puerto de Buenos Aires** (`r format(round(1*ranking_mza[nrow(ranking_mza),3],1),decimal.mark = ",",big.mark = ".")`% y `r format(round(1*ranking_pue[nrow(ranking_pue),3],1),decimal.mark = ",",big.mark = ".")`%, respectivamente); en el caso del **Aeropuerto de Córdoba**, los turistas alojados en **"`r ranking_cor[nrow(ranking_cor),2]`"** generaron el `r format(round(1*ranking_cor[nrow(ranking_cor),3],1),decimal.mark = ",",big.mark = ".")`% del gasto; finalmente, en **Cristo Rendentor**, la categoría **"otros alojamientos"** fue la que tuvo mayor peso en la totalidad del gasto (`r format(round(1*ranking_cto[nrow(ranking_cto),3],1),decimal.mark = ",",big.mark = ".")`%).



```{r eti12, fig.cap=glue("Distribución del gasto total en dólares de los turistas no residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie12 %>% mutate(alojamiento=factor(alojamiento,
                                                levels = c("Casa de familiares o amigos",
                                                           "Hotel de 4 y 5 estrellas",
                                                           "Hotel de 1, 2 o 3 estrellas",
                                                           "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie12)


```

El gasto total provino prácticamente en su totalidad de los turistas que no contrataron paquete turístico en la organización de su viaje.


```{r eti13, fig.cap=glue("Distribución del gasto total en dólares de los turistas no residentes según utilización de paquete turístico, por paso. Año {anio_ref}.")}

#  Gasto total de no residentes según uso de paquete

#Insumo:

etie13_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etie13 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etie13_total) %>%
  mutate(paq=case_when(paq==0~"No utilizó paquete",
                       paq==1~"Utilizó paquete"))%>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etie13_total)

#Gráfico:

ggplot(data=etie13 %>% mutate(paq=factor(paq,
                                         levels = c("No utilizó paquete",
                                                    "Utilizó paquete")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etie13)


```

```{r}

#Pernoctaciones por alojamiento

#Insumo

etie14_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo_viaje) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etie14 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo_viaje) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etie14_total) %>% 
  mutate(prop_=(round(prop_,3))*100)

rm(etie14_total)

ranking_total <- etie14 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etie14 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etie14 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etie14 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etie14 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etie14 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)


etie14 <- etie14 %>% 
  mutate(motivo_viaje=case_when(motivo_viaje=="Visita de familiares o amigos"~"Visita flia/amigos",
                                motivo_viaje=="Vacaciones, ocio o recreación"~"Vacaciones/ocio/recrea.",
                                motivo_viaje=="Negocios, congreso o conferencia"~"Negocio/congreso/conf.",
                                motivo_viaje=="Otros"~"Otros"))


```


A **nivel total**, la mayor cantidad de pernoctaciones corresponde a turistas que viajaron por **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total); esto mismo sucede en **Ezeiza y Aeroparque, el Aeropuerto de Córdoba y Cristo Redentor**; mientras que en el **Aeropuerto de Mendoza y en el Puerto de Buenos Aires** fueron los turistas que viajaron por **"vacaciones u ocio"** los que tuvieron mayor peso dentro del total de pernoctaciones.  


```{r eti14, fig.cap=glue("Distribución de los pernoctes no residentes según motivo de viaje, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etie14 %>% mutate(motivo_viaje=factor(motivo_viaje,
                                                  levels = c("Visita flia/amigos",
                                                            "Vacaciones/ocio/recrea.",
                                                            "Negocio/congreso/conf.",
                                                            "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo_viaje,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
  ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie14,ranking_total,ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

```{r}

#  Pernoctes de no residentes por tipo alojamiento 

#Insumo:

etie15_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etie15 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etie15_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etie15_total)

ranking_total <- etie15 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etie15 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etie15 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etie15 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etie15 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etie15 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)


```

La distribución de los pernoctes según **principal tipo de alojamiento utilizado** arroja que la mayor cantidad de pernoctes fueron de turistas hospedados en **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`%).

```{r eti15, fig.cap=glue("Distribución de los pernoctes no residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etie15 %>% mutate(alojamiento=factor(alojamiento,
                                                 levels = c("Casa de familiares o amigos",
                                                            "Hotel de 4 y 5 estrellas",
                                                            "Hotel de 1, 2 o 3 estrellas",
                                                            "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etie15,ranking_total,ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

La mayor proporción de las pernoctaciones en nuestro país provino de turistas que **no utilizaron paquete turístico** en la organización del viaje.


```{r eti16, fig.cap=glue("Distribución de los pernoctes no residentes según utilización de paquete turístico, por paso. Año {anio_ref}.")}

#  Gasto total de no residentes según uso de paquete

#Insumo:

etie16_total <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etie16 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etie16_total) %>%
  mutate(paq=case_when(paq==0~"No utilizó paquete",
                       paq==1~"Utilizó paquete"))%>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etie16_total)

#Gráfico:

ggplot(data=etie16 %>% mutate(paq=factor(paq,
                                         levels = c("No utilizó paquete",
                                                    "Utilizó paquete")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etie16)

```

```{r}
###TOTAL: sin diferenciar por paso

#Insumo:

etie17a <- eti_e_perfiles %>%
  filter(p3_3==anio_ref) %>%  
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso))%>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden)


ranking <- (etie17a$actividad)

texto <- etie17a %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))
  
  

```

Al analizar las **actividades realizadas** en la Argentina, se observa que el `r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`% de los turistas realizaron "`r texto[nrow(texto),1]`", seguidas por las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`".


```{r eti17, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Total de pasos relevados. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie17a %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie17a,texto)


```

```{r}

#Ezeiza y aeroparque (TOTAL)

#Insumo:

etie18 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Ezeiza y Aeroparque") %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso))%>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden)


ranking <- (etie18$actividad)

texto <- etie18 %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))




```

En **Ezeiza y Aeroparque**, las **"`r texto[nrow(texto),1]`"** se posicionaron en primer lugar dentro de las actividades realizadas (`r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`%), seguidas por las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`".


```{r eti18, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Ezeiza y Aeroparque. Año {anio_ref}.")}


#Gráfico

ggplot(data=etie18 %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie18,texto)


```

```{r}
#Ezeiza y aeroparque por origen

#Insumo:

etie19 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Ezeiza y Aeroparque") %>%
  group_by(orig_eya) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(1,17:30) %>% 
    pivot_longer(cols=c(2:15),
                 names_to = "actividad",
                 values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades"))



```



```{r eti19bbc, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia de los turistas residentes en Bolivia, Brasil y Chile. Ezeiza y Aeroparque. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie19 %>% filter(orig_eya %in% c("Bolivia","Brasil","Chile")) %>% mutate (orig_eya=factor(orig_eya,levels =c("Bolivia","Brasil","Chile","Paraguay","Uruguay",
"EE.UU y Canadá","Resto América",
"Europa","Resto del Mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_eya)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())


```


```{r eti19pueeuu, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia de los turistas residentes en Paraguay, Uruguay y Estados Unidos y Canadá. Ezeiza y Aeroparque. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie19 %>% filter(orig_eya %in% c("Paraguay","Uruguay",
"EE.UU y Canadá")) %>% mutate (orig_eya=factor(orig_eya,levels =c("Bolivia","Brasil","Chile","Paraguay","Uruguay",
"EE.UU y Canadá","Resto América",
"Europa","Resto del Mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_eya)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal",size=16),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

```


```{r eti19raerm, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia de los turistas residentes en Resto de América, Europa y Resto del Mundo. Ezeiza y Aeroparque. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie19 %>% filter(orig_eya %in% c("Resto América","Europa","Resto del Mundo")) %>% mutate (orig_eya=factor(orig_eya,levels =c("Bolivia","Brasil","Chile","Paraguay","Uruguay",
"EE.UU y Canadá","Resto América",
"Europa","Resto del Mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_eya)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie19,ranking)

```


```{r}

###Aeropuerto de Córdoba (TOTAL)

etie20 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Córdoba") %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso)) %>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden) 

ranking <- (etie20$actividad)

texto <- etie20 %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))


```

Las **"`r texto[nrow(texto),1]`"** se destacaron en el **Aeropuerto de Córdoba** (`r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`%), seguidas por las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`".


```{r eti20, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia.Aeropuerto Internacional de Córdoba. Año {anio_ref}.")}


#Gráfico:


ggplot(data=etie20 %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie20,texto)

```

```{r eti21, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia.Aeropuerto Internacional de Córdoba. Año {anio_ref}.")}

#CÓRDOBA desagregado por origen

etie21 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Córdoba") %>%
  group_by(orig_cor) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(1,17:30) %>% 
  pivot_longer(cols=c(2:15),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades"))

#Gráfico en ggplot:


ggplot(data=etie21 %>% mutate (orig_cor=factor(orig_cor,levels =c("Brasil","Chile",
                                                                  "EE.UU, Canadá y México","Resto de América",
                                                                  "Europa y resto del mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_cor)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie21,ranking)

```

```{r}

###MENDOZA

#TOTAL

#Insumo:

etie22 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Mendoza") %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso)) %>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden)

ranking <- (etie22$actividad)

texto <- etie22 %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))


```

En el **Aeropuerto de Mendoza**, la mayor cantidad de turistas realizó **"`r texto[nrow(texto),1]`"** (`r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`%), le siguieron en importancia las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`". 

```{r eti22, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")}


#Gráfico:


ggplot(data=etie22 %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie22,texto)

```


```{r eti23, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")}

#MENDOZA POR ORIGEN


etie23 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Mendoza") %>%
  group_by(orig_mdz) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(1,17:30) %>% 
  pivot_longer(cols=c(2:15),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades"))



#Gráfico en ggplot:

ggplot(data=etie23 %>% mutate (orig_mdz=factor(orig_mdz,levels =c("Brasil",
                                                                  "Chile","EE.UU, Canadá",
                                                                  "Resto de América",
                                                                  "Europa y resto del mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_mdz)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie23,ranking)

```

```{r}

#TOTAL

###PUERTO

#Insumo:

etie24 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Puerto de Buenos Aires") %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso))%>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden)

ranking <- (etie24$actividad)

texto <- etie24 %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))


```


En el **Puerto de Buenos Aires**, se ubicaron en primer lugar las **"`r texto[nrow(texto),1]`"** (`r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`%), seguidas por las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`".


```{r eti24, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia.Puerto de Buenos Aires. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie24 %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_text(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie24)


```


```{r}

#PUERTO POR ORIGEN

#Insumo.

etie25 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Puerto de Buenos Aires") %>%
  group_by(orig_puerto) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(1,17:30) %>% 
  pivot_longer(cols=c(2:15),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades"))



ranking1 <- etie25 %>% 
  filter(orig_puerto=="Uruguay") %>% 
  arrange(peso)%>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades")) %>% 
  filter(actividad!="otras actividades")


ranking2 <- etie25 %>% 
  filter(orig_puerto=="Resto del Mundo") %>% 
  arrange(peso)%>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades")) %>% 
  filter(actividad!="otras actividades")


```



```{r eti25, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Puerto de Buenos Aires. Año {anio_ref}.")}

#Gráfico en ggplot:

ggplot(data=etie25 %>% mutate (orig_puerto=factor(orig_puerto,levels =c("Uruguay",
                                                                  "Resto del Mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_puerto)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_text(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie25,ranking,ranking1,ranking2)


```


```{r}

###CRISTO

#TOTAL

#Insumo:

etie26 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Cristo Redentor") %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(16:29) %>% 
  pivot_longer(cols=c(1:14),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades")) %>% 
  arrange((peso)) %>% 
  mutate(orden=row_number()) %>% 
  mutate(orden=as.numeric(orden)) %>% 
  mutate(orden=case_when(actividad=="Otras actividades"~0,
                         TRUE~orden)) %>% 
  arrange(orden) %>% 
  select(-orden)

ranking <- (etie26$actividad)


texto <- etie26 %>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades"))


```

Se destacaron las **"`r texto[nrow(texto),1]`"** (`r format(round(1*texto[nrow(texto),2],1),decimal.mark = ",",big.mark = ".")`%) en **Cristo Redentor**, seguidas por las "`r texto[nrow(texto)-1,1]`" y las "`r texto[nrow(texto)-2,1]`".


```{r eti26, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Paso Internacional Cristo Redentor. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie26 %>% mutate(actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie26,ranking1,ranking2,texto)

```

```{r}

#CRISTO POR ORIGEN

#Insumo:

etie27 <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Cristo Redentor") %>%
  group_by(orig_cristo) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            aventura=sum(p39_1r*wpf,na.rm = TRUE),
            gastro=sum(p39_4r*wpf,na.rm = TRUE),
            idioma=sum(p39_7r*wpf,na.rm = TRUE),
            tmedicos=sum(p39_9r*wpf,na.rm = TRUE),
            tango=sum(p39_10r*wpf,na.rm = TRUE),
            urbanos=sum(p39_13r*wpf,na.rm = TRUE),
            compras=sum(p39_14r*wpf,na.rm = TRUE),
            edeportivos=sum(p39_15r*wpf,na.rm = TRUE),
            actnoct=sum(p39_16r*wpf,na.rm = TRUE),
            bajadif=sum(p39_17r*wpf,na.rm = TRUE),
            parquesnac=sum(p39_18r*wpf,na.rm = TRUE),
            nieve=sum(p39_19r*wpf,na.rm = TRUE),
            vino=sum(p39_20r*wpf,na.rm = TRUE),
            otras=sum(p39_111r*wpf,na.rm = TRUE)) %>% 
  mutate(paventura=aventura/viajeros,
         pgastro=gastro/viajeros,
         pidioma=idioma/viajeros,
         ptmedicos=tmedicos/viajeros,
         ptango=tango/viajeros,
         purbanos=urbanos/viajeros,
         pcompras=compras/viajeros,
         pedeportivos=edeportivos/viajeros,
         pactnoct=actnoct/viajeros,
         pbajadif=bajadif/viajeros,
         pparquesnac=parquesnac/viajeros,
         pnieve=nieve/viajeros,
         pvino=vino/viajeros,
         potras=otras/viajeros) %>% 
  select(1,17:30) %>% 
  pivot_longer(cols=c(2:15),
               names_to = "actividad",
               values_to="peso") %>% 
  mutate(peso=(round(peso,3))*100) %>% 
  mutate(actividad=case_when(actividad=="paventura"~"Tur. Aventura",
                             actividad=="pgastro"~"Act. Gastronómicas",
                             actividad=="pidioma"~"Aprendizaje español",
                             actividad=="ptmedicos"~"Trat. médicos",
                             actividad=="ptango"~"Tango",
                             actividad=="purbanos"~"Acts. lugares urbanos",
                             actividad=="pcompras"~"Compras",
                             actividad=="pedeportivos"~"Eventos deportivos /culturales",
                             actividad=="pactnoct"~"Actividades nocturnas",
                             actividad=="pbajadif"~"Act. baja dificultad en naturaleza",
                             actividad=="pparquesnac"~"Visita parques nacionales",
                             actividad=="pnieve"~"Acts. en la nieve",
                             actividad=="pvino"~"Acts. vinculadas al vino",
                             actividad=="potras"~"Otras actividades"))

ranking1 <- etie27 %>% 
  filter(orig_cristo=="Chile") %>% 
  arrange(peso)%>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades")) %>% 
  filter(actividad!="otras actividades")


ranking2 <- etie27 %>% 
  filter(orig_cristo=="Resto del mundo") %>% 
  arrange(peso)%>%
  mutate(actividad=case_when(actividad=="Act. Gastronómicas"~"actividades gastronómicas",
                             actividad=="Acts. lugares urbanos"~"actividades en lugares urbanos",
                             actividad=="Actividades nocturnas"~"actividades nocturnas",
                             actividad=="Act. baja dificultad en naturaleza"~"actividades de baja dificultad en la naturaleza",
                             actividad=="Visita parques nacionales"~"visita a parques nacionales",
                             actividad=="Eventos deportivos /culturales"~"asistencia a eventos deportivos o culturales",
                             actividad=="Tur. Aventura"~"turismo aventura",
                             actividad=="Acts. vinculadas al vino"~"actividades vinculadas al vino",
                             actividad=="Compras"~"compras",
                             actividad=="Tango"~"actividades vinculadas al tango",
                             actividad=="Trat. médicos"~"tratamientos médicos",
                             actividad=="Acts. en la nieve"~"actividades en la nieve",
                             actividad=="Aprendizaje español"~"aprendizaje del idioma español",
                             actividad=="Otras actividades"~"otras actividades")) %>% 
  filter(actividad!="otras actividades")



```

Finalmente, al segmentar las actividades realizadas en **Cristo Redentor** según país de residencia, se destaca que los residentes en **Chile**, mayormente, realizaron **"`r ranking1[nrow(ranking1),2]`"**, seguidas por "`r ranking1[nrow(ranking1)-1,2]`"; en tanto que los turistas residentes en el **Resto del mundo**, realizaron **"`r ranking2[nrow(ranking2),2]`"**, en primer lugar y, luego, "`r ranking2[nrow(ranking2)-1,2]`".

```{r eti27, fig.cap=glue("Participación porcentual de las actividades realizadas según lugar de residencia. Paso Internacional Cristo Redentor. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etie27 %>% mutate (orig_cristo=factor(orig_cristo,levels =c("Chile",
                                                                        "Resto del mundo")),
                               actividad=factor(actividad,levels = ranking)),
       aes(x=peso,y=actividad,fill=actividad,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~orig_cristo)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuenet: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie27,ranking,ranking1,ranking2)

```


```{r}

#Calificación promedio

#Insumo:

tinterno <- eti_e_perfiles %>% 
  filter((p40_1>=1 & p40_1<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_1*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(tinterno=calif/nbase) %>% 
  select(1,4)
  
alojamiento <- eti_e_perfiles %>% 
  filter((p40_2>=1 & p40_2<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_2*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(alojamiento=calif/nbase) %>% 
  select(1,4)

gastro <- eti_e_perfiles %>% 
  filter((p40_3>=1 & p40_3<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_3*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(gastro=calif/nbase) %>% 
  select(1,4)

info <- eti_e_perfiles %>% 
  filter((p40_4>=1 & p40_4<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_4*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(info=calif/nbase) %>% 
  select(1,4)

higiene <- eti_e_perfiles %>% 
  filter((p40_5>=1 & p40_5<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_5*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(higiene=calif/nbase) %>% 
  select(1,4)

seguridad <- eti_e_perfiles %>% 
  filter((p40_6>=1 & p40_6<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_6*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(seguridad=calif/nbase) %>% 
  select(1,4)

estadia <- eti_e_perfiles %>% 
  filter((p40_7>=1 & p40_7<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_7*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(estadia=calif/nbase) %>% 
  select(1,4)

inout <- eti_e_perfiles %>% 
  filter((p40_8>=1 & p40_8<=5) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(calif=sum(p40_8*wpf,na.rm = TRUE),
            nbase=sum(viajeros*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(inout=calif/nbase) %>% 
  select(1,4)

calif <- left_join(tinterno,alojamiento)
calif <- left_join(calif,gastro)
calif <- left_join(calif,info)
calif <- left_join(calif,higiene)
calif <- left_join(calif,seguridad)
calif <- left_join(calif,estadia)
calif <- left_join(calif,inout)

etie28 <- calif %>% 
  pivot_longer(cols=c(2:9),
               names_to = "rubro",
               values_to="valor") %>% 
  mutate(rubro=case_when(rubro=="tinterno"~"Transporte interno",
                         rubro=="alojamiento"~"Alojamiento",
                         rubro=="gastro"~"Gastronomía",
                         rubro=="info"~"Información turística",
                         rubro=="higiene"~"Higiene",
                         rubro=="seguridad"~"Seguridad",
                         rubro=="estadia"~"Estadía en general",
                         rubro=="inout"~"In out del aeropuerto"),
         valor=round(valor,1)) 

para_ranking  <- etie28 %>% 
  filter(paso_final=="Total") %>% 
  arrange(valor)

ranking <- para_ranking$rubro

ranking_total <- etie28 %>% filter(paso_final=="Total") %>% arrange(valor)
ranking_eya <- etie28 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(valor)
ranking_cor <- etie28 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(valor)
ranking_mza <- etie28 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(valor)
ranking_pue <- etie28 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(valor)
ranking_cto <- etie28 %>% filter(paso_final=="Cristo Redentor") %>% arrange(valor)


rm(tinterno,alojamiento,gastro,info,higiene,seguridad,estadia,inout,calif)


```

**En la suma de los 6 pasos relevados**, observamos que **"`r ranking_total[nrow(ranking_total),2]`"** fue el rubro mejor valorado por los turistas no residentes (con una calificación promedio de `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")` -en escala de 1 a 5-); seguida por **"`r ranking_total[nrow(ranking_total)-1,2]`"** y **"`r ranking_total[nrow(ranking_total)-2,2]`"**. 

Cuando se desagrega la información por paso, en **Ezeiza y Aeroparque, el Aeropuerto de Córdoba en el Aeropuerto de Mendoza y en el Puerto de Buenos Aires** se destacarón la **"Estadía en general"** y la **"Gastronomía"**; mientras que en **Cristo Redentor** las mayores valoraciones las alcanzaron la **"Estadía en general"** y el **"in out del aeropuerto"**. 


```{r eti28, fig.cap=glue("Calificación promedio (sobre escala de 1 a 5) por paso, según rubro. Año {anio_ref}.")}

#Calificación promedio

#Gráfico:

ggplot(data=etie28 %>% mutate (rubro=factor(rubro,levels = ranking),
                               paso_final=factor(paso_final,
                                                 levels = c("Total",
                                                            "Ezeiza y Aeroparque",
                                                            "Aep. Córdoba",
                                                            "Aep. Mendoza",
                                                            "Puerto de Buenos Aires",
                                                            "Cristo Redentor"))),
       aes(x=valor,y=rubro,fill=rubro,
           label=valor))+
  geom_col()+ 
  facet_wrap(~paso_final)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie28,ranking, para_ranking,ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)



```

```{r}
#Insumo:

etie29 <- eti_e_perfiles %>% 
  filter(p17_1 %in% c(1,5,6,9) & p3_3==anio_ref) %>%
  group_by(paso_final) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            pcio_cal=sum(p41a_1r*wpf,na.rm = TRUE),
            naturaleza=sum(p41a_2r*wpf,na.rm = TRUE),
            cultura=sum(p41a_3r*wpf,na.rm = TRUE),
            proximidad=sum(p41a_4r*wpf,na.rm = TRUE),
            gfriend=sum(p41a_5r*wpf,na.rm = TRUE),
            act_esp=sum(p41a_6r*wpf,na.rm = TRUE),
            otros=sum(p41a_71r*wpf,na.rm = TRUE),
            amigos=sum(p41a_8r*wpf,na.rm = TRUE),
            iva=sum(p41a_9r*wpf,na.rm = TRUE)) %>%
  ungroup() %>% 
  adorn_totals() %>% 
  mutate(pcio_cal=pcio_cal/viajeros,
         naturaleza=naturaleza/viajeros,
         cultura=cultura/viajeros,
         proximidad=proximidad/viajeros,
         gfriend=gfriend/viajeros,
         act_esp=act_esp/viajeros,
         otros=otros/viajeros,
         amigos=amigos/viajeros,
         iva=iva/viajeros) %>% 
  select(-viajeros) %>% 
  pivot_longer(cols=c(2:10),
               names_to = "aspecto",
               values_to="valor") %>% 
  mutate(aspecto=case_when(aspecto=="pcio_cal"~"Relación precio/calidad",
                         aspecto=="naturaleza"~"Diversidad naturaleza",
                         aspecto=="cultura"~"Valores culturales",
                         aspecto=="proximidad"~"Proximidad",
                         aspecto=="gfriend"~"País gay friendly",
                         aspecto=="act_esp"~"Actividades específicas del país",
                         aspecto=="otros"~"Otros",
                         aspecto=="amigos"~"Presencia amigos/flia",
                         aspecto=="iva"~"Reintegro del iva"),
         valor=(round(valor,3))*100) 


para_ranking  <- etie29 %>% 
  filter(paso_final=="Total") %>% 
  arrange(valor) %>% 
  mutate(secuencia=as.numeric(seq(1:9))) %>% 
  mutate(secuencia=case_when(aspecto=="Otros"~0,
                             TRUE~secuencia)) %>% 
  arrange(secuencia)

ranking <- para_ranking$aspecto

texto <- etie29 %>% 
  mutate(aspecto=case_when(aspecto=="Relación precio/calidad"~"la relación precio-calidad del país",
                           aspecto=="Diversidad naturaleza"~"la diversidad de la naturaleza",
                           aspecto=="Valores culturales"~"los valores culturales",
                           aspecto=="Proximidad"~"la proximidad con el país de origen",
                           aspecto=="País gay friendly"~"que la Argentina es un país gay friendly",
                           aspecto=="Actividades específicas del país"~"la realización de actividades específicas en el país",
                           aspecto=="Otros"~"otros aspectos",
                           aspecto=="Presencia amigos/flia"~"presencia de familiares o amigos",
                           aspecto=="Reintegro del iva"~"el reintegro del IVA"))

ranking_total <- texto %>% filter(paso_final=="Total") %>% arrange(valor)
ranking_eya <- texto %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(valor)
ranking_cor <- texto %>% filter(paso_final=="Aep. Córdoba") %>% arrange(valor)
ranking_mza <- texto %>% filter(paso_final=="Aep. Mendoza") %>% arrange(valor)
ranking_pue <- texto %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(valor)
ranking_cto <- texto %>% filter(paso_final=="Cristo Redentor") %>% arrange(valor)

rm(para_ranking,texto)


```

El aspecto de mayor influencia para la selección de nuestro país como destino de viaje fue **"`r ranking_total[nrow(ranking_total),2]`"** (el `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% de los turistas mencionó dicho aspecto); mencionando en segundo lugar **"`r ranking_total[nrow(ranking_total)-1,2]`"** y **"`r ranking_total[nrow(ranking_total)-2,2]`"**. 

En **Ezeiza y Aeroparque** el principal aspecto de influencia fue **"`r ranking_eya[nrow(ranking_eya),2]`"**; **"`r ranking_cor[nrow(ranking_cor),2]`"** en el **Aeropuerto de Córdoba**; **"`r ranking_mza[nrow(ranking_mza),2]`"** en el **Aeropuerto de Mendoza**; **"`r ranking_pue[nrow(ranking_pue),2]`"** en el **Puerto de Buenos Aires** y  **"`r ranking_cto[nrow(ranking_cto),2]`"** en  **Cristo Redentor**.  


```{r eti29, fig.cap=glue("Peso porcentual de los aspectos que influyeron a la hora de elegir la Argentina. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etie29 %>% mutate (aspecto=factor(aspecto,levels = ranking),
                               paso_final=factor(paso_final,
                                                 levels = c("Total",
                                                            "Ezeiza y Aeroparque",
                                                            "Aep. Córdoba",
                                                            "Aep. Mendoza",
                                                            "Puerto de Buenos Aires",
                                                            "Cristo Redentor"))),
       aes(x=valor,y=aspecto,fill=aspecto,
           label=glue("{valor} %")))+
  geom_col()+ 
  facet_wrap(~paso_final)+
  geom_text(hjust = "inward") +
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  scale_fill_dnmye(reverse = TRUE)+
  theme_minimal()+
  theme(plot.caption  = element_text(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_blank(),
        panel.background = element_blank())

rm(etie29,ranking, ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}
###EZEIZA Y AEROPARQUE:

#Insumo:

etie30_p <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Ezeiza y Aeroparque") %>% 
  summarise(pern_caba=sum(noch1*wpf,na.rm = TRUE),
            pern_catl=sum(noch2*wpf,na.rm = TRUE),
            pern_pmadryn=sum(noch3*wpf,na.rm = TRUE),
            pern_ciguazu=sum(noch4*wpf,na.rm = TRUE),
            pern_pcord=sum(noch5*wpf,na.rm = TRUE),
            pern_psaltucjuj=sum(noch6*wpf,na.rm = TRUE),
            pern_pmza=sum(noch7*wpf,na.rm = TRUE),
            pern_ush=sum(noch8*wpf,na.rm = TRUE),
            pern_calafate=sum(noch9*wpf,na.rm = TRUE),
            pern_barvasm=sum(noch10*wpf,na.rm = TRUE),
            pern_rosario=sum(noch11*wpf,na.rm = TRUE),
            pern_antar=sum(noch12*wpf,na.rm = TRUE),
            pern_restopba=sum(noch13*wpf,na.rm = TRUE),
            pern_restonor=sum(noch14*wpf,na.rm = TRUE),
            pern_restocuyo=sum(noch15_sin_mza*wpf,na.rm = TRUE),
            pern_restopata=sum(noch16_sin_mza*wpf,na.rm = TRUE),
            pern_restolito=sum(noch17*wpf,na.rm = TRUE),
            total=sum(totaln*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:17),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="pern_caba"~"CABA",
                           destino=="pern_catl"~"Costa Atlántica",
                           destino=="pern_pmadryn"~"Puerto Madryn",
                           destino=="pern_ciguazu"~"Cataratas Iguazú",
                           destino=="pern_pcord"~"Pcia. Córdoba",
                           destino=="pern_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="pern_pmza"~"Pcia. Mendoza",
                           destino=="pern_ush"~"Ushuaia",
                           destino=="pern_calafate"~"Calafate",
                           destino=="pern_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="pern_rosario"~"Rosario",
                           destino=="pern_antar"~"Antártida",
                           destino=="pern_restopba"~"Resto PBA.",
                           destino=="pern_restonor"~"Resto Norte",
                           destino=="pern_restocuyo"~"Resto Cuyo",
                           destino=="pern_restopata"~"Resto Patagonia",
                           destino=="pern_restolito"~"Resto Litoral")) %>% 
  mutate(variable="Pernoctes") %>% 
  arrange(peso)


orden <- (etie30_p$destino)



etie30_v <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Ezeiza y Aeroparque") %>% 
  summarise(viaj_caba=sum(p21_11*wpf,na.rm = TRUE),
            viaj_catl=sum(p21_21*wpf,na.rm = TRUE),
            viaj_pmadryn=sum(p21_31*wpf,na.rm = TRUE),
            viaj_ciguazu=sum(p21_41*wpf,na.rm = TRUE),
            viaj_pcord=sum(p21_51*wpf,na.rm = TRUE),
            viaj_psaltucjuj=sum(p21_61*wpf,na.rm = TRUE),
            viaj_pmza=sum(p21_71*wpf,na.rm = TRUE),
            viaj_ush=sum(p21_81*wpf,na.rm = TRUE),
            viaj_calafate=sum(p21_91*wpf,na.rm = TRUE),
            viaj_barvasm=sum(p21_101*wpf,na.rm = TRUE),
            viaj_rosario=sum(p21_111*wpf,na.rm = TRUE),
            viaj_antar=sum(p21_121*wpf,na.rm = TRUE),
            viaj_restopba=sum(p21_131*wpf,na.rm = TRUE),
            viaj_restonor=sum(p21_141*wpf,na.rm = TRUE),
            viaj_restocuyo=sum(p21_151_sin_mza*wpf,na.rm = TRUE),
            viaj_restopata=sum(p21_161_sin_mza*wpf,na.rm = TRUE),
            viaj_restolito=sum(p21_171*wpf,na.rm = TRUE),
            total=sum(viajeros*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:17),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="viaj_caba"~"CABA",
                           destino=="viaj_catl"~"Costa Atlántica",
                           destino=="viaj_pmadryn"~"Puerto Madryn",
                           destino=="viaj_ciguazu"~"Cataratas Iguazú",
                           destino=="viaj_pcord"~"Pcia. Córdoba",
                           destino=="viaj_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="viaj_pmza"~"Pcia. Mendoza",
                           destino=="viaj_ush"~"Ushuaia",
                           destino=="viaj_calafate"~"Calafate",
                           destino=="viaj_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="viaj_rosario"~"Rosario",
                           destino=="viaj_antar"~"Antártida",
                           destino=="viaj_restopba"~"Resto PBA.",
                           destino=="viaj_restonor"~"Resto Norte",
                           destino=="viaj_restocuyo"~"Resto Cuyo",
                           destino=="viaj_restopata"~"Resto Patagonia",
                           destino=="viaj_restolito"~"Resto Litoral")) %>% 
  mutate(variable="Turistas") %>% 
  arrange(peso)


etie30 <- etie30_p %>% 
  rbind(etie30_v)

```

En los pasos **Ezeiza y Aeroparque** el principal destino visitado por los turistas no residentes fue **`r etie30_p[nrow(etie30_p),1]`** (el `r format(round(1*etie30_p[nrow(etie30_p),2],1),decimal.mark = ",",big.mark = ".")`% de las pernoctaciones y el `r format(round(1*etie30_v[nrow(etie30_v),2],1),decimal.mark = ",",big.mark = ".")`% de los turistas se registraron en dicho destino).


```{r eti30, fig.cap=glue("Distribución de los pernoctes y turistas según destinos visitados.Ezeiza y Aeroparque. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie30 %>%mutate(destino = factor(destino,levels=orden)),
       aes(x=peso,y=destino,fill=destino,
           label=glue("{peso} %")))+
  facet_wrap(~variable)+
  geom_col()+ 
  geom_text(hjust = "inward") +
  scale_fill_dnmye(reverse = TRUE)+
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal",size=16),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.background = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.x=element_blank())

rm(etie30,etie30_p,etie30_v)



```

```{r}

###PUERTO:

#Insumos:

etie31_p <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Puerto de Buenos Aires") %>% 
  summarise(pern_caba=sum(noch1*wpf,na.rm = TRUE),
            pern_catl=sum(noch2*wpf,na.rm = TRUE),
            pern_pmadryn=sum(noch3*wpf,na.rm = TRUE),
            pern_ciguazu=sum(noch4*wpf,na.rm = TRUE),
            pern_pcord=sum(noch5*wpf,na.rm = TRUE),
            pern_psaltucjuj=sum(noch6*wpf,na.rm = TRUE),
            pern_pmza=sum(noch7*wpf,na.rm = TRUE),
            pern_ush=sum(noch8*wpf,na.rm = TRUE),
            pern_calafate=sum(noch9*wpf,na.rm = TRUE),
            pern_barvasm=sum(noch10*wpf,na.rm = TRUE),
            pern_rosario=sum(noch11*wpf,na.rm = TRUE),
            pern_antar=sum(noch12*wpf,na.rm = TRUE),
            pern_restopba=sum(noch13*wpf,na.rm = TRUE),
            pern_restonor=sum(noch14*wpf,na.rm = TRUE),
            pern_restocuyo=sum(noch15_sin_mza*wpf,na.rm = TRUE),
            pern_restopata=sum(noch16_sin_mza*wpf,na.rm = TRUE),
            pern_restolito=sum(noch17*wpf,na.rm = TRUE),
            total=sum(totaln*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:17),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="pern_caba"~"CABA",
                           destino=="pern_catl"~"Costa Atlántica",
                           destino=="pern_pmadryn"~"Puerto Madryn",
                           destino=="pern_ciguazu"~"Cataratas Iguazú",
                           destino=="pern_pcord"~"Pcia. Córdoba",
                           destino=="pern_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="pern_pmza"~"Pcia. Mendoza",
                           destino=="pern_ush"~"Ushuaia",
                           destino=="pern_calafate"~"Calafate",
                           destino=="pern_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="pern_rosario"~"Rosario",
                           destino=="pern_antar"~"Antártida",
                           destino=="pern_restopba"~"Resto PBA.",
                           destino=="pern_restonor"~"Resto Norte",
                           destino=="pern_restocuyo"~"Resto Cuyo",
                           destino=="pern_restopata"~"Resto Patagonia",
                           destino=="pern_restolito"~"Resto Litoral")) %>% 
  mutate(variable="Pernoctes") %>% 
  arrange(peso)


orden <- (etie31_p$destino)


etie31_v <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Puerto de Buenos Aires") %>% 
  summarise(viaj_caba=sum(p21_11*wpf,na.rm = TRUE),
            viaj_catl=sum(p21_21*wpf,na.rm = TRUE),
            viaj_pmadryn=sum(p21_31*wpf,na.rm = TRUE),
            viaj_ciguazu=sum(p21_41*wpf,na.rm = TRUE),
            viaj_pcord=sum(p21_51*wpf,na.rm = TRUE),
            viaj_psaltucjuj=sum(p21_61*wpf,na.rm = TRUE),
            viaj_pmza=sum(p21_71*wpf,na.rm = TRUE),
            viaj_ush=sum(p21_81*wpf,na.rm = TRUE),
            viaj_calafate=sum(p21_91*wpf,na.rm = TRUE),
            viaj_barvasm=sum(p21_101*wpf,na.rm = TRUE),
            viaj_rosario=sum(p21_111*wpf,na.rm = TRUE),
            viaj_antar=sum(p21_121*wpf,na.rm = TRUE),
            viaj_restopba=sum(p21_131*wpf,na.rm = TRUE),
            viaj_restonor=sum(p21_141*wpf,na.rm = TRUE),
            viaj_restocuyo=sum(p21_151_sin_mza*wpf,na.rm = TRUE),
            viaj_restopata=sum(p21_161_sin_mza*wpf,na.rm = TRUE),
            viaj_restolito=sum(p21_171*wpf,na.rm = TRUE),
            total=sum(viajeros*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:17),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="viaj_caba"~"CABA",
                           destino=="viaj_catl"~"Costa Atlántica",
                           destino=="viaj_pmadryn"~"Puerto Madryn",
                           destino=="viaj_ciguazu"~"Cataratas Iguazú",
                           destino=="viaj_pcord"~"Pcia. Córdoba",
                           destino=="viaj_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="viaj_pmza"~"Pcia. Mendoza",
                           destino=="viaj_ush"~"Ushuaia",
                           destino=="viaj_calafate"~"Calafate",
                           destino=="viaj_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="viaj_rosario"~"Rosario",
                           destino=="viaj_antar"~"Antártida",
                           destino=="viaj_restopba"~"Resto PBA.",
                           destino=="viaj_restonor"~"Resto Norte",
                           destino=="viaj_restocuyo"~"Resto Cuyo",
                           destino=="viaj_restopata"~"Resto Patagonia",
                           destino=="viaj_restolito"~"Resto Litoral")) %>% 
  mutate(variable="Turistas") %>% 
  arrange(peso)


etie31 <- etie31_p %>% 
  rbind(etie31_v)


```

En el **Puerto de Buenos Aires**,  **`r etie31_p[nrow(etie31_p),1]`** fue el principal destino visitado (`r format(round(1*etie31_p[nrow(etie31_p),2],1),decimal.mark = ",",big.mark = ".")`% de las pernoctaciones y `r format(round(1*etie31_v[nrow(etie31_v),2],1),decimal.mark = ",",big.mark = ".")`% de los viajeros).


```{r eti31, fig.cap=glue("Distribución de los pernoctes y turistas según destinos visitados. Puerto de Buenos Aires. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etie31 %>%mutate(destino = factor(destino,levels=orden)),
       aes(x=peso,y=destino,fill=destino,
           label=glue("{peso} %")))+
  facet_wrap(~variable)+
  geom_col()+ 
  geom_text(hjust = "inward") +
  scale_fill_dnmye(reverse = TRUE)+
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.background = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.x=element_blank())

rm(etie31,etie31_p,etie31_v)



```

```{r}
#AEROPUERTO DE CÓRDOBA:

#Insumos:

#Pernoctes

etie32_p <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Córdoba") %>% 
  summarise(pern_caba=sum(noch1*wpf,na.rm = TRUE),
            pern_psaltucjuj=sum(noch6*wpf,na.rm = TRUE),
            pern_antar=sum(noch12*wpf,na.rm = TRUE),
            pern_restonor=sum(noch14*wpf,na.rm = TRUE),
            pern_restocuyo=sum(noch15_sin_mza*wpf,na.rm = TRUE),
            pern_restolito=sum(noch17*wpf,na.rm = TRUE),
            pern_ccord=sum(noch19*wpf,na.rm = TRUE),
            pern_trasla=sum(noch20*wpf,na.rm = TRUE),
            pern_punilla=sum(noch21*wpf,na.rm = TRUE),
            pern_calamu=sum(noch22*wpf,na.rm = TRUE),
            pern_restocord=sum(noch23*wpf,na.rm = TRUE),
            pern_pba=sum(noch24*wpf,na.rm = TRUE),
            pern_patagonia=sum(noch28*wpf,na.rm = TRUE),
            pern_rosario=sum(noch11*wpf,na.rm = TRUE),
            pern_mza=sum(noch7*wpf,na.rm = TRUE),
            total=sum(totaln*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:15),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="pern_caba"~"CABA",
                           destino=="pern_psaltucjuj"~"Salta/Tuc./Jujuy",
                           destino=="pern_antar"~"Antártida",
                           destino=="pern_restonor"~"Resto Norte",
                           destino=="pern_restocuyo"~"Resto Cuyo",
                           destino=="pern_restolito"~"Resto Litoral",
                           destino=="pern_ccord"~"Córdoba (ciudad)",
                           destino=="pern_trasla"~"Traslasierra",
                           destino=="pern_punilla"~"Punilla",
                           destino=="pern_calamu"~"Calamuchita",
                           destino=="pern_restocord"~"Resto Pcia. Córdoba",
                           destino=="pern_pba"~"PBA",
                           destino=="pern_patagonia"~"Patagonia",
                           destino=="pern_rosario"~"Rosario",
                           destino=="pern_mza"~"Mendoza")) %>% 
  arrange(peso) %>% 
  mutate(variable="Pernoctes")


orden <- (etie32_p$destino)

#Viajeros

etie32_v <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Córdoba") %>% 
  summarise(viaj_caba=sum(p21_11*wpf,na.rm = TRUE),
            viaj_psaltucjuj=sum(p21_61*wpf,na.rm = TRUE),
            viaj_antar=sum(p21_121*wpf,na.rm = TRUE),
            viaj_restonor=sum(p21_141*wpf,na.rm = TRUE),
            viaj_restocuyo=sum(p21_151_sin_mza*wpf,na.rm = TRUE),
            viaj_restolito=sum(p21_171*wpf,na.rm = TRUE),
            viaj_ccord=sum(p21_191*wpf,na.rm = TRUE),
            viaj_trasla=sum(p21_201*wpf,na.rm = TRUE),
            viaj_punilla=sum(p21_211*wpf,na.rm = TRUE),
            viaj_calamu=sum(p21_221*wpf,na.rm = TRUE),
            viaj_restocord=sum(p21_231*wpf,na.rm = TRUE),
            viaj_pba=sum(p21_241*wpf,na.rm = TRUE),
            viaj_patagonia=sum(p21_281*wpf,na.rm = TRUE),
            viaj_rosario=sum(p21_111*wpf,na.rm = TRUE),
            viaj_mza=sum(p21_71*wpf,na.rm = TRUE),
            total=sum(viajeros*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:15),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="viaj_caba"~"CABA",
                           destino=="viaj_psaltucjuj"~"Salta/Tuc./Jujuy",
                           destino=="viaj_antar"~"Antártida",
                           destino=="viaj_restonor"~"Resto Norte",
                           destino=="viaj_restocuyo"~"Resto Cuyo",
                           destino=="viaj_restolito"~"Resto Litoral",
                           destino=="viaj_ccord"~"Córdoba (ciudad)",
                           destino=="viaj_trasla"~"Traslasierra",
                           destino=="viaj_punilla"~"Punilla",
                           destino=="viaj_calamu"~"Calamuchita",
                           destino=="viaj_restocord"~"Resto Pcia. Córdoba",
                           destino=="viaj_pba"~"PBA",
                           destino=="viaj_patagonia"~"Patagonia",
                           destino=="viaj_rosario"~"Rosario",
                           destino=="viaj_mza"~"Mendoza")) %>% 
  arrange(peso) %>% 
  mutate(variable="Viajeros")

#BASE TOTAL:

etie32 <- etie32_p %>% 
  rbind(etie32_v)



```

En el **Aeropuerto de Córdoba**, los turistas visitaron en mayor medida **`r etie32_p[nrow(etie32_p),1]`** (`r format(round(1*etie32_p[nrow(etie32_p),2],1),decimal.mark = ",",big.mark = ".")`% de las pernoctaciones y `r format(round(1*etie32_v[nrow(etie32_v),2],1),decimal.mark = ",",big.mark = ".")`% de los viajeros).


```{r eti32, fig.cap=glue("Distribución de los pernoctes y turistas según destinos visitados. Aeropuerto Internacional de Córdoba. Año {anio_ref}.")}


#Gráfico:


ggplot(data=etie32 %>%mutate(destino = factor(destino,levels=orden)),
       aes(x=peso,y=destino,fill=destino,
           label=glue("{peso} %")))+
  geom_col()+
  facet_wrap(~variable)+
  geom_text(hjust = "inward") +
  scale_fill_dnmye(reverse = TRUE)+
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.background = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.x=element_blank())

rm(etie32,etie32_p,etie32_v)


```

```{r}

###AEROPUERTO DE MENDOZA:

#Insumos:

#Pernoctes

etie33_p <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Mendoza") %>% 
  summarise(pern_caba=sum(noch1*wpf,na.rm = TRUE),
            pern_ciguazu=sum(noch4*wpf,na.rm = TRUE),
            pern_pcord=sum(noch5*wpf,na.rm = TRUE),
            pern_psaltucjuj=sum(noch6*wpf,na.rm = TRUE),
            pern_calafate=sum(noch9*wpf,na.rm = TRUE),
            pern_barvasm=sum(noch10*wpf,na.rm = TRUE),
            pern_rosario=sum(noch11*wpf,na.rm = TRUE),
            pern_restonor=sum(noch14*wpf,na.rm = TRUE),
            pern_restocuyo=sum(noch15_sin_mza*wpf,na.rm = TRUE),
            pern_restopata=sum(noch16_sin_mza*wpf,na.rm = TRUE),
            pern_restolito=sum(noch17*wpf,na.rm = TRUE),
            pern_cmza=sum(noch30*wpf,na.rm = TRUE),
            pern_srafael=sum(noch31*wpf,na.rm = TRUE),
            pern_malar=sum(noch32*wpf,na.rm = TRUE),
            pern_restopciamza=sum(noch33*wpf,na.rm = TRUE),
            pern_pciasanjuan=sum(noch34*wpf,na.rm = TRUE),
            pern_pciachubut=sum(noch35*wpf,na.rm = TRUE),
            pern_restoneuquen=sum(noch36*wpf,na.rm = TRUE),
            total=sum(totaln*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:18),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="pern_caba"~"CABA",
                           destino=="pern_ciguazu"~"Cataratas Iguazú",
                           destino=="pern_pcord"~"Pcia. Córdoba",
                           destino=="pern_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="pern_calafate"~"Calafate",
                           destino=="pern_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="pern_rosario"~"Rosario",
                           destino=="pern_restopba"~"Resto PBA.",
                           destino=="pern_restonor"~"Resto Norte",
                           destino=="pern_restocuyo"~"Resto Cuyo",
                           destino=="pern_restopata"~"Resto Patagonia",
                           destino=="pern_restolito"~"Resto Litoral",
                           destino=="pern_cmza"~"Mendoza (ciudad)",
                           destino=="pern_srafael"~"San Rafael",
                           destino=="pern_malar"~"Malargue/Leñas",
                           destino=="pern_restopciamza"~"Resto Pcia. Mdza.",
                           destino=="pern_pciasanjuan"~"Pcia. San Juan",
                           destino=="pern_pciachubut"~"Pcia. Chubut",
                           destino=="pern_restoneuquen"~"Resto Neuquén")) %>% 
  arrange(peso) %>% 
  mutate(variable="Pernoctes")


orden <- (etie33_p$destino)

#Viajeros:

etie33_v <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Aep. Mendoza") %>% 
  summarise(viaj_caba=sum(p21_11*wpf,na.rm = TRUE),
            viaj_ciguazu=sum(p21_41*wpf,na.rm = TRUE),
            viaj_pcord=sum(p21_51*wpf,na.rm = TRUE),
            viaj_psaltucjuj=sum(p21_61*wpf,na.rm = TRUE),
            viaj_calafate=sum(p21_91*wpf,na.rm = TRUE),
            viaj_barvasm=sum(p21_101*wpf,na.rm = TRUE),
            viaj_rosario=sum(p21_111*wpf,na.rm = TRUE),
            viaj_restonor=sum(p21_141*wpf,na.rm = TRUE),
            viaj_restocuyo=sum(p21_151_sin_mza*wpf,na.rm = TRUE),
            viaj_restopata=sum(p21_161_sin_mza*wpf,na.rm = TRUE),
            viaj_restolito=sum(p21_171*wpf,na.rm = TRUE),
            viaj_cmza=sum(p21_301*wpf,na.rm = TRUE),
            viaj_srafael=sum(p21_311*wpf,na.rm = TRUE),
            viaj_malar=sum(p21_321*wpf,na.rm = TRUE),
            viaj_restopciamza=sum(p21_331*wpf,na.rm = TRUE),
            viaj_pciasanjuan=sum(p21_341*wpf,na.rm = TRUE),
            viaj_pciachubut=sum(p21_351*wpf,na.rm = TRUE),
            viaj_restoneuquen=sum(p21_361*wpf,na.rm = TRUE),
            total=sum(viajeros*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:18),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="viaj_caba"~"CABA",
                           destino=="viaj_ciguazu"~"Cataratas Iguazú",
                           destino=="viaj_pcord"~"Pcia. Córdoba",
                           destino=="viaj_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="viaj_calafate"~"Calafate",
                           destino=="viaj_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="viaj_rosario"~"Rosario",
                           destino=="viaj_restopba"~"Resto PBA.",
                           destino=="viaj_restonor"~"Resto Norte",
                           destino=="viaj_restocuyo"~"Resto Cuyo",
                           destino=="viaj_restopata"~"Resto Patagonia",
                           destino=="viaj_restolito"~"Resto Litoral",
                           destino=="viaj_cmza"~"Mendoza (ciudad)",
                           destino=="viaj_srafael"~"San Rafael",
                           destino=="viaj_malar"~"Malargue/Leñas",
                           destino=="viaj_restopciamza"~"Resto Pcia. Mdza.",
                           destino=="viaj_pciasanjuan"~"Pcia. San Juan",
                           destino=="viaj_pciachubut"~"Pcia. Chubut",
                           destino=="viaj_restoneuquen"~"Resto Neuquén")) %>% 
  arrange(peso) %>% 
  mutate(variable="Viajeros")

#BASE TOTAL:

etie33 <- etie33_p %>% 
  rbind(etie33_v)


```

En el **Aeropuerto de Mendoza**, el primer destino seleccionado por los turistas no residentes fue **`r etie33_v[nrow(etie33_v),1]`** (`r format(round(1*etie33_v[nrow(etie33_v),2],1),decimal.mark = ",",big.mark = ".")`% de los viajeros; `r format(round(1*etie33_p[nrow(etie33_p),2],1),decimal.mark = ",",big.mark = ".")`% de las pernoctaciones). 


```{r eti33, fig.cap=glue("Distribución de los pernoctes y turistas según destinos visitados. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie33 %>%mutate(destino = factor(destino,levels=orden)),
       aes(x=peso,y=destino,fill=destino,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~variable)+
  geom_text(hjust = "inward") +
  scale_fill_dnmye(reverse = TRUE)+
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_text(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.background = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.x=element_blank())

rm(etie33,etie33_p,etie33_v)


```

```{r}

###CRISTO REDENTOR:

#Insumos:

#Pernoctes

etie34_p <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Cristo Redentor") %>% 
  summarise(pern_caba=sum(noch1*wpf,na.rm = TRUE),
            pern_ciguazu=sum(noch4*wpf,na.rm = TRUE),
            pern_pcord=sum(noch5*wpf,na.rm = TRUE),
            pern_psaltucjuj=sum(noch6*wpf,na.rm = TRUE),
            pern_calafate=sum(noch9*wpf,na.rm = TRUE),
            pern_barvasm=sum(noch10*wpf,na.rm = TRUE),
            pern_rosario=sum(noch11*wpf,na.rm = TRUE),
            pern_restonor=sum(noch14*wpf,na.rm = TRUE),
            pern_restocuyo=sum(noch15_sin_mza*wpf,na.rm = TRUE),
            pern_restopata=sum(noch16_sin_mza*wpf,na.rm = TRUE),
            pern_restolito=sum(noch17*wpf,na.rm = TRUE),
            pern_cmza=sum(noch30*wpf,na.rm = TRUE),
            pern_srafael=sum(noch31*wpf,na.rm = TRUE),
            pern_malar=sum(noch32*wpf,na.rm = TRUE),
            pern_restopciamza=sum(noch33*wpf,na.rm = TRUE),
            pern_pciasanjuan=sum(noch34*wpf,na.rm = TRUE),
            pern_pciachubut=sum(noch35*wpf,na.rm = TRUE),
            pern_restoneuquen=sum(noch36*wpf,na.rm = TRUE),
            total=sum(totaln*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:18),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="pern_caba"~"CABA",
                           destino=="pern_ciguazu"~"Cataratas Iguazú",
                           destino=="pern_pcord"~"Pcia. Córdoba",
                           destino=="pern_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="pern_calafate"~"Calafate",
                           destino=="pern_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="pern_rosario"~"Rosario",
                           destino=="pern_restopba"~"Resto PBA.",
                           destino=="pern_restonor"~"Resto Norte",
                           destino=="pern_restocuyo"~"Resto Cuyo",
                           destino=="pern_restopata"~"Resto Patagonia",
                           destino=="pern_restolito"~"Resto Litoral",
                           destino=="pern_cmza"~"Mendoza (ciudad)",
                           destino=="pern_srafael"~"San Rafael",
                           destino=="pern_malar"~"Malargue/Leñas",
                           destino=="pern_restopciamza"~"Resto Pcia. Mdza.",
                           destino=="pern_pciasanjuan"~"Pcia. San Juan",
                           destino=="pern_pciachubut"~"Pcia. Chubut",
                           destino=="pern_restoneuquen"~"Resto Neuquén")) %>% 
  arrange(peso) %>% 
  mutate(variable="Pernoctes")


orden <- (etie34_p$destino)

#Viajeros:

etie34_v <- eti_e_perfiles %>%
  filter(p3_3==anio_ref,paso_final=="Cristo Redentor") %>% 
  summarise(viaj_caba=sum(p21_11*wpf,na.rm = TRUE),
            viaj_ciguazu=sum(p21_41*wpf,na.rm = TRUE),
            viaj_pcord=sum(p21_51*wpf,na.rm = TRUE),
            viaj_psaltucjuj=sum(p21_61*wpf,na.rm = TRUE),
            viaj_calafate=sum(p21_91*wpf,na.rm = TRUE),
            viaj_barvasm=sum(p21_101*wpf,na.rm = TRUE),
            viaj_rosario=sum(p21_111*wpf,na.rm = TRUE),
            viaj_restonor=sum(p21_141*wpf,na.rm = TRUE),
            viaj_restocuyo=sum(p21_151_sin_mza*wpf,na.rm = TRUE),
            viaj_restopata=sum(p21_161_sin_mza*wpf,na.rm = TRUE),
            viaj_restolito=sum(p21_171*wpf,na.rm = TRUE),
            viaj_cmza=sum(p21_301*wpf,na.rm = TRUE),
            viaj_srafael=sum(p21_311*wpf,na.rm = TRUE),
            viaj_malar=sum(p21_321*wpf,na.rm = TRUE),
            viaj_restopciamza=sum(p21_331*wpf,na.rm = TRUE),
            viaj_pciasanjuan=sum(p21_341*wpf,na.rm = TRUE),
            viaj_pciachubut=sum(p21_351*wpf,na.rm = TRUE),
            viaj_restoneuquen=sum(p21_361*wpf,na.rm = TRUE),
            total=sum(viajeros*wpf,na.rm = TRUE))%>% 
  pivot_longer(cols=c(1:18),
               names_to = "destino",
               values_to="valor") %>%
  mutate(peso=round(valor/total,3)*100) %>% 
  select(destino,peso) %>%
  mutate(destino=case_when(destino=="viaj_caba"~"CABA",
                           destino=="viaj_ciguazu"~"Cataratas Iguazú",
                           destino=="viaj_pcord"~"Pcia. Córdoba",
                           destino=="viaj_psaltucjuj"~"Salta, Tucumán o Jujuy",
                           destino=="viaj_calafate"~"Calafate",
                           destino=="viaj_barvasm"~"Bari./V. Angost./SM Andes",
                           destino=="viaj_rosario"~"Rosario",
                           destino=="viaj_restopba"~"Resto PBA.",
                           destino=="viaj_restonor"~"Resto Norte",
                           destino=="viaj_restocuyo"~"Resto Cuyo",
                           destino=="viaj_restopata"~"Resto Patagonia",
                           destino=="viaj_restolito"~"Resto Litoral",
                           destino=="viaj_cmza"~"Mendoza (ciudad)",
                           destino=="viaj_srafael"~"San Rafael",
                           destino=="viaj_malar"~"Malargue/Leñas",
                           destino=="viaj_restopciamza"~"Resto Pcia. Mdza.",
                           destino=="viaj_pciasanjuan"~"Pcia. San Juan",
                           destino=="viaj_pciachubut"~"Pcia. Chubut",
                           destino=="viaj_restoneuquen"~"Resto Neuquén")) %>% 
  arrange(peso) %>% 
  mutate(variable="Viajeros")

#BASE TOTAL:

etie34 <- etie34_p %>% 
  rbind(etie34_v)

```

Por último, en **Cristo Redentor**, se destacó como primer lugar visitado **`r etie34_v[nrow(etie34_v),1]`** (`r format(round(1*etie34_v[nrow(etie34_v),2],1),decimal.mark = ",",big.mark = ".")`% de los viajeros); pero la mayoría de las pernoctaciones se produjo en el **resto de la provincia**.


```{r eti34, fig.cap=glue("Distribución de los pernoctes y turistas según destinos visitados. Paso Internacional Cristo Redentor. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etie34 %>%mutate(destino = factor(destino,levels=orden)),
       aes(x=peso,y=destino,fill=destino,
           label=glue("{peso} %")))+
  geom_col()+ 
  facet_wrap(~variable)+
  geom_text(hjust = "inward") +
  scale_fill_dnmye(reverse = TRUE)+
  theme(legend.position='none')+
  labs(title = "",
       subtitle = glue(""),
       x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_text(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face="bold"),
        legend.title = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_line(color = "grey",
                                          linewidth = 0.3,
                                          linetype = 4),
        panel.grid.minor.y = element_blank(),
        panel.background = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        axis.text.x=element_blank())


rm(etie34,etie34_p,etie34_v)


```


### Turismo Emisivo

En el siguiente apartado se presentará información referida al turismo EMISIVO en los pasos relevados por la ETI en el año `r tolower(anio_ref)`.


```{r}

#Insumo:

etia1 <- eti_a %>% 
  group_by(p3_3,paso_final) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  ungroup() %>% 
  complete(p3_3 = seq(from = 2010, 
                      to = max(p3_3), 
                      by = 1),
           paso_final,
           fill = list(viajeros = NA_real_)) %>%
  pivot_wider(names_from = paso_final,
              values_from = viajeros)%>%
  mutate(`Ezeiza y Aeroparque`=case_when(p3_3==2020~750270,
                                         p3_3==2021~618152,
                                         p3_3==2010~1900833,
                                         p3_3==2011~2156625,
                                         p3_3==2012~2431953,
                                         p3_3==2013~2581537,
                                         TRUE~`Ezeiza y Aeroparque`),
         `Aep. Córdoba`=case_when(p3_3==2020~63339,
                                  p3_3==2021~5412,
                                  p3_3==2010~144101,
                                  p3_3==2011~187382,
                                  p3_3==2012~184144,
                                  p3_3==2013~186243,
                                  TRUE~`Aep. Córdoba`),
         `Puerto de Buenos Aires`=case_when(p3_3==2020~159930,
                                            p3_3==2021~75730,
                                            #p3_3==2012~430705,
                                            #p3_3==2013~597567,
                                            TRUE~`Puerto de Buenos Aires`),
         `Aep. Mendoza`=case_when(p3_3==2020~22584,
                                  p3_3==2021~6091,
                                  TRUE~`Aep. Mendoza`),
         `Cristo Redentor`=case_when(p3_3==2020~130703,
                                     p3_3==2021~4061,
                                     TRUE~`Cristo Redentor`)) %>%
  mutate(var_1=round((`Ezeiza y Aeroparque`/lag(`Ezeiza y Aeroparque`,1)-1),3),
         var_2=round((`Aep. Córdoba`/lag(`Aep. Córdoba`,1)-1),3),
         var_3=round((`Puerto de Buenos Aires`/lag(`Puerto de Buenos Aires`,1)-1),3),
         var_4=round((`Aep. Mendoza`/lag(`Aep. Mendoza`,1)-1),3),
         var_5=round((`Cristo Redentor`/lag(`Cristo Redentor`,1)-1),3)) %>% 
  select(p3_3,`Ezeiza y Aeroparque`,var_1,
         `Aep. Córdoba`,var_2,
         `Aep. Mendoza`,var_4,
         `Puerto de Buenos Aires`,var_3,
         `Cristo Redentor`,var_5) %>% 
  filter(p3_3>=2010) %>% 
  mutate(`Aep. Mendoza`=case_when(p3_3==2017~NA_real_,
                                  TRUE~`Aep. Mendoza`),
         var_4=case_when(p3_3==2017~NA_real_,
                         TRUE~var_4)) %>% 
  mutate(p3_3=as.character(p3_3))

```

En `r (anio_ref)` se contabilizaron `r format(round(as.numeric(etia1[nrow(etia1),2]),0), decimal.mark = ",", big.mark = ".")` turistas en **Ezeiza y Aeroparque** (`r format(round(100*etia1[nrow(etia1),3],1),decimal.mark = ",",big.mark = ".")`% i.a.); `r format(round(as.numeric(etia1[nrow(etia1),4]),0), decimal.mark = ",", big.mark = ".")` en el **Aeropuerto de Córdoba** (`r format(round(100*etia1[nrow(etia1),5],1),decimal.mark = ",",big.mark = ".")`% i.a.); `r format(round(as.numeric(etia1[nrow(etia1),6]),0), decimal.mark = ",", big.mark = ".")` en el **Aeropuerto de Mendoza** (`r format(round(100*etia1[nrow(etia1),7],1),decimal.mark = ",",big.mark = ".")`% i.a.); `r format(round(as.numeric(etia1[nrow(etia1),8]),0), decimal.mark = ",", big.mark = ".")` en el **Puerto de Buenos Aires** (`r format(round(100*etia1[nrow(etia1),9],1),decimal.mark = ",",big.mark = ".")`% i.a.) y `r format(round(as.numeric(etia1[nrow(etia1),10]),0), decimal.mark = ",", big.mark = ".")` en el **Paso Internacional Cristo Redentor** (`r format(round(100*etia1[nrow(etia1),11],1),decimal.mark = ",",big.mark = ".")`% i.a.).

```{r etia1 }

#Tabla:

etia1 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas residentes por año según paso. Años 2010-{anio_ref}.")) %>%
  cols_label(p3_3 = "Año",
             `Ezeiza y Aeroparque`="Turistas",
             `Aep. Córdoba`="Turistas",
             `Aep. Mendoza`="Turistas",
             `Puerto de Buenos Aires`="Turistas",
             `Cristo Redentor`="Turistas",
             var_1 ="var % i.a",
             var_2 = "var % i.a",
             var_3 = "var % i.a",
             var_4 = "var % i.a*",
             var_5 = "var % i.a")  %>%
  fmt_number(columns = c(2,4,6,8,10), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3,5,7,9,11), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
    data_row.padding = px(3),
    column_labels.font.size = 14,
    column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(2,4,6,8,10) ~ px(100),
             columns = c(3,5,7,9,11) ~ px(70),
             columns = c(1) ~ px(60)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "///") %>%
  tab_source_note(
    source_note = md("**(*)** El Aep. Int. de Mendoza comenzó a ser relevado en el 3er trim de 2017, no se incluyen los datos del 2017 ya que no hay datos del año completo.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_spanner(label = "Eze / Aep.", columns = c(2:3)) %>% 
  tab_spanner(label = "Aep. Córd.", columns = c(4:5)) %>% 
  tab_spanner(label = "Aep. Mend.*", columns = c(6:7)) %>%
  tab_spanner(label = "Puerto CABA", columns = c(8:9)) %>%
  tab_spanner(label = "Cto. Redentor", columns = c(10:11))%>%
  tab_style(
    style = list(
      cell_text(color = dnmye_colores("rosa"),weight =  "bold")
    ),
    locations = cells_body(
      columns = c(var_1),
      rows = var_1 <= 0
    )) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = nrow(etia1))
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = nrow(etia1)
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)

rm(etia1)

```



```{r}

#Ezeiza y aeroparque

#Insumo:

etia2 <- eti_a_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Ezeiza y Aeroparque") %>% 
  group_by(p3_3,dest_eya) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)


if (anio_ref %in%c(2021,2022)) {
  etia2 <- etia2 %>% select(dest_eya,t0,prop_)
} else {
  etia2 <- etia2 %>% select(dest_eya,t0,var_1,var_2,prop_)
}  

ranking <- etia2 %>% 
  arrange(prop_)

etia2 <- etia2 %>%
  mutate (dest_eya=factor(dest_eya,levels =c("Total","Bolivia",
                                             "Brasil","Chile",
                                             "Paraguay","Uruguay",
                                             "EE.UU y Canadá","Resto América",
                                             "Europa","Resto del Mundo"))) %>% 
  arrange(dest_eya)

```

En **Ezeiza y Aeroparque**, los turistas residentes en la Argentina tuvieron como principal destino **`r ranking[nrow(ranking)-1,1]`** (el `r format(round(100*ranking[nrow(ranking)-1,3],1),decimal.mark = ",",big.mark = ".")`% del total de los turistas).

```{r etia2 }

#Tabla:

etia2 %>%
  gt()%>%
  gt_theme_dnmye() %>%
  tab_caption(glue("Turistas residentes según destino visitado. Ezeiza y Aeroparque. Año {anio_ref}.")) %>%
  cols_label(dest_eya = "Destino",
             t0="Turistas",
             prop_ = "Distribución %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3),
              column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(140),
             columns = c(3) ~ px(140)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>% 
  cols_align(
    align = "left",
    columns = 1) %>%
  cols_align(
    align = "center",
    columns = 2:3) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 1er y 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)

rm(etia2,ranking)

```

```{r}

#AEP Córdoba

#Insumo:

etia3 <- eti_a_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Aep. Córdoba") %>% 
  group_by(p3_3,dest_cor) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros))%>%
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1) %>%
  mutate(t0=case_when(is.na(t0)~0,
                      TRUE~t0)) %>% 
  mutate(prop_=prop.table(t0)) %>% 
  ungroup() %>% 
  adorn_totals()



if (anio_ref %in%c(2021,2022)) {
  etia3 <- etia3 %>% select(dest_cor,t0,prop_)
} else {
  etia3 <- etia3 %>% select(dest_cor,t0,var_1,var_2,prop_)
}  

ranking <- etia3 %>% 
  arrange(prop_)

etia3 <- etia3 %>%
  mutate (dest_cor=factor(dest_cor,levels =c("Total","Brasil","Chile",
                                             "EE.UU y Canadá","Caribe","Resto América",
                                             "Europa y resto del mundo"))) %>% 
  arrange(dest_cor)

```

En el **Aeropuerto Internacional de Córdoba**, **`r ranking[nrow(ranking)-1,1]`** se destacó como principal destino (`r format(round(100*ranking[nrow(ranking)-1,3],1),decimal.mark = ",",big.mark = ".")`% del total).

```{r etia3 }


#Tabla en GT

etia3 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas residentes según destino visitado. Aeropuerto Internacional de Córdoba. Año {anio_ref}.")) %>%
  cols_label(dest_cor = "Destino",
             t0="Turistas",
             prop_ = "Distribución %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1) ~ px(160),
             columns = c(2:3) ~ px(140)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>%
  tab_header(
    subtitle ="",
    title =""
  ) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  #opt_all_caps() %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)


rm(etia3,ranking)

```

```{r}
# Puerto de buenos aires

#Insumo:

etia4 <- eti_a_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Puerto de Buenos Aires") %>% 
  group_by(p3_3,dest_puerto) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)

if (anio_ref %in%c(2021,2022)) {
  etia4 <- etia4 %>% select(dest_puerto,t0,prop_)
} else {
  etia4 <- etia4 %>% select(dest_puerto,t0,var_1,var_2,prop_)
}  

ranking <- etia4 %>% 
  arrange(prop_)

etia4 <- etia4 %>%
  mutate (dest_puerto=factor(dest_puerto,levels =c("Total","Uruguay",
                                                   "Resto del mundo"))) %>% 
  arrange(dest_puerto)

```

En el **Puerto de Buenos Aires**, la mayor cantidad de residentes tuvieron destino en **`r ranking[nrow(ranking)-1,1]`** (`r format(round(100*ranking[nrow(ranking)-1,3],1),decimal.mark = ",",big.mark = ".")`% del total).

```{r etia4 }

#Tabla:

etia4 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas residentes según destino visitado. Puerto de Buenos Aires. Año {anio_ref}.")) %>%
  cols_label(dest_puerto = "Destino",
             t0="Turistas",
             prop_ = "Distribución %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
    data_row.padding = px(3),
    column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(140),
             columns = c(3) ~ px(140)) %>%
  sub_missing(
    columns = everything(),
    missing_text = "-") %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))

rm(etia4,ranking)


```

```{r}

### Aep Mendoza

#Insumo:

etia5 <- eti_a_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Aep. Mendoza") %>% 
  group_by(p3_3,dest_mdza) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)

if (anio_ref %in%c(2021,2022)) {
  etia5 <- etia5 %>% select(dest_mdza,t0,prop_)
} else {
  etia5 <- etia5 %>% select(dest_mdza,t0,var_1,var_2,prop_)
}  

ranking <- etia5 %>% 
  arrange(prop_)

etia5 <- etia5 %>%
  mutate (dest_mdza=factor(dest_mdza,levels =c("Total","Brasil",
                                               "Chile","México y Caribe","EE.UU y Canadá",
                                               "Resto América",
                                               "Europa y resto del mundo"))) %>% 
  arrange(dest_mdza)


```

En el caso del **Aeropuerto Internacional de Mendoza**, fue **`r ranking[nrow(ranking)-1,1]`** el principal destino (`r format(round(100*ranking[nrow(ranking)-1,3],1),decimal.mark = ",",big.mark = ".")`% del total).

```{r etia5 }


#Tabla:

etia5 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas residentes según destino visitado. Aeropuerto Internacional de Mendoza. Año {anio_ref}.")) %>%
  cols_label(dest_mdza = "Destino",
             t0="Turistas",
             prop_ = "Distribución %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(#table.font.size = 12,
    data_row.padding = px(3),
    #column_labels.font.size = 14,
    column_labels.font.weight = "bold") %>% 
  cols_width(columns = c(1,2) ~ px(160),
             columns = c(3) ~ px(140)) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trim no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))

rm(etia5,ranking)

```

```{r}

###Cristo Redentor

#Insumo:

etia6 <- eti_a_perfiles %>%
  filter(p3_3>=anio_ref-2 & paso_final=="Cristo Redentor") %>% 
  group_by(p3_3,dest_cristo) %>% 
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE)) %>% 
  pivot_wider(names_from = p3_3,
              values_from = c(viajeros)) %>% 
  rename(t0=4,t_1=3,t_2=2) %>% 
  mutate(prop_=prop.table(t0))%>% 
  ungroup() %>% 
  adorn_totals() %>%
  mutate(var_1=(t0/t_1)-1,
         var_2=(t0/t_2)-1)


if (anio_ref %in%c(2021,2022)) {
  etia6 <- etia6 %>% select(dest_cristo,t0,prop_)
} else {
  etia6 <- etia6 %>% select(dest_cristo,t0,var_1,var_2,prop_)
}  

ranking <- etia6 %>% 
  arrange(prop_)

etia6 <- etia6 %>%
  mutate (dest_cristo=factor(dest_cristo,levels =c("Total","Chile",
                                                   "Resto del mundo"))) %>% 
  arrange(dest_cristo)

```

Finalmente, en el paso **Internacional Cristo Redentor**, **`r ranking[nrow(ranking)-1,1]`** se ubicó en primer lugar (`r format(round(100*ranking[nrow(ranking)-1,3],1),decimal.mark = ",",big.mark = ".")`% de las visitas de residentes en el país).


```{r etia6 }

#Tabla:

etia6 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Turistas residentes según destino visitado. Paso Internacional Cristo Redentor. Año {anio_ref}.")) %>%
  cols_label(dest_cristo = "Destino",
             t0="Turistas",
             prop_ = "Distribución %")  %>%
  fmt_number(columns = c(2), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_percent(columns = c(3), decimals = 1, dec_mark = ",", sep_mark = ".") %>%
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1,2) ~ px(160),
             columns = c(3) ~ px(140)) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** Datos que corresponden al 4to trim. de 2021, en el resto de los trims. no se realizó el relevamiento.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  #opt_all_caps() %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    ))


rm(etia6,ranking)


```

```{r}

# Llegadas de turistas no residentes por motivo de viaje

#Insumo:

etia7_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etia7 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etia7_total) %>% 
  mutate(prop_=round(prop_,3)*100)


rm(etia7_total)

ranking_total <- etia7 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia7 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia7 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia7 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia7 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia7 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)

etia7 <- etia7 %>% 
  mutate(motivo=factor(motivo,levels = c("Visita flia/amigos","Vacaciones/ocio/recreación",
                                         "Negocios/congreso/conferencia","Otros"))) 
  


```


En la **totalidad de los pasos relevados por la ETI**, se destacó como **primer motivo de viaje** **"`r ranking_total[nrow(ranking_total),2]`"** (el `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total). Dicho motivo **se repitió como el de mayor relevancia en cada uno de los pasos relevados.**

```{r etia7, fig.cap=glue("Distribución de los turistas residentes según motivo de viaje, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia7 %>% mutate(motivo=factor(motivo,
                                           levels = c("Visita flia/amigos",
                                                      "Vacaciones/ocio/recreación",
                                                      "Negocios/congreso/conferencia",
                                                      "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                                 levels = c("TOTAL",
                                                            "Eze. y Aep.",
                                                            "Aep. Cord.",
                                                            "Aep.Mza.",
                                                            "Puerto BA.",
                                                            "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC)")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etia7, ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}

# Llegadas de turistas no residentes por tipo alojamiento

#Insumo:

etia8_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etia8 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etia8_total) %>% 
  mutate(prop_=round(prop_,3)*100) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia./amigos"~"Casa flia/amigos",
                               alojamiento=="Hotel 1,2, y 3 estrellas"~"Hotel 1/2/3 est.",
                               alojamiento=="Hotel 4 y 5 estrellas"~"Hotel 4/5 est.",
                               alojamiento=="Otros"~"Otros"))


rm(etia8_total)

ranking_total <- etia8 %>% filter(paso_final=="TOTAL") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_eya <- etia8 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_cor <- etia8 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_mza <- etia8 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_pue <- etia8 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))

ranking_cto <- etia8 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_) %>% 
  mutate(alojamiento=case_when(alojamiento=="Casa flia/amigos"~"casa de familiares o amigos",
                               alojamiento=="Hotel 4/5 est."~"hoteles de 4 o 5 estrellas",
                               alojamiento=="Hotel 1/2/3 est."~"hoteles de 1,2 o 3 estrellas",
                               alojamiento=="Otros"~"alojamientos que no son hoteleros ni casa de familiares o amigos"))


```

Sin diferenciar la información por paso, el principal tipo de alojamiento utilizado por los turistas residentes en el país fue **"`r ranking_total[nrow(ranking_total),2]`"** (el `r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total de turistas utilizó este tipo de alojamiento); **mismo tipo de alojamiento se destacó en Ezeiza y Aeroparque, el Aeropuerto de Córdoba y el de Mendoza**; en tanto que **en Puerto de Buenos Aires y en Cristo Redentor el principal tipo de alojamiento fue "casa de familiares o amigos"**.


```{r etia8, fig.cap=glue("Distribución de los turistas residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia8 %>% mutate(alojamiento=factor(alojamiento,
                                                levels = c("Casa flia/amigos",
                                                           "Hotel 1/2/3 est.",
                                                           "Hotel 4/5 est.",
                                                           "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
  ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etia8, ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}

# Llegadas de turistas no residentes según USO DE PAQUETE

#Insumo:

etia9_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>% 
  mutate(paso_final="TOTAL")


etia9 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(viajeros)) %>% 
  select(-viajeros) %>%
  rbind(etia9_total) %>% 
  pivot_wider(names_from = paso_final,
              values_from = prop_)  %>% 
  select(paq,`TOTAL`,`Ezeiza y Aeroparque`,`Aep. Córdoba`,`Puerto de Buenos Aires`,
         `Aep. Mendoza`,`Cristo Redentor`) %>%
  pivot_longer(cols=c(2:7),
               names_to = "paso_final",
               values_to="prop_") %>% 
  arrange(paso_final) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etia9_total)


```

**En todos los pasos predominaron los turistas que no utilizaron paquete turístico**, aunque en el Aeropuerto de Córdoba y en el de Mendoza el peso de los que utilizaron paquete es superior que en el resto de los pasos.

```{r etia9, fig.cap=glue("Distribución de los turistas residentes según organización del viaje, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia9 %>% mutate(paq=factor(paq,
                                        levels = c("No utilizó paquete",
                                                   "Utilizó paquete")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etia9)


```

```{r}

#Insumo:

etia10_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref | p3_3==anio_ref-1 | p3_3==anio_ref-2) %>%
  group_by(p3_3) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            pernoctes=sum(totaln*wpf,na.rm = TRUE),
            gasto=sum(gastoest2*wpf,na.rm = TRUE)) %>% 
  mutate(paso_final="TOTAL")



etia10 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref | p3_3==anio_ref-1 | p3_3==anio_ref-2) %>%
  group_by(p3_3,paso_final) %>%
  summarise(viajeros=sum(viajeros*wpf,na.rm = TRUE),
            pernoctes=sum(totaln*wpf,na.rm = TRUE),
            gasto=sum(gastoest2*wpf,na.rm = TRUE)) %>% 
  rbind(etia10_total) %>% 
  arrange(p3_3, paso_final)%>%
  mutate(estadia=pernoctes/viajeros,
         gasto_tur=gasto/viajeros,
         gasto_diario=gasto/pernoctes) %>%
  ungroup() %>% 
  mutate(var_1=round((viajeros/lag(viajeros,6)-1),3),
         var_2=round((viajeros/lag(viajeros,12)-1),3),
         var_3=round((pernoctes/lag(pernoctes,6)-1),3),
         var_4=round((pernoctes/lag(pernoctes,12)-1),3),
         var_5=round((gasto/lag(gasto,6)-1),3),
         var_6=round((gasto/lag(gasto,12)-1),3),
         var_7=round((estadia/lag(estadia,6)-1),3),
         var_8=round((estadia/lag(estadia,12)-1),3),
         var_9=round((gasto_tur/lag(gasto_tur,6)-1),3),
         var_10=round((gasto_tur/lag(gasto_tur,12)-1),3),
         var_11=round((gasto_diario/lag(gasto_diario,6)-1),3),
         var_12=round((gasto_diario/lag(gasto_diario,12)-1),3)) %>%
  filter(p3_3==anio_ref) %>% 
  select(paso_final,viajeros,var_1,var_2,pernoctes,var_3,var_4,gasto,var_5,var_6,estadia,var_7,var_8,
         gasto_tur,var_9,var_10,gasto_diario,var_11,var_12)


#filtros para los años 2020:2022.


if (anio_ref %in%c(2021,2022)) {
  etia10 <- etia10 %>% select(1:2,5,8,11,14,17)
} else {
  etia10 <- etia10 %>% select(1:19)
}  


rm(etia10_total)

ranking1 <- etia10 %>% select(paso_final,gasto_tur) %>%
  filter(paso_final!="TOTAL") %>% arrange(desc(gasto_tur)) 


ranking2 <- etia10 %>% select(paso_final,gasto_diario) %>%
  filter(paso_final!="TOTAL") %>% arrange(desc(gasto_diario))

etia10 <- etia10 %>%
  mutate(paso_final=factor(paso_final,levels = c("TOTAL","Ezeiza y Aeroparque","Aep. Córdoba",
                                                 "Puerto de Buenos Aires","Aep. Mendoza",
                                                 "Cristo Redentor"))) %>% 
  arrange(paso_final)


```

En `r as.character(anio_ref)`, en la **totalidad de los pasos relevados**, el gasto de los turistas residentes que viajaron al exterior sumó `r format(round(etia10[1,4]/1000000,1),,decimal.mark = ",",big.mark = ".")` millones de US\$.

El **gasto total en dólares** de los turistas residentes en **Ezeiza y Aeroparque** ascendió a `r format(round(etia10[2,4]/1000000,1),decimal.mark = ",",big.mark = ".")` millones; `r format(round(etia10[3,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Aeropuerto de Córdoba**; `r format(round(etia10[4,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Puerto de Buenos Aires**;  `r format(round(etia10[5,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en el **Aeropuerto de Mendoza**; y, finalmente  `r format(round(etia10[6,4]/1000000,1),decimal.mark = ",",big.mark = ".")` mill. en **Cristo Redentor**.

**El gasto en  US\$ por turista residente** fue de `r format(round(etia10[1,6]/1,1),decimal.mark = ",",big.mark = ".")`. Se observa que, al desagregar la información por paso, el mayor gasto por turista fue en **`r ranking1[1,1]`**  (`r format(round(ranking1[1,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); seguido por el **`r ranking1[2,1]`**  (`r format(round(ranking1[2,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking1[3,1]`**  (`r format(round(ranking1[3,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); el **`r ranking1[4,1]`**  (`r format(round(ranking1[4,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); y **`r ranking1[5,1]`**  (`r format(round(ranking1[5,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$).

El **gasto promedio diario en US\$** fue de `r format(round(etia10[1,7]/1,1),decimal.mark = ",",big.mark = ".")` en la **totalidad de los pasos**; `r format(round(ranking2[1,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$ en el **`r ranking2[1,1]`**; seguido por **`r ranking2[2,1]`**  (`r format(round(ranking2[2,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking2[3,1]`**  (`r format(round(ranking2[3,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); **`r ranking2[4,1]`**  (`r format(round(ranking2[4,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$); y **`r ranking2[5,1]`**  (`r format(round(ranking2[5,2]/1,1),decimal.mark = ",",big.mark = ".")` US\$).


```{r etia10 }

#Tabla:

etia10 %>%
  gt()%>%
  gt_theme_dnmye() %>% 
  tab_caption(glue("Salidas de turistas, pernoctaciones, gasto total y gasto por viajero en dólares, estadía media de turistas residentes, según paso. Año {anio_ref}.")) %>% 
  cols_label(paso_final = "Paso",
             viajeros="Turistas",
             pernoctes="Pernoc- taciones",
             gasto="Gasto total",
             estadia="Estadía promedio (en noches)",
             gasto_tur="Gasto por turista (en US$)",
             gasto_diario="Gasto promedio diario (en US$)") %>%
  fmt_number(columns = c(2:4), decimals = 0, dec_mark = ",", sep_mark = ".") %>%
  fmt_number(columns = c(5:7), decimals = 1, dec_mark = ",", sep_mark = ".") %>% 
  tab_options(data_row.padding = px(3)) %>% 
  cols_width(columns = c(1) ~ px(160),
             columns = c(2:7) ~ px(120)) %>%
  # tab_source_note(
  #   source_note = md("**Nota:** En el año 2021 se relevaron el trim 1 y 4 en Ezeiza y Aeroparque; y el trim 4 en el resto de los pasos.")) %>%
  tab_source_note(
    source_note = md("**Fuente:** Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")) %>%
  tab_style(
    style = cell_fill(dnmye_colores("gris claro")),
    locations = cells_body(rows = 1)
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight =  "bold")
    ),
    locations = cells_body(rows = 1
    )) %>% 
  tab_options(container.height = 600,
              container.overflow.y = T)   


rm(etia10,ranking1,ranking2)


```

```{r}

# Gasto total de no residentes por motivo de viaje

#Insumo

etia11_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etia11 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etia11_total) %>% 
  mutate(prop_=(round(prop_,3))*100)

rm(etia11_total)


ranking_total <- etia11 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia11 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia11 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia11 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia11 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia11 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)



```

A **nivel general**, aportaron más al gasto total los turistas residentes que tuvieron como **principal motivo de viaje "`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del total). **Mismo escenario se repite al desagregar la información por paso.**

```{r etia11, fig.cap=glue("Distribución del gasto total en dólares de turistas residentes según motivo de viaje, por paso. Año {anio_ref}.")}


#Gráfico en ggplot


ggplot(data=etia11 %>% mutate(motivo=factor(motivo,
                                            levels = c("Visita flia/amigos",
                                                       "Vacaciones/ocio/recreación",
                                                       "Negocios/congreso/conferencia",
                                                       "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
  ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal"),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etia11,ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}

#  Gasto total de no residentes por tipo alojamiento 

#Insumo:

etia12_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etia12 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etia12_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etia12_total)

ranking_total <- etia12 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia12 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia12 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia12 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia12 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia12 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)


```


En la **agrupación de los pasos**, la mayor proporción del gasto estuvo generado por los turistas hospedados en la categoría **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del gasto total).

En **Ezeiza y Aeroparque**, los turistas residentes que se alojaron en la categoría **"`r ranking_eya[nrow(ranking_eya),2]`"** participaron en el `r format(round(1*ranking_eya[nrow(ranking_eya),3],1),decimal.mark = ",",big.mark = ".")`% del gasto; en el **Aeropuerto de Córdoba** el mayor aporte provino, también, de los turistas alojados en la categoría **"`r ranking_cor[nrow(ranking_cor),2]`"** (`r format(round(1*ranking_cor[nrow(ranking_cor),3],1),decimal.mark = ",",big.mark = ".")`% del total); misma categoría se destacó en el **Aeropuerto de Mendoza** (`r format(round(1*ranking_mza[nrow(ranking_mza),3],1),decimal.mark = ",",big.mark = ".")`%); en el  **Puerto de Buenos Aires**  la mayor proporción del gasto se concentró en la categoría **"`r ranking_pue[nrow(ranking_pue),2]`"** (`r format(round(1*ranking_pue[nrow(ranking_pue),3],1),decimal.mark = ",",big.mark = ".")`% del total); en tanto que en **Cristo Redentor** la mayor parte del gasto provino de los turistas que se alojaron en **"`r ranking_cto[nrow(ranking_cto),2]`"** (`r format(round(1*ranking_cto[nrow(ranking_cto),3],1),decimal.mark = ",",big.mark = ".")`% del total).    



```{r etia12, fig.cap=glue("Distribución del gasto total en dólares de los turistas residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia12 %>% mutate(alojamiento=factor(alojamiento,
                                                 levels = c("Casa flia./amigos",
                                                            "Hotel 4 y 5 estrellas",
                                                            "Hotel 1,2, y 3 estrellas",
                                                            "Otros")),
                              paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                   paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                   paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                   paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                   paso_final=="Cristo Redentor"~"Cto. Red.",
                                                   TRUE~paso_final),
                              paso_final=factor(paso_final,
                                                levels = c("TOTAL",
                                                           "Eze. y Aep.",
                                                           "Aep. Cord.",
                                                           "Aep.Mza.",
                                                           "Puerto BA.",
                                                           "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(#text = element_text(family = "Encode Sans Normal"),
        plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etia12,ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}

#  Gasto total de no residentes según uso de paquete

#Insumo:

etia13_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>% 
  mutate(paso_final="TOTAL")


etia13 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(gasto=sum(gastoest2*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(gasto)) %>% 
  select(-gasto) %>%
  rbind(etia13_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etia13_total)


ranking_total <- etia13 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia13 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia13 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia13 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia13 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia13 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)

```

Tanto a nivel total como en la mayoría de los pasos, **la mayor proporción del gasto provino de turistas residentes que no contrataron paquete turístico en la organización de su viaje al exterior** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% del gasto total en la suma de los pasos); nuevamente se destacan los casos **del Aeropuerto de Córdoba y el de Mendoza**, donde **el peso del gasto generado por turistas que contrataron paquete turístico crece considerablemente con respecto a los demás pasos.**

```{r etia13, fig.cap=glue("Distribución del gasto total en dólares de los turistas no residentes según utilización de paquete turístico, por paso. Año {anio_ref}.")}


#Gráfico:

ggplot(data=etia13 %>% mutate(paq=factor(paq,
                                         levels = c("No utilizó paquete",
                                                    "Utilizó paquete")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etia13,ranking_total, ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)


```

```{r}

#Pernoctaciones por alojamiento

#Insumo

etia14_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(motivo) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etia14 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,motivo) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etia14_total) %>% 
  mutate(prop_=(round(prop_,3))*100)

rm(etia14_total)

ranking_total <- etia14 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia14 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia14 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia14 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia14 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia14 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)


```

Al analizar **la distribución de las pernoctaciones según perfil de los turistas**, se observa, en primer lugar, cómo en la suma de todos los pasos la mayoría de las pernoctaciones provinieron de los turistas que viajaron al exterior con motivo de **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`% de las pernoctaciones).

Cuando se diferencia por paso, en **Ezeiza y Aeroparque**, el **Aeropuerto de Córdoba** y el **Aeropuerto de Mendoza"**, la mayor proporción de las pernoctaciones se generaron por turistas que viajaron por **"`r ranking_eya[nrow(ranking_eya),2]`"** (`r format(round(1*ranking_mza[nrow(ranking_mza),3],1),decimal.mark = ",",big.mark = ".")`% del total, en los tres casos). En el caso del **Puerto de Buenos Aires** y en **Cristo Redentor** el **motivo "visita a familiares o amigos" concentró la mayor cantidad de pernoctaciones** (`r format(round(1*ranking_pue[nrow(ranking_pue),3],1),decimal.mark = ",",big.mark = ".")` y `r format(round(1*ranking_cto[nrow(ranking_cto),3],1),decimal.mark = ",",big.mark = ".")`% del total, en cada caso).



```{r etia14, fig.cap=glue("Distribución de los pernoctes residentes según motivo de viaje, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia14 %>% mutate(motivo=factor(motivo,
                                            levels = c("Visita flia/amigos",
                                                       "Vacaciones/ocio/recreación",
                                                       "Negocios/congreso/conferencia",
                                                       "Otros")),
                              paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                   paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                   paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                   paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                   paso_final=="Cristo Redentor"~"Cto. Red.",
                                                   TRUE~paso_final),
                              paso_final=factor(paso_final,
                                                levels = c("TOTAL",
                                                           "Eze. y Aep.",
                                                           "Aep. Cord.",
                                                           "Aep.Mza.",
                                                           "Puerto BA.",
                                                           "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=motivo,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)
            #,size=6
  ) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etia14,ranking_total,ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)

```

```{r}

# Gasto total de no residentes por tipo alojamiento 

#Insumo:

etia15_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(alojamiento) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etia15 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,alojamiento) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etia15_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etia15_total)


ranking_total <- etia15 %>% filter(paso_final=="TOTAL") %>% arrange(prop_)
ranking_eya <- etia15 %>% filter(paso_final=="Ezeiza y Aeroparque") %>% arrange(prop_)
ranking_cor <- etia15 %>% filter(paso_final=="Aep. Córdoba") %>% arrange(prop_)
ranking_mza <- etia15 %>% filter(paso_final=="Aep. Mendoza") %>% arrange(prop_)
ranking_pue <- etia15 %>% filter(paso_final=="Puerto de Buenos Aires") %>% arrange(prop_)
ranking_cto <- etia15 %>% filter(paso_final=="Cristo Redentor") %>% arrange(prop_)

```

La distribución de los pernoctes de los turistas residentes que viajaron al exterior según **principal tipo de alojamiento utilizado**, evidencia que **a nivel general** la mayor cantidad de pernoctes fueron de turistas hospedados en **"`r ranking_total[nrow(ranking_total),2]`"** (`r format(round(1*ranking_total[nrow(ranking_total),3],1),decimal.mark = ",",big.mark = ".")`%); escenario que se repite al desagregar la información por paso.

```{r etia15, fig.cap=glue("Distribución de los pernoctes residentes según principal tipo de alojamiento, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia15 %>% mutate(alojamiento=factor(alojamiento,
                                                 levels = c("Casa flia./amigos",
                                                            "Hotel 4 y 5 estrellas",
                                                            "Hotel 1,2, y 3 estrellas",
                                                            "Otros")),
                             paso_final=case_when(paso_final=="Ezeiza y Aeroparque"~"Eze. y Aep.",
                                                  paso_final=="Aep. Córdoba"~"Aep. Cord.",
                                                  paso_final=="Aep. Mendoza"~"Aep.Mza.",
                                                  paso_final=="Puerto de Buenos Aires"~"Puerto BA.",
                                                  paso_final=="Cristo Redentor"~"Cto. Red.",
                                                  TRUE~paso_final),
                             paso_final=factor(paso_final,
                                               levels = c("TOTAL",
                                                          "Eze. y Aep.",
                                                          "Aep. Cord.",
                                                          "Aep.Mza.",
                                                          "Puerto BA.",
                                                          "Cto. Red."))),
       aes(x=paso_final,y=prop_,fill=alojamiento,
           label=glue("{prop_} %")))+
  geom_col()+ 
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
        plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
        axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
        plot.title=element_text(hjust = 0,face = "bold"),
        legend.title = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        legend.position = "top")

rm(etia15,ranking_total,ranking_eya,ranking_cor,
   ranking_mza,ranking_pue,ranking_cto)



```

```{r}

# Pernoctaciones según uso de paquete

#Insumo:

etia16_total <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paq) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>% 
  mutate(paso_final="TOTAL")


etia16 <- eti_a_perfiles %>%
  filter(p3_3==anio_ref) %>% 
  group_by(paso_final,paq) %>%
  summarise(pernoctes=sum(totaln*wpf,na.rm = TRUE))%>%
  mutate(prop_=prop.table(pernoctes)) %>% 
  select(-pernoctes) %>%
  rbind(etia16_total) %>% 
  mutate(prop_=(round(prop_,3))*100)


rm(etia16_total)


```

Tanto a nivel total como en la mayoría de los pasos, sobre el total de las pernoctaciones, **fue marginal el aporte de los turistas que contrataron paquete turístico para organizar su viaje al exterior**.


```{r etia16, fig.cap=glue("Distribución de los pernoctes residentes según utilización de paquete turístico, por paso. Año {anio_ref}.")}

#Gráfico:

ggplot(data=etia16 %>% mutate(paq=factor(paq,
                                         levels = c("No utilizó paquete",
                                                    "Utilizó paquete")),
                              paso_final=factor(paso_final,
                                                levels = c("TOTAL",
                                                           "Ezeiza y Aeroparque",
                                                           "Aep. Córdoba",
                                                           "Aep. Mendoza",
                                                           "Puerto de Buenos Aires",
                                                           "Cristo Redentor"))),
       aes(x=paso_final,y=prop_,fill=paq,
           label=glue("{prop_} %"),group=paq))+
  geom_col()+ 
  geom_label(fill="white",size=2.5,position = position_stack(vjust = .5)) +
  scale_fill_dnmye(reverse = TRUE)+
  scale_y_continuous(labels = function(x) paste0(x,"%"))+
  labs(x = "",
       y = "",
       colour="",
       caption = "Fuente: Encuesta de Turismo Internacional (ETI) - (DNMyE e INDEC).")+
  theme_minimal()+
  theme(plot.caption  = element_markdown(hjust = 0),
    plot.subtitle=element_text(colour = dnmye_colores("gris oscuro")),
    axis.title.y = element_text(colour = dnmye_colores("gris oscuro")),
    plot.title=element_text(hjust = 0,face = "bold"),
    legend.title = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_blank(),
    legend.position = "top")

rm(etia16)


```

## Recursos disponibles

Los datos que se muestran en este capítulo forman parte del Sistema de Información Turística de la Argentina (SINTA) <https://www.yvera.tur.ar/sinta/>{target="_blank"} de la Dirección Nacional de Mercados y Estadística (DNMyE). Los mismos se presentan a través de distintos formatos:

-   [Informes:](https://www.yvera.tur.ar/sinta/informe/info/turismo-internacional){target="_blank"} Publicación mensual del turismo internacional -receptivo y
emisivo- de la totalidad de los pasos fronterizos del país: viajes de turistas no residentes que visitaron el país
y de turistas residentes que viajaron al exterior. La información estadística está basada en los registros migratorios provistos por la Dirección
Nacional de Migraciones (DNM) y en la Encuesta de Turismo Internacional (ETI).

-   [Reportes:](https://tableros.yvera.tur.ar/internacional.html){target="_blank"} Reporte de los últimos datos de Turismo Internacional.

-   [Tableros:](https://tableros.yvera.tur.ar/turismo_internacional/){target="_blank"} Tablero con información del **turismo internacional -receptivo y emisivo- de la totalidad de los pasos fronterizos del país** y del perfil del turismo receptivo que egresó por los pasos **Ezeiza y Aeroparque con datos de la ETI**. 


-   [Datos Abiertos de turismo internacional  por la totalidad de pasos fronterizos:](https://datos.yvera.gob.ar/dataset/turismo-internacional-total-pais){target="_blank"} Incluye un conjunto de datasets y recursos disponibles en diferentes niveles de desagregación y en variados formatos en caso de que se necesite un reprocesamiento de los mismos.

-   [Datos Abiertos de la ETI:](https://datos.yvera.gob.ar/dataset/encuesta-turismo-internacional){target="_blank"} Incluye un conjunto de datasets y recursos disponibles en diferentes niveles de desagregación y en variados formatos en caso de que se necesite un reprocesamiento de los mismos.

Asimismo, se puede consultar la [Web de la ETI](https://www.indec.gob.ar/indec/web/Nivel4-Tema-3-13-55){target="_blank"}
